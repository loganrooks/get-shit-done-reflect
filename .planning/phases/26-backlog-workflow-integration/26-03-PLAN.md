---
phase: 26-backlog-workflow-integration
plan: 03
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - get-shit-done/bin/gsd-tools.test.js
autonomous: true

must_haves:
  truths:
    - "Backlog items created before Phase 26 (without milestone field) parse correctly with milestone defaulting to null"
    - "All backlog CLI commands (list, group, stats, promote, update, index) include milestone in their output or behavior"
    - "Todo readers (cmdListTodos, cmdInitTodos) are unaffected by backlog schema changes -- no milestone field contamination"
    - "Full test suite passes with zero regressions after all Phase 26 changes"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.test.js"
      provides: "Backward compatibility tests, reader enumeration verification tests, todo isolation tests"
  key_links:
    - from: "readBacklogItems"
      to: "items without milestone field"
      via: "default to null when fm.milestone is undefined"
      pattern: "fm\\.milestone.*\\|\\| null"
    - from: "cmdListTodos"
      to: "todo files"
      via: "reads pending/*.md without backlog fields"
      pattern: "cmdListTodos"
---

<objective>
Verify all data readers across the todo and backlog systems handle the new milestone field correctly, with special focus on backward compatibility and cross-system isolation.

Purpose: BINT-05 requires explicit enumeration and verification of every code path that reads todo or backlog data, preventing the v1.14 pattern where a schema change updated one reader but broke others. This plan provides the safety net.

Output: Comprehensive verification tests confirming zero data loss and correct defaults.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-backlog-workflow-integration/26-RESEARCH.md
@.planning/phases/26-backlog-workflow-integration/26-01-SUMMARY.md
@get-shit-done/bin/gsd-tools.js
@get-shit-done/bin/gsd-tools.test.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write backward compatibility and reader enumeration tests</name>
  <files>get-shit-done/bin/gsd-tools.test.js</files>
  <action>
    Add a new describe block: `describe('BINT-05: reader enumeration verification', () => { ... })` at the end of the backlog test section.

    Write the following tests:

    **Backward compatibility tests (items without milestone field):**

    1. `test('backlog items without milestone field default to null in list output')`:
       - Use createBacklogItem WITHOUT overriding milestone (helper should default to 'null')
       - But also manually create a second item file with NO milestone line at all (simulating a pre-Phase-26 item):
         ```
         ---
         id: blog-2026-01-01-old-item
         title: Pre-Phase-26 item
         tags: []
         theme: general
         priority: MEDIUM
         status: captured
         source: command
         promoted_to: null
         created: 2026-01-01T10:00:00.000Z
         updated: 2026-01-01T10:00:00.000Z
         ---
         ```
       - Run `backlog list --raw`
       - Assert both items parse successfully
       - Assert the old item (without milestone line) has `milestone: null`

    2. `test('backlog group handles items without milestone field')`:
       - Create mix of items: one with milestone, one without
       - Run `backlog group --by theme --raw`
       - Assert both items appear in groups with no errors

    3. `test('backlog stats counts items regardless of milestone field presence')`:
       - Create items with and without milestone field
       - Run `backlog stats --raw`
       - Assert total count includes all items

    **Backlog reader enumeration tests (B1-B7):**

    4. `test('backlog promote on item without milestone field preserves existing fields')`:
       - Create item manually without milestone line (pre-Phase-26 format)
       - Run `backlog promote <id> --to REQ-01 --milestone v2.0`
       - Read item file and verify milestone: v2.0 was added
       - Verify all other fields (id, title, tags, status, promoted_to) are correct

    5. `test('backlog update --milestone on item without prior milestone field adds it')`:
       - Create item manually without milestone line
       - Run `backlog update <id> --milestone v1.5`
       - Read item file and verify milestone: v1.5 was added
       - Verify no other fields were corrupted

    6. `test('backlog index includes Milestone column for mixed items')`:
       - Create items: one with milestone v1.5, one without milestone
       - Run `backlog index --raw` (or call regenerateBacklogIndex via the CLI)
       - Read the generated index.md
       - Assert table header includes "Milestone"
       - Assert row with milestone shows "v1.5"
       - Assert row without milestone shows fallback value (dash or empty)

    **Todo system isolation tests:**

    7. `test('cmdListTodos output is unchanged by backlog schema changes')`:
       - Create a pending todo file with standard format (title, area, created, no milestone field)
       - Run `init todos`
       - Assert output contains expected todo fields (title, area, priority, source, status)
       - Assert output does NOT contain a milestone field in any todo object

    8. `test('todo with auto-defaults does not gain milestone field')`:
       - Create a minimal todo file (only title and area, no priority/source/status)
       - Run `init todos`
       - Assert auto-defaults applied (priority: MEDIUM, source: unknown, status: pending)
       - Assert NO milestone field in the todo object

    Place these tests at the end of the existing test file, after the backlog test sections. Each test should use a fresh tmpDir via the existing beforeEach/afterEach pattern.
  </action>
  <verify>
    ```bash
    cd /Users/rookslog/Development/get-shit-done-reflect && node --test get-shit-done/bin/gsd-tools.test.js 2>&1 | tail -10
    ```

    All new tests pass. Verify:
    1. 8 new tests in 'BINT-05: reader enumeration verification' describe block
    2. All existing tests still pass (zero regressions)
    3. Total test count increased by 8 from the post-Plan-01 count
  </verify>
  <done>8 verification tests confirm backward compatibility, reader correctness, and todo isolation</done>
</task>

<task type="auto">
  <name>Task 2: Run full test suite and verify end-to-end data flow</name>
  <files>get-shit-done/bin/gsd-tools.test.js</files>
  <action>
    Run the complete test suite and verify all tests pass:

    ```bash
    cd /Users/rookslog/Development/get-shit-done-reflect && node --test get-shit-done/bin/gsd-tools.test.js
    ```

    Verify the following end-to-end data flow by reading test output:

    1. **Add -> List flow:** backlog add creates item with milestone: null, backlog list returns it with milestone: null
    2. **Promote -> List flow:** backlog promote sets milestone: v1.5, backlog list returns it with milestone: 'v1.5'
    3. **Update -> List flow:** backlog update --milestone changes value, backlog list reflects the change
    4. **Add -> Index flow:** backlog add triggers auto-regeneration, index.md has Milestone column
    5. **Multi-status filter:** backlog list --status captured,triaged returns correct subset
    6. **Backward compat:** items without milestone line parse with null default
    7. **Todo isolation:** init todos returns todos without milestone contamination

    If any test fails:
    - Read the failing test output to identify the issue
    - Fix the test OR the implementation (in get-shit-done/bin/gsd-tools.js) as appropriate
    - Re-run and confirm all tests pass

    Report final counts:
    - Total tests: [N] (should be 143 + Plan 01 tests + 8 Plan 03 tests)
    - Passing: [N]
    - Failing: 0
  </action>
  <verify>
    ```bash
    cd /Users/rookslog/Development/get-shit-done-reflect && node --test get-shit-done/bin/gsd-tools.test.js 2>&1 | grep -E "^(# tests|# pass|# fail|tests|pass|fail)" || node --test get-shit-done/bin/gsd-tools.test.js 2>&1 | tail -5
    ```

    Output shows 0 failures and total test count matches expected.
  </verify>
  <done>Full test suite passes with 0 failures; end-to-end data flow verified across add/list/promote/update/index/stats/group commands and todo system isolation confirmed</done>
</task>

</tasks>

<verification>
1. Run full test suite: `node --test get-shit-done/bin/gsd-tools.test.js` -- 0 failures
2. Verify BINT-05 reader enumeration: all 7 backlog readers (B1-B7) handle milestone field
3. Verify todo isolation: readers T1-T2 produce identical output regardless of backlog changes
4. Verify backward compat: items without milestone field parse with null default
</verification>

<success_criteria>
- 8 new tests in BINT-05 describe block, all passing
- Backward compatibility verified: pre-Phase-26 items (no milestone field) work correctly
- Todo system isolation verified: no milestone contamination in todo output
- Full test suite passes with zero regressions
- Reader enumeration complete: B1-B7 (backlog) + T1-T2 (todo) verified
</success_criteria>

<output>
After completion, create `.planning/phases/26-backlog-workflow-integration/26-03-SUMMARY.md`
</output>
