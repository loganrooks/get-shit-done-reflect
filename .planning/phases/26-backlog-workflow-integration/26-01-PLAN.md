---
phase: 26-backlog-workflow-integration
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - get-shit-done/bin/gsd-tools.js
  - get-shit-done/bin/gsd-tools.test.js
autonomous: true

must_haves:
  truths:
    - "backlog add creates items with milestone field defaulting to string 'null'"
    - "backlog list returns milestone field (null when unpromoted, version string when promoted)"
    - "backlog promote accepts --milestone flag and writes milestone version to item frontmatter"
    - "backlog update accepts --milestone flag to modify milestone field"
    - "backlog index includes Milestone column in generated table"
    - "backlog list accepts comma-separated --status values for multi-status filtering"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "milestone field in add/read/promote/update/index + comma-separated status filter"
    - path: "get-shit-done/bin/gsd-tools.test.js"
      provides: "TDD tests for milestone field and multi-status filter"
  key_links:
    - from: "cmdBacklogAdd"
      to: "reconstructFrontmatter"
      via: "milestone: 'null' string survives null-skipping serialization"
      pattern: "milestone: 'null'"
    - from: "cmdBacklogPromote"
      to: "reconstructFrontmatter"
      via: "--milestone param writes version string to frontmatter"
      pattern: "fm\\.milestone = milestone"
    - from: "readBacklogItems"
      to: "all downstream consumers (list, group, stats, index)"
      via: "milestone field in returned item objects"
      pattern: "milestone: fm\\.milestone"
---

<objective>
Extend the backlog system schema with a `milestone` field and enhance the promote command with `--milestone` support. Also add comma-separated multi-status filtering to backlog list.

Purpose: BINT-02 requires promoted backlog items to track which milestone they belong to. The milestone field must be added to add, read, promote, update, and index commands. Multi-status filtering (BINT-04 dependency) lets workflows filter for "captured,triaged" items during milestone completion.

Output: Working, tested milestone field across all backlog commands and multi-status filter for backlog list.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-backlog-workflow-integration/26-RESEARCH.md
@.planning/phases/25-backlog-system-core/25-01-SUMMARY.md
@.planning/phases/25-backlog-system-core/25-02-SUMMARY.md
@get-shit-done/bin/gsd-tools.js
@get-shit-done/bin/gsd-tools.test.js
</context>

<feature>
  <name>Milestone field extension + multi-status filter</name>
  <files>get-shit-done/bin/gsd-tools.js, get-shit-done/bin/gsd-tools.test.js</files>
  <behavior>
    Expected behavior in testable terms:

    1. cmdBacklogAdd: frontmatter includes `milestone: null` (string 'null' to survive reconstructFrontmatter null-skipping, same pattern as promoted_to)
       - `backlog add --title "idea"` -> file contains `milestone: null`

    2. readBacklogItems: returns `milestone` field in each item object
       - item with `milestone: null` in file -> `{ milestone: null }` (JS null)
       - item with `milestone: v1.5` in file -> `{ milestone: 'v1.5' }`

    3. cmdBacklogPromote: accepts optional `milestone` parameter
       - `backlog promote <id> --to AUTH-01 --milestone v1.5` -> file has `milestone: v1.5`, `promoted_to: AUTH-01`, `status: planned`
       - `backlog promote <id> --to AUTH-01` (no --milestone) -> milestone field unchanged
       - Output JSON includes `milestone` field

    4. cmdBacklogUpdate CLI dispatch: accepts `--milestone` argument
       - `backlog update <id> --milestone v1.5` -> file has `milestone: v1.5`

    5. regenerateBacklogIndex: generated table includes Milestone column
       - Item with milestone: v1.5 -> row shows "v1.5" in Milestone column
       - Item with milestone: null -> row shows empty or "—" in Milestone column

    6. cmdBacklogList: accepts comma-separated `--status` values
       - `backlog list --status captured,triaged` -> returns items with status "captured" OR "triaged"
       - `backlog list --status planned` -> still works for single status (backward compat)

    7. createBacklogItem test helper: includes `milestone` field with default
       - `createBacklogItem(dir, {})` -> file contains `milestone: null`
       - `createBacklogItem(dir, { milestone: 'v1.5' })` -> file contains `milestone: v1.5`
  </behavior>
  <implementation>
    All changes go to source files (get-shit-done/bin/), NOT installed copies (.claude/get-shit-done/bin/).

    In gsd-tools.js:

    1. readBacklogItems (line ~3688): Add `milestone: fm.milestone === 'null' ? null : (fm.milestone || null)` to the items.push object

    2. cmdBacklogAdd (line ~3732): Add `milestone: 'null'` to the frontmatter object (after promoted_to line)

    3. cmdBacklogPromote (line ~3891):
       - Change function signature from `(cwd, itemId, target, raw)` to `(cwd, itemId, target, milestone, raw)`
       - After `if (target) { fm.promoted_to = target; }`, add: `if (milestone) { fm.milestone = milestone; }`
       - Add `milestone: milestone || null` to the output object

    4. CLI dispatch for promote (line ~5444-5447):
       - Add `const milestoneIdx = args.indexOf('--milestone');` after toIdx
       - Pass `milestoneIdx !== -1 ? args[milestoneIdx + 1] : null` as 4th arg to cmdBacklogPromote
       - Shift `raw` to 5th arg position

    5. CLI dispatch for update (line ~5426-5437):
       - Add `const milestoneIdx = args.indexOf('--milestone');` alongside other field indexes
       - Add `milestone: milestoneIdx !== -1 ? args[milestoneIdx + 1] : undefined` to the update object

    6. regenerateBacklogIndex (line ~3955-3978):
       - Add `milestone: fm.milestone === 'null' ? null : (fm.milestone || null)` to items.push
       - Add `| Milestone` to table header
       - Add `|-----------|` to separator
       - Add `| ${item.milestone || '—'}` to each row

    7. cmdBacklogList (line ~3762-3776):
       - Change status filter from exact match to comma-separated:
         `if (status && !status.split(',').map(s => s.trim()).includes(item.status)) return false;`

    In gsd-tools.test.js:

    8. createBacklogItem helper (line ~2993-3021):
       - Add `milestone: ${overrides.milestone || 'null'}` to the frontmatter template (after promoted_to line)
  </implementation>
</feature>

<verification>
```bash
cd /Users/rookslog/Development/get-shit-done-reflect && node --test get-shit-done/bin/gsd-tools.test.js 2>&1 | tail -5
```

All tests pass, including:
- New milestone field tests (add, list, promote, update, index)
- Multi-status filter test
- All 143 existing tests still pass (zero regressions)
</verification>

<success_criteria>
- backlog add creates items with `milestone: null` in frontmatter
- backlog list returns milestone field in item objects
- backlog promote --milestone writes milestone version to item file
- backlog update --milestone modifies milestone field
- backlog index table includes Milestone column
- backlog list --status captured,triaged returns items matching either status
- createBacklogItem test helper includes milestone field
- All existing tests pass with zero regressions
</success_criteria>

<output>
After completion, create `.planning/phases/26-backlog-workflow-integration/26-01-SUMMARY.md`
</output>
