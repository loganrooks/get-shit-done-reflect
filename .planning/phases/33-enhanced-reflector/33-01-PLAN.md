---
phase: 33-enhanced-reflector
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/references/reflection-patterns.md
autonomous: true

must_haves:
  truths:
    - "reflection-patterns.md documents confidence-weighted scoring formula (confidence_weight * severity_multiplier) replacing raw count thresholds"
    - "reflection-patterns.md documents counter-evidence seeking protocol with 3-counter-example bound"
    - "reflection-patterns.md documents reflect-to-spike pipeline criteria for low-confidence patterns"
    - "Thresholds table shows weighted score thresholds (3.0/4.0/5.0) per max-severity tier instead of raw occurrence counts"
  artifacts:
    - path: "get-shit-done/references/reflection-patterns.md"
      provides: "Confidence-weighted detection rules, counter-evidence protocol, spike pipeline criteria"
      contains: "weighted_score"
  key_links:
    - from: "get-shit-done/references/reflection-patterns.md"
      to: "agents/gsd-reflector.md"
      via: "Reflector references reflection-patterns.md for detection rules"
      pattern: "confidence_weight.*severity_multiplier"
---

<objective>
Update reflection-patterns.md with confidence-weighted pattern detection, counter-evidence seeking rules, and reflect-to-spike pipeline criteria.

Purpose: The reflector agent reads reflection-patterns.md as its authoritative reference for detection rules. This plan replaces the raw count thresholds (Section 2.1) with confidence-weighted scoring, adds a new counter-evidence section, and defines spike candidate criteria -- providing the detection foundation that Plan 03 (reflector rewrite) will implement.

Output: Updated reflection-patterns.md with three new/rewritten sections covering REFLECT-02, REFLECT-03, and REFLECT-08.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-enhanced-reflector/33-RESEARCH.md
@get-shit-done/references/reflection-patterns.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace raw count thresholds with confidence-weighted scoring in Section 2.1</name>
  <files>get-shit-done/references/reflection-patterns.md</files>
  <action>
Rewrite Section 2.1 "Severity-Weighted Thresholds" to use confidence-weighted scoring:

1. **Replace the threshold table.** The current table uses raw occurrence counts (critical: 2, notable: 3, minor: 5). Replace with a confidence-weighted scoring model:

```
weighted_score = sum(weight(signal) for signal in cluster)

weight(signal) = confidence_weight * severity_multiplier

confidence_weight: high -> 2.0, medium -> 1.0, low -> 0.5
severity_multiplier: critical -> 1.5, notable -> 1.0, minor -> 0.7
```

New threshold table (by max severity in cluster):
| Max Severity | Weighted Score Threshold |
|-------------|--------------------------|
| critical    | 3.0                      |
| notable     | 4.0                      |
| minor       | 5.0                      |

2. **Add a "Default confidence for legacy signals" note:** Signals missing the `confidence` field default to `medium` (weight 1.0). This gives legacy signals neutral weight.

3. **Update the threshold application pseudocode** to calculate weighted_score instead of checking raw count. The pseudocode should iterate over cluster signals, compute per-signal weight, sum to get cluster weighted_score, then compare against threshold for the cluster's max severity.

4. **Add worked examples** showing:
   - 3 high-confidence critical signals: score = 3 * 2.0 * 1.5 = 9.0, threshold 3.0 -> qualifies
   - 5 low-confidence minor signals: score = 5 * 0.5 * 0.7 = 1.75, threshold 5.0 -> does NOT qualify (correctly filters noise)
   - 4 medium-confidence notable signals: score = 4 * 1.0 * 1.0 = 4.0, threshold 4.0 -> qualifies at boundary

5. **Preserve Section 2.2 (Clustering Criteria) and Section 2.3 (Pattern Output Format) unchanged.** Only Section 2.1 changes. Update the Pattern Output Format in 2.3 to include "Weighted Score" alongside Confidence.

6. **Update Section 2.4 (Time and Persistence):** No changes needed (rule stays: no time-based rolling windows).

7. **Update Confidence Expression (Section 9.1):** Add note that confidence levels now feed into weighted scoring, not just reporting. Update the criteria table to reference weighted score impact.

Keep the existing version (1.1.0) and update to 1.2.0. Update the phase reference line to include Phase 33.
  </action>
  <verify>
Grep for "weighted_score" in reflection-patterns.md to confirm the formula is present.
Grep for "3.0" and "4.0" and "5.0" to confirm new thresholds are in the table.
Confirm no raw count thresholds (the old "2 occurrences", "3 occurrences", "5 occurrences") remain as primary thresholds.
  </verify>
  <done>
Section 2.1 contains the confidence-weighted scoring formula, default confidence for legacy signals, worked examples, and updated threshold table. Version bumped to 1.2.0.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add counter-evidence seeking section and reflect-to-spike pipeline criteria</name>
  <files>get-shit-done/references/reflection-patterns.md</files>
  <action>
Add two new sections to reflection-patterns.md:

**Section 2.5: Counter-Evidence Seeking (new)**

Add after Section 2.4. This section defines the bounded counter-evidence protocol (REFLECT-03):

1. **Purpose:** Before confirming a pattern, the reflector actively seeks evidence that contradicts the pattern. This prevents false positives and confirmation bias.

2. **Counter-evidence sources** (in priority order):
   a. Signals with same tags but `signal_category: positive` (positive signals contradict negative patterns)
   b. Signals where the same issue was remediated or verified (lifecycle_state: remediated or verified)
   c. Time-decay indicator: if ALL pattern signals are older than 30 days with no recent recurrence, flag as "potentially stale" (advisory only, does NOT exclude from detection)

3. **Bounded search:** Examine up to 3 potential counter-examples per pattern. This bounds the analysis effort while still checking for obvious contradictions.

4. **Counter-evidence impact:**
   - 0 counter-examples found: Pattern confirmed at current confidence
   - 1 counter-example found: Reduce pattern confidence one level (e.g., high -> medium)
   - 2-3 counter-examples found: Reduce pattern confidence two levels (e.g., high -> low) or flag as "investigate" triage candidate
   - Counter-evidence is cited in the pattern report

5. **Counter-evidence output format:**
```markdown
**Counter-evidence (N found):**
- {signal-id}: {why it contradicts the pattern}
- **Impact:** Confidence reduced from {original} to {adjusted}
```

**Section 12: Reflect-to-Spike Pipeline (new)**

Add as a new top-level section after Section 11. This section defines spike candidate criteria (REFLECT-08):

1. **Spike candidate triggers:**
   - Pattern with triage.decision = "investigate" (cannot resolve through analysis alone)
   - Pattern with adjusted confidence = "low" after counter-evidence (uncertain pattern)
   - Pattern with weighted score below threshold but close (within 20% -- marginal pattern that needs more data)

2. **Spike candidate output format:**
```markdown
### Spike Candidate: {pattern-name}

**Trigger:** {investigate triage / low-confidence pattern / marginal score}
**Question:** {framed as a testable hypothesis}
**Why a spike:** {why analysis alone is insufficient}
**Suggested experiment:** {what to test}
**Related signals:** {signal IDs}
```

3. **Integration:** Spike candidates appear in the reflection report and can be fed into `/gsd:spike` for investigation. The reflector does NOT create spike files -- it only identifies candidates.

4. **Spike vs lesson distinction:** If the root cause is known and actionable -> lesson. If the root cause is unclear and needs investigation -> spike candidate.

Update the Table of Contents / section numbering as needed.
  </action>
  <verify>
Grep for "Counter-Evidence Seeking" to confirm the new section exists.
Grep for "Reflect-to-Spike Pipeline" to confirm the spike pipeline section exists.
Grep for "3 potential counter-examples" to confirm the bound is documented.
Grep for "investigate" to confirm triage integration with spike pipeline.
  </verify>
  <done>
reflection-patterns.md has Section 2.5 with bounded counter-evidence protocol and a new Section 12 with reflect-to-spike pipeline criteria. Both sections include output formats and integration guidance.
  </done>
</task>

</tasks>

<verification>
1. `grep -c "weighted_score" get-shit-done/references/reflection-patterns.md` returns >= 3
2. `grep "Counter-Evidence Seeking" get-shit-done/references/reflection-patterns.md` returns a match
3. `grep "Reflect-to-Spike Pipeline" get-shit-done/references/reflection-patterns.md` returns a match
4. `grep "3.0\|4.0\|5.0" get-shit-done/references/reflection-patterns.md` returns threshold values
5. No references to old raw count thresholds as primary detection (may retain as historical note)
</verification>

<success_criteria>
reflection-patterns.md v1.2.0 contains confidence-weighted scoring (REFLECT-02), counter-evidence seeking with 3-example bound (REFLECT-03), and reflect-to-spike pipeline criteria (REFLECT-08). These three reference sections provide the detection rules that the reflector agent will implement in Plan 03.
</success_criteria>

<output>
After completion, create `.planning/phases/33-enhanced-reflector/33-01-SUMMARY.md`
</output>
