---
phase: 33-enhanced-reflector
plan: 04
type: execute
wave: 3
depends_on: ["33-01", "33-02", "33-03"]
files_modified:
  - .claude/agents/gsd-reflector.md
  - .claude/get-shit-done/references/reflection-patterns.md
  - .claude/get-shit-done/workflows/reflect.md
  - .claude/agents/kb-templates/lesson.md
autonomous: false

must_haves:
  truths:
    - "Installed .claude/ copies match npm source copies for all 4 modified files"
    - "Running /gsd:reflect produces a lifecycle dashboard as the first output section"
    - "The installed reflector references the updated reflection-patterns.md with confidence-weighted scoring"
  artifacts:
    - path: ".claude/agents/gsd-reflector.md"
      provides: "Installed copy of lifecycle-aware reflector"
      contains: "lifecycle_state"
    - path: ".claude/get-shit-done/references/reflection-patterns.md"
      provides: "Installed copy of confidence-weighted detection rules"
      contains: "weighted_score"
    - path: ".claude/get-shit-done/workflows/reflect.md"
      provides: "Installed copy of lifecycle-aware workflow"
      contains: "Lifecycle Dashboard"
    - path: ".claude/agents/kb-templates/lesson.md"
      provides: "Installed copy of lesson template with evidence_snapshots"
      contains: "evidence_snapshots"
  key_links:
    - from: ".claude/agents/gsd-reflector.md"
      to: "agents/gsd-reflector.md"
      via: "Installer copies source to .claude/"
      pattern: "lifecycle_state"
---

<objective>
Sync all Phase 33 changes to the installed .claude/ runtime directory and verify the enhanced reflector works end-to-end.

Purpose: Per CLAUDE.md, the installed .claude/ directory is what Claude reads at runtime. The npm source directories were modified in Plans 01-03, but the runtime copies are stale. This plan runs the installer to sync, then provides a human verification checkpoint to confirm the reflector produces lifecycle-aware output.

Output: Synced .claude/ runtime directory and verified reflector behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-enhanced-reflector/33-01-SUMMARY.md
@.planning/phases/33-enhanced-reflector/33-02-SUMMARY.md
@.planning/phases/33-enhanced-reflector/33-03-SUMMARY.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run installer to sync source to .claude/ runtime directory</name>
  <files>.claude/agents/gsd-reflector.md, .claude/get-shit-done/references/reflection-patterns.md, .claude/get-shit-done/workflows/reflect.md, .claude/agents/kb-templates/lesson.md</files>
  <action>
Run `node bin/install.js --local` to copy npm source files to the .claude/ runtime directory.

After install, verify that all 4 Phase 33 modified files were synced:

1. Compare key content between source and installed copies:
   - `grep "weighted_score" .claude/get-shit-done/references/reflection-patterns.md` should match
   - `grep "lifecycle_state" .claude/agents/gsd-reflector.md` should match
   - `grep "Lifecycle Dashboard" .claude/get-shit-done/workflows/reflect.md` should match
   - `grep "evidence_snapshots" .claude/agents/kb-templates/lesson.md` should match

2. Verify path conversion: installed files should use `./.claude/` paths (local prefix), not `~/.claude/` (global prefix). Check that the installer's `replacePathsInContent()` properly converted paths.

3. Check that no source file was accidentally skipped by the installer. If any file shows stale content, investigate installer copy list.
  </action>
  <verify>
`node bin/install.js --local` completes without errors.
All 4 grep checks return matches.
`diff <(grep "weighted_score" agents/gsd-reflector.md 2>/dev/null || true) <(grep "weighted_score" .claude/agents/gsd-reflector.md 2>/dev/null || true)` shows no semantic difference (path prefixes may differ due to installer conversion).
  </verify>
  <done>
All 4 Phase 33 source files synced to .claude/ runtime directory via installer. Path conversion applied correctly. Installed copies contain all Phase 33 enhancements.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify reflector produces lifecycle-aware output</name>
  <files>N/A (verification only)</files>
  <action>
Human verifies that the enhanced reflector produces lifecycle-aware output by running /gsd:reflect in a fresh session. This is a checkpoint -- no automated action beyond presenting verification steps.

What was built: Enhanced reflector with lifecycle awareness, confidence-weighted pattern detection, triage proposals, lesson distillation with evidence snapshots, remediation suggestions, lifecycle dashboard, and spike candidate identification. All implemented across 4 files: reflection-patterns.md, reflect.md workflow, lesson.md template, and gsd-reflector.md agent spec.
  </action>
  <verify>
1. Start a fresh Claude Code session (run `/clear` first)
2. Run `/gsd:reflect` in the project
3. Verify the output includes:
   a. A Lifecycle Dashboard at the top showing signal counts by state. Standard-format signals show as "Untriaged (detected)". SIG-format signals show separately as "Legacy (read-only)" -- NOT inflating the Untriaged count.
   b. Patterns Detected with confidence-weighted scores (not just raw occurrence counts). If fewer than 5 primary patterns, secondary cross-type clustering should activate.
   c. Triage Proposals for detected signal clusters with recommended decisions (address/dismiss/defer/investigate)
   d. Lesson Candidates (should find 5+ patterns, producing 5+ lessons)
   e. Remediation Suggestions for any triaged clusters (only if you approve triage proposals)
   f. Spike Candidates for any low-confidence or investigate patterns
   g. A Phase 34 dependency note after remediation suggestions
4. If in interactive mode, you will be asked to approve/reject triage proposals and lesson candidates
5. In YOLO mode, only `address` and `dismiss` triage decisions auto-approve; `defer` and `investigate` prompt for confirmation
6. Check that the reflector does NOT modify any SIG-format signal files (legacy read-only)
7. Check that approved lessons include evidence_snapshots in their frontmatter
8. Check that the per-run triage cap (10 signals) is respected -- if >10 signals would be triaged, the remainder should be queued
9. Verify the reconstructFrontmatter() roundtrip validation ran before any triage writes (look for roundtrip test output in the reflector's report)
10. After triage writes, run `git diff ~/.gsd/knowledge/signals/` and verify ONLY mutable fields changed (lifecycle_state, triage, lifecycle_log, updated) -- frozen fields must be identical
  </verify>
  <done>
Human confirms the reflector produces lifecycle-aware output with dashboard, confidence-weighted patterns, triage proposals, and lesson candidates. Type "approved" or describe issues.
  </done>
</task>

</tasks>

<verification>
1. `node bin/install.js --local` succeeds
2. All 4 installed files contain Phase 33 content
3. Human verifies reflector output includes lifecycle dashboard, confidence-weighted patterns, triage proposals, and lesson candidates
</verification>

<success_criteria>
Installed runtime files match Phase 33 source changes. Human confirms the reflector produces lifecycle-aware output including dashboard, confidence-weighted patterns, triage proposals, lessons with evidence snapshots, remediation suggestions, and spike candidates.
</success_criteria>

<output>
After completion, create `.planning/phases/33-enhanced-reflector/33-04-SUMMARY.md`
</output>
