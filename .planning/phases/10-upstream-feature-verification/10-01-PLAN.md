---
phase: 10-upstream-feature-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/workflows/new-project.md
autonomous: true

must_haves:
  truths:
    - "The config.json template in new-project.md Step 5 includes gsd_reflect_version, health_check, and devops fields with fork-appropriate defaults"
    - "Running config-set to change workflow.research preserves fork-specific fields (health_check, devops, gsd_reflect_version) in config.json"
    - "The research decision persisted via config-set is readable by subsequent loadConfig() calls"
  artifacts:
    - path: "get-shit-done/workflows/new-project.md"
      provides: "Updated --auto init workflow with fork config fields"
      contains: "gsd_reflect_version"
  key_links:
    - from: "get-shit-done/workflows/new-project.md"
      to: ".planning/config.json"
      via: "Step 5 config template"
      pattern: "health_check"
    - from: "get-shit-done/bin/gsd-tools.js config-set"
      to: ".planning/config.json"
      via: "dot-notation config persistence"
      pattern: "workflow\\.research"
---

<objective>
Fix the --auto mode project initialization to include fork-specific config fields (FEAT-02) and verify that config-set persistence works correctly for research decisions (FEAT-07).

Purpose: The --auto flag is used for CI/CD pipelines and quick project setup. Without fork config fields (health_check, devops, gsd_reflect_version), auto-initialized projects would lack fork features until an upgrade-project migration runs. Config-set persistence is critical because the research decision from new-milestone must survive between sessions.

Output: Updated new-project.md workflow with fork config fields in Step 5, verified config-set round-trip behavior.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-upstream-feature-verification/10-RESEARCH.md
@get-shit-done/workflows/new-project.md
@get-shit-done/workflows/new-milestone.md
@.planning/config.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fork config fields to new-project.md Step 5 config template</name>
  <files>get-shit-done/workflows/new-project.md</files>
  <action>
In `get-shit-done/workflows/new-project.md`, locate Step 5 (Workflow Preferences) where the config.json template is defined (the JSON block showing mode, depth, parallelization, commit_docs, model_profile, workflow).

Add three fork-specific fields to the config.json template, AFTER the existing "workflow" block:

```json
{
  "mode": "yolo|interactive",
  "depth": "quick|standard|comprehensive",
  "parallelization": true|false,
  "commit_docs": true|false,
  "model_profile": "quality|balanced|budget",
  "workflow": {
    "research": true|false,
    "plan_check": true|false,
    "verifier": true|false
  },
  "gsd_reflect_version": "1.13.0",
  "health_check": {
    "frequency": "milestone-only",
    "stale_threshold_days": 7,
    "blocking_checks": false
  },
  "devops": {
    "ci_provider": "none",
    "deploy_target": "none",
    "commit_convention": "freeform",
    "environments": []
  }
}
```

IMPORTANT constraints:
- Use `"gsd_reflect_version": "1.13.0"` as the default (this is the version being released)
- For health_check: `frequency: "milestone-only"` is the safe default (does not block workflows)
- For devops: all "none"/"freeform" defaults (the DevOps detection in Step 5.7 fills real values if not in --auto mode; upgrade-project handles migration later)
- Do NOT modify the Round 1 or Round 2 question blocks -- only the config.json template that follows them
- Do NOT modify gsd-tools.js (fork constraint: separate file, no upstream modifications)
- Verify that new-milestone.md does NOT need the same fix (it uses config-set for individual fields, not bulk config creation)
  </action>
  <verify>
Read the updated new-project.md and confirm:
1. The config.json template in Step 5 includes gsd_reflect_version, health_check, and devops fields
2. The Round 1 and Round 2 AskUserQuestion blocks are unchanged
3. The DevOps detection in Step 5.7 is unchanged (still skips in auto mode)
4. Confirm new-milestone.md does not create config.json from scratch (uses config-set instead) -- no fix needed there
  </verify>
  <done>The new-project.md Step 5 config.json template includes fork-specific fields (gsd_reflect_version, health_check, devops) with sensible defaults, ensuring --auto initialized projects have complete fork configuration from the start</done>
</task>

<task type="auto">
  <name>Task 2: Verify FEAT-07 config-set persistence round-trip</name>
  <files>(verification only, no files modified)</files>
  <action>
Verify that gsd-tools.js config-set correctly persists the research decision and preserves fork-specific fields:

1. Read current .planning/config.json and note all fork-specific fields (health_check, devops, gsd_reflect_version)

2. Run config-set to change workflow.research:
```bash
node get-shit-done/bin/gsd-tools.js config-set workflow.research false
```

3. Read .planning/config.json and verify:
   - workflow.research is now false
   - health_check section is intact (frequency, stale_threshold_days, blocking_checks)
   - devops section is intact (ci_provider, deploy_target, commit_convention, environments)
   - gsd_reflect_version is intact
   - No fields were stripped or corrupted

4. Restore the original value:
```bash
node get-shit-done/bin/gsd-tools.js config-set workflow.research true
```

5. Verify restoration: workflow.research is true, all fork fields still intact

6. Test a fork-specific field round-trip to confirm config-set does not strip unknown fields even when operating on nested paths:
```bash
node get-shit-done/bin/gsd-tools.js config-set workflow.plan_check false
```
Read config.json, confirm health_check/devops/gsd_reflect_version still present. Restore:
```bash
node get-shit-done/bin/gsd-tools.js config-set workflow.plan_check true
```

IMPORTANT: The known behavior is that loadConfig() in gsd-tools.js drops fork fields from its RETURN value, but config-set reads/writes the full JSON file. Verify this distinction: config-set must NOT use loadConfig() for reading before writing (it should use raw JSON.parse).
  </action>
  <verify>
After all config-set operations:
```bash
node -e "const c=JSON.parse(require('fs').readFileSync('.planning/config.json','utf8')); console.log(JSON.stringify({research: c.workflow.research, has_health: !!c.health_check, has_devops: !!c.devops, has_version: !!c.gsd_reflect_version}))"
```
Expected: `{"research":true,"has_health":true,"has_devops":true,"has_version":true}`
  </verify>
  <done>config-set correctly persists workflow.research decisions AND preserves all fork-specific fields (health_check, devops, gsd_reflect_version) without stripping them</done>
</task>

</tasks>

<verification>
1. The config.json template in new-project.md Step 5 includes all 3 fork fields
2. config-set round-trip preserves fork fields
3. No regressions in existing tests: `npx vitest run` and `node --test get-shit-done/bin/gsd-tools.test.js`
</verification>

<success_criteria>
- new-project.md Step 5 config template includes gsd_reflect_version, health_check, devops
- config-set persists workflow.research and preserves fork-specific fields
- All existing tests still pass (117 tests)
</success_criteria>

<output>
After completion, create `.planning/phases/10-upstream-feature-verification/10-01-SUMMARY.md`
</output>
