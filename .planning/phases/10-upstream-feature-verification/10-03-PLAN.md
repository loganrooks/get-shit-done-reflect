---
phase: 10-upstream-feature-verification
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Running gsd-tools.js init with --include state,config returns JSON containing state_content and config_content fields with actual file contents"
    - "Running gsd-tools.js websearch without BRAVE_API_KEY returns a graceful fallback response (available: false)"
    - "Zero instances of upstream branding (get-shit-done-cc without -reflect, thecmdrunner GitHub org) appear in user-visible output across all 7 feature files"
    - "All 117 tests pass (42 fork vitest + 75 upstream node:test)"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "--include flag parsing, Brave Search integration, config-set"
      contains: "parseIncludeFlag"
  key_links:
    - from: "get-shit-done/bin/gsd-tools.js parseIncludeFlag()"
      to: "init JSON output"
      via: "--include argument parsed into file content fields"
      pattern: "_content"
    - from: "get-shit-done/bin/gsd-tools.js cmdWebsearch()"
      to: "Brave Search API"
      via: "BRAVE_API_KEY env var or ~/.gsd/brave_api_key file"
      pattern: "brave_search"
---

<objective>
Verify that the --include flag (FEAT-03) and Brave Search integration (FEAT-04) work correctly in the fork context, then perform a final branding sweep across all 7 features to confirm no upstream branding leaks into user-visible output.

Purpose: FEAT-03 is an infrastructure optimization that eliminates redundant file reads during workflow execution. FEAT-04 provides enhanced research capability. The final branding sweep is the capstone verification ensuring all 7 features are fork-branded -- this is a locked decision from CONTEXT.md that all user-visible output must show GSD Reflect branding.

Output: Verification evidence for FEAT-03 and FEAT-04, plus a clean branding audit across all features.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-upstream-feature-verification/10-RESEARCH.md
@get-shit-done/bin/gsd-tools.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify FEAT-03 --include flag + FEAT-04 Brave Search</name>
  <files>get-shit-done/bin/gsd-tools.js (read)</files>
  <action>
**FEAT-03: --include flag verification**

1. Read gsd-tools.js parseIncludeFlag() function (around line 141-147) and verify:
   - It parses comma-separated values from --include argument
   - Supported types: state, config, roadmap, requirements, context, research, verification, uat
   - Returns an array of include types

2. Verify --include integration in init commands by reading the init handler code:
   - execute-phase init (around line 3623-3632) uses includes
   - plan-phase init uses includes
   - progress init uses includes

3. Run programmatic verification:
```bash
node get-shit-done/bin/gsd-tools.js init execute-phase 10 --include state,config 2>/dev/null
```
Parse the JSON output and verify:
   - state_content field exists and contains actual STATE.md content (should start with "# Project State")
   - config_content field exists and contains actual config.json content (should contain "mode")
   - Other standard init fields are still present (phase, phase_dir, etc.)

4. Test --include with single value:
```bash
node get-shit-done/bin/gsd-tools.js init execute-phase 10 --include state 2>/dev/null
```
Verify state_content exists but config_content does NOT exist (only requested includes returned).

5. Test --include with no value (should not crash):
```bash
node get-shit-done/bin/gsd-tools.js init execute-phase 10 2>/dev/null
```
Verify normal output without _content fields.

**FEAT-04: Brave Search integration verification**

6. Read gsd-tools.js cmdWebsearch() function (around line 2000-2062) and verify:
   - Checks BRAVE_API_KEY env var first
   - Falls back to ~/.gsd/brave_api_key file
   - Makes request to https://api.search.brave.com/res/v1/web/search
   - Returns structured results (title, url, description, age)
   - Graceful fallback when no API key: returns { available: false, reason: "BRAVE_API_KEY not set" }

7. Run graceful fallback test (without API key):
```bash
unset BRAVE_API_KEY && node get-shit-done/bin/gsd-tools.js websearch "test query" 2>/dev/null
```
Verify output contains "available" and "false" (or similar graceful error).

8. Verify agent documentation references both search paths:
```bash
grep -n 'Brave\|brave\|websearch\|WebSearch' agents/gsd-phase-researcher.md agents/gsd-project-researcher.md
```
Both agents should mention Brave Search and built-in WebSearch fallback.

9. Verify init commands report brave_search_available:
```bash
node get-shit-done/bin/gsd-tools.js init new-project 2>/dev/null | grep -o '"brave_search[^"]*"[^,}]*'
```
Should show brave_search_available field (true or false depending on key presence).
  </action>
  <verify>
FEAT-03:
- `init --include state,config` returns JSON with state_content and config_content
- `init --include state` returns state_content but NOT config_content
- `init` without --include returns normal output without _content fields

FEAT-04:
- websearch without API key returns graceful fallback
- Agent docs reference both Brave Search and WebSearch fallback
- Init commands include brave_search_available field
  </verify>
  <done>--include flag correctly adds requested file contents to init JSON output (verified with state, config, single/multiple/no includes); Brave Search gracefully falls back without API key and agent docs reference both search paths</done>
</task>

<task type="auto">
  <name>Task 2: Final branding sweep + test suite validation</name>
  <files>(all feature-related files, read-only scan)</files>
  <action>
**Branding sweep across all 7 features:**

Perform a comprehensive search for upstream branding that could leak into user-visible output.

1. Search for upstream package name without -reflect suffix:
```bash
grep -rn 'get-shit-done-cc' --include='*.md' --include='*.js' get-shit-done/workflows/ commands/gsd/ hooks/ agents/ | grep -v 'reflect'
```
Expected: zero results (all references should be get-shit-done-reflect-cc)

2. Search for upstream GitHub org in user-visible files:
```bash
grep -rn 'thecmdrunner' --include='*.md' --include='*.js' get-shit-done/workflows/ commands/gsd/ hooks/ agents/
```
Expected: zero results (all should reference loganrooks)

3. Search for upstream Discord/community links:
```bash
grep -rn 'discord\.gg\|discord\.com' --include='*.md' commands/gsd/ get-shit-done/workflows/
```
Expected: zero results (fork uses GitHub Discussions via /gsd:community)

4. Verify fork identity in key feature files:
- get-shit-done/workflows/update.md: all references use get-shit-done-reflect-cc and loganrooks/get-shit-done-reflect
- get-shit-done/workflows/new-project.md: no upstream package references in user-visible output
- hooks/gsd-check-update.js: uses get-shit-done-reflect-cc
- commands/gsd/reapply-patches.md: no upstream branding
- commands/gsd/help.md or get-shit-done/workflows/help.md: uses fork name

5. If any upstream branding is found in user-visible output: FIX IT by replacing with fork equivalent. If found only in code comments or internal documentation: note but do not fix (those are upstream reference comments, acceptable).

**Test suite validation:**

6. Run fork test suite:
```bash
npx vitest run
```
All 42 fork tests must pass.

7. Run upstream test suite:
```bash
node --test get-shit-done/bin/gsd-tools.test.js
```
All 75 upstream tests must pass.

8. Report total test count and any failures.

**Summary compilation:**

9. Create a verification matrix documenting the result for each FEAT:

| Feature | Status | Evidence | Branding |
|---------|--------|----------|----------|
| FEAT-01 | Verified/Fixed | [key evidence] | Clean |
| FEAT-02 | Fixed | [what changed] | Clean |
| FEAT-03 | Verified | [test output] | N/A (infrastructure) |
| FEAT-04 | Verified | [test output] | N/A (generic) |
| FEAT-05 | Verified | [branding check] | Clean |
| FEAT-06 | Verified | [parser test] | N/A (generic) |
| FEAT-07 | Verified | [round-trip test] | N/A (generic) |
  </action>
  <verify>
1. Zero instances of upstream branding in user-visible output (all greps return empty)
2. 42 fork tests pass (npx vitest run)
3. 75 upstream tests pass (node --test gsd-tools.test.js)
4. Verification matrix complete for all 7 features
  </verify>
  <done>All 7 upstream features verified working in fork context with clean branding; zero upstream branding leaks in user-visible output; 117 tests passing (42 fork + 75 upstream)</done>
</task>

</tasks>

<verification>
1. --include flag returns file contents in init JSON output
2. Brave Search falls back gracefully without API key
3. Zero upstream branding in user-visible output across all features
4. All 117 tests pass
</verification>

<success_criteria>
- FEAT-03: --include returns requested file contents in init output
- FEAT-04: Brave Search graceful fallback confirmed
- Branding: zero upstream package names/URLs/community links in user-visible output
- Tests: 42 fork + 75 upstream tests all passing
</success_criteria>

<output>
After completion, create `.planning/phases/10-upstream-feature-verification/10-03-SUMMARY.md`
</output>
