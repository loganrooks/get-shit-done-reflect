---
phase: 12-release-dogfooding
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - ~/.claude/gsd-knowledge/lessons/**/*.md
  - ~/.claude/gsd-knowledge/index.md
  - .planning/phases/12-release-dogfooding/KB-COMPARISON.md
autonomous: true

must_haves:
  truths:
    - "At least one lesson exists specifically about the upstream sync process, actionable for future v1.14+ sync operations"
    - "Running /gsd:reflect has produced a reflection report distilling the v1.13 experience"
    - "A KB comparison document exists grounding file-based vs MCP-based approaches in actual production data from this milestone"
  artifacts:
    - path: "~/.claude/gsd-knowledge/lessons/"
      provides: "Lesson files distilled from v1.13 signals"
      contains: "type: lesson"
    - path: ".planning/phases/12-release-dogfooding/KB-COMPARISON.md"
      provides: "Side-by-side comparison of file-based KB vs upstream MCP Memory"
      min_lines: 80
    - path: "~/.claude/gsd-knowledge/index.md"
      provides: "Updated index with lessons"
      contains: "Lessons"
  key_links:
    - from: "~/.claude/gsd-knowledge/signals/get-shit-done-reflect/"
      to: "~/.claude/gsd-knowledge/lessons/"
      via: "/gsd:reflect pattern detection"
      pattern: "evidence:.*sig-"
    - from: "KB-COMPARISON.md"
      to: "~/.claude/gsd-knowledge/index.md"
      via: "cites actual signal/lesson counts as evidence"
      pattern: "signal|lesson|knowledge base"
---

<objective>
Generate lessons from the approved signals using /gsd:reflect, then write the KB comparison document grounding the file-based vs MCP-based approach in actual production data.

Purpose: This closes the self-improvement loop -- signals become actionable lessons. The KB comparison document (DOG-04) provides an evidence-based analysis of the fork's knowledge base approach vs upstream's reverted MCP Memory approach. Both artifacts use real data from this milestone.

Output: Lesson files in KB, reflection report, and KB-COMPARISON.md in the phase directory.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-release-dogfooding/12-CONTEXT.md
@.planning/phases/12-release-dogfooding/12-RESEARCH.md
@.planning/phases/12-release-dogfooding/12-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate lessons and run reflection</name>
  <files>~/.claude/gsd-knowledge/lessons/**/*.md, ~/.claude/gsd-knowledge/index.md</files>
  <action>
1. **Run `/gsd:reflect`** to detect patterns across the collected signals and generate lessons.
   - The reflector reads all signals under `~/.claude/gsd-knowledge/signals/get-shit-done-reflect/`
   - It clusters signals by signal_type + overlapping tags
   - It generates lesson files for qualifying patterns (2+ signals with shared tags)
   - It updates the KB index via `kb-rebuild-index.sh`

2. **Verify the required upstream sync lesson exists.** SC2 requires "at least one lesson about the upstream sync process." Check if the reflection produced one:
   - Search lesson files for tags containing `upstream-sync` or `merge`
   - If no sync-related lesson was generated (pattern detection thresholds not met), create one manually using the lesson template at `.claude/agents/kb-templates/lesson.md`
   - Manual lesson content should synthesize the conflict prediction accuracy signal and the traditional merge strategy signal into an actionable recommendation for future sync operations (v1.14+)

3. **Manual lesson creation (if needed):**
   - ID: `les-2026-02-11-upstream-sync-strategy`
   - Category: `workflow`
   - Tags: `[upstream-sync, merge, conflict-prediction, fork-maintenance, git-strategy]`
   - Durability: `principle`
   - Evidence: reference the relevant signal IDs
   - Lesson: "For fork synchronization with upstream, use traditional merge (not rebase) when fork has 100+ commits and 10+ modified upstream files. Predict conflicts by analyzing same-line edits rather than same-file modifications -- git's 3-way merge handles spatially separated changes automatically."
   - When this applies: "Planning and executing upstream sync operations for large forks"
   - Recommendation: concrete steps for future v1.14+ syncs

4. **After reflection completes**, verify:
   - `ls ~/.claude/gsd-knowledge/lessons/` -- should show at least one lesson directory with files
   - `grep -l "upstream-sync" ~/.claude/gsd-knowledge/lessons/**/*.md` -- should find the sync lesson
   - `grep "Lessons" ~/.claude/gsd-knowledge/index.md` -- index should list the new lessons

5. **Record the signal count and lesson count** for use in the KB comparison doc and changelog:
   - Total signals: `ls ~/.claude/gsd-knowledge/signals/get-shit-done-reflect/ | wc -l`
   - Total lessons: count lesson files in `~/.claude/gsd-knowledge/lessons/`
  </action>
  <verify>
Run: `ls ~/.claude/gsd-knowledge/lessons/` -- should show lesson category directories with files.
Run: `grep "upstream-sync\|merge" ~/.claude/gsd-knowledge/index.md` -- should show at least one lesson with sync-related tags.
The KB index should show updated Lessons count > 0.
  </verify>
  <done>At least one lesson exists about the upstream sync process. Reflection has been run. Signal and lesson counts are known for use in downstream tasks.</done>
</task>

<task type="auto">
  <name>Task 2: Write KB comparison document</name>
  <files>.planning/phases/12-release-dogfooding/KB-COMPARISON.md</files>
  <action>
Create `.planning/phases/12-release-dogfooding/KB-COMPARISON.md` with a side-by-side comparison of the fork's file-based knowledge base vs upstream's reverted MCP-based GSD Memory.

**Structure the document with these sections:**

1. **Overview** -- What is being compared and why (file-based KB shipped in v1.8.0 vs MCP Memory added in upstream v1.11.2, reverted in v1.11.3)

2. **Comparison table** covering these dimensions (from CONTEXT.md locked decision):

| Dimension | File-Based KB (gsd-reflect) | MCP-Based GSD Memory (upstream) |
|-----------|----------------------------|----------------------------------|
| Persistence model | Markdown files with YAML frontmatter in ~/.claude/gsd-knowledge/ | MCP server with TypeScript, QMD search |
| Portability | Files travel with user's home dir, work across machines via dotfile sync | Requires MCP server running, server-specific config |
| Tooling requirements | Shell script (kb-rebuild-index.sh) + grep | MCP server process + QMD search library |
| Context window impact | Lazy-load index (~50 lines) + on-demand reads of specific entries | MCP tool calls consume context per interaction |
| Actual utility this milestone | [cite actual signal/lesson counts from Task 1] | Upstream reverted before real usage |
| Failure modes | Missing rebuild script (sig-missing-kb-rebuild-index-script), namespace confusion | "Writes but doesn't query" (upstream reversion reason), setup friction |
| Maintenance burden | ~170-line shell script, no dependencies | MCP server upkeep, Node.js dependency, TypeScript build |

3. **Production data from this milestone:**
   - Number of signals collected (from Task 1 output)
   - Number of lessons generated
   - Specific patterns detected and their actionability
   - Where KB was consulted during planning/execution (knowledge surfacing during research phases)
   - Where KB was NOT consulted (missed opportunities)

4. **Analysis of upstream reversion:**
   - Upstream added MCP Memory in v1.11.2 (commit af7a057)
   - Reverted in v1.11.3 (commit cc3c6ac)
   - Stated reason: "writes but doesn't query", setup friction
   - Our analysis: file-based avoids these failure modes because grep/cat are universal (no query engine needed), and files require no server setup

5. **Honest assessment of file-based limitations:**
   - No semantic search (grep is keyword-only)
   - Manual index rebuilding (though scripted)
   - No cross-machine sync without dotfile management
   - Signal detection is rule-based, may miss nuanced patterns
   - Scale limits: unclear how it performs with 1000+ entries

6. **Conclusion:** Objective summary -- not advocacy for our approach, but evidence-based comparison acknowledging tradeoffs of both

**Tone:** Objective, analytical. This is a technical comparison, not marketing.
  </action>
  <verify>
File exists: `.planning/phases/12-release-dogfooding/KB-COMPARISON.md`
File contains comparison table with all 7 evaluation dimensions.
File cites actual signal/lesson counts (not placeholders).
File discusses upstream reversion with commit references.
File acknowledges file-based limitations honestly.
  </verify>
  <done>KB-COMPARISON.md exists with evidence-grounded comparison covering all 7 dimensions from CONTEXT.md, citing actual production data from this milestone, with objective tone acknowledging tradeoffs of both approaches.</done>
</task>

</tasks>

<verification>
- At least one lesson file exists with tags matching `upstream-sync` or `merge`
- KB index shows non-zero lesson count
- KB-COMPARISON.md exists and is substantive (80+ lines)
- KB-COMPARISON.md cites actual signal/lesson counts, not placeholders
- KB-COMPARISON.md references upstream reversion commits (af7a057, cc3c6ac)
</verification>

<success_criteria>
- Lessons generated from signals (at least 1, including upstream sync lesson)
- Reflection has been run (DOG-03 satisfied)
- KB-COMPARISON.md exists with all 7 evaluation dimensions (DOG-04 satisfied)
- Signal and lesson counts are recorded for use in Plan 03 changelog
</success_criteria>

<output>
After completion, create `.planning/phases/12-release-dogfooding/12-02-SUMMARY.md`
</output>
