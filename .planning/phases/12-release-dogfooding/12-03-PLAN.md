---
phase: 12-release-dogfooding
plan: 03
type: execute
wave: 3
depends_on: ["12-02"]
files_modified:
  - package.json
  - package-lock.json
  - get-shit-done/templates/config.json
  - CHANGELOG.md
autonomous: true

must_haves:
  truths:
    - "Version is 1.13.0 in package.json, package-lock.json, config.json template, and CHANGELOG.md"
    - "CHANGELOG.md has a complete v1.13.0 entry documenting the upstream sync, adopted features, bug fixes, and dogfooding results"
    - "An annotated git tag v1.13.0 exists pointing to the version bump commit"
    - "A PR exists from sync/v1.13-upstream to main documenting the full v1.13 work"
  artifacts:
    - path: "package.json"
      provides: "npm package version"
      contains: "\"version\": \"1.13.0\""
    - path: "package-lock.json"
      provides: "Lock file version"
      contains: "\"version\": \"1.13.0\""
    - path: "get-shit-done/templates/config.json"
      provides: "Config template for new projects"
      contains: "\"gsd_reflect_version\": \"1.13.0\""
    - path: "CHANGELOG.md"
      provides: "Release documentation"
      contains: "## [1.13.0]"
  key_links:
    - from: "package.json"
      to: "git tag v1.13.0"
      via: "version field must match tag"
      pattern: "1.13.0"
    - from: "CHANGELOG.md"
      to: ".github/workflows/publish.yml"
      via: "awk extraction of release notes between version headers"
      pattern: "## \\[1.13.0\\]"
    - from: "sync/v1.13-upstream"
      to: "main"
      via: "gh pr create"
      pattern: "--base main --head sync/v1.13-upstream"
---

<objective>
Bump version to 1.13.0 across all locations, write the CHANGELOG.md entry documenting the full v1.13 work, commit, create an annotated git tag, and open a PR from sync/v1.13-upstream to main.

Purpose: This packages the v1.13.0 release. The version bump, changelog, and tag prepare for npm publish (triggered manually via GitHub Release after PR merge). The PR documents the complete v1.13 work (6 phases, 16 plans) in a reviewable record.

Output: Version bumped, changelog written, tag created, PR opened.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-release-dogfooding/12-CONTEXT.md
@.planning/phases/12-release-dogfooding/12-RESEARCH.md
@.planning/phases/12-release-dogfooding/12-02-SUMMARY.md
@CHANGELOG.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Version bump and CHANGELOG entry</name>
  <files>package.json, package-lock.json, get-shit-done/templates/config.json, CHANGELOG.md</files>
  <action>
1. **Bump version in package.json and package-lock.json:**
   ```bash
   npm version 1.13.0 --no-git-tag-version
   ```
   This updates both package.json and package-lock.json version fields.
   Verify: `node -p "require('./package.json').version"` should output `1.13.0`
   Verify: `node -p "require('./package-lock.json').version"` should output `1.13.0`

2. **Update config.json template:**
   Edit `get-shit-done/templates/config.json` and change:
   `"gsd_reflect_version": "1.12.0"` to `"gsd_reflect_version": "1.13.0"`
   (Note: the template currently has "1.12.0", NOT "1.12.2" -- it was set during Phase 10)

3. **Write CHANGELOG.md entry** following the existing conventional format. Insert the new entry between `## [Unreleased]` and `## [1.12.2]`. Use today's date (2026-02-11).

   The entry structure (from locked decision in CONTEXT.md):

   ```markdown
   ## [1.13.0] - 2026-02-11

   ### Added
   - Synced with upstream GSD v1.18.0 (70 commits merged from v1.11.2)
   - Adopted upstream features: --auto mode, --include flag, reapply-patches, JSONC config parsing, update detection (global vs local), parallel research, new-milestone config persistence
   - Adopted thin orchestrator pattern (commands delegate to workflow files)
   - Adopted gsd-tools.js CLI for commits, config, state management
   - Signal tracking validated through production use (X signals collected, Y lessons generated from v1.13 milestone)
   - KB comparison document: file-based knowledge base vs upstream's reverted MCP Memory approach

   ### Changed
   - 6 commands converted to thin orchestrator pattern (new-project, help, update, signal, upgrade-project, community)
   - Fork divergences now tracked explicitly in FORK-DIVERGENCES.md with per-file merge stances
   - Config template updated with v1.13.0 version default
   - CI/CD workflows updated with upstream and fork test steps

   ### Fixed
   - Adopted 11 upstream bug fixes including:
     - Executor verification improvements (prevent false completions)
     - Context fidelity enforcement (accurate file references)
     - API key prevention in committed code
     - Commit docs config flag support
     - Auto-create config directory on first run
     - Statusline crash prevention
     - Subagent type configuration
   - Test suite repaired after architectural migration (135 total tests: 53 vitest + 75 upstream + 7 fork)
   ```

   **IMPORTANT:** Replace X and Y with actual signal and lesson counts from Plan 02's summary. Read `.planning/phases/12-release-dogfooding/12-02-SUMMARY.md` to get the actual numbers.

4. **Commit all version changes together:**
   ```bash
   git add package.json package-lock.json get-shit-done/templates/config.json CHANGELOG.md
   git commit -m "release: v1.13.0 version bump and changelog"
   ```
  </action>
  <verify>
Run: `node -p "require('./package.json').version"` -- output: 1.13.0
Run: `node -p "require('./package-lock.json').version"` -- output: 1.13.0
Run: `grep gsd_reflect_version get-shit-done/templates/config.json` -- contains 1.13.0
Run: `grep "## \[1.13.0\]" CHANGELOG.md` -- entry exists
Run: `git log --oneline -1` -- shows release commit
  </verify>
  <done>All four files updated to version 1.13.0. CHANGELOG.md has complete v1.13.0 entry with Added/Changed/Fixed sections citing actual signal/lesson counts. Changes committed in a single release commit.</done>
</task>

<task type="auto">
  <name>Task 2: Create tag and open PR to main</name>
  <files></files>
  <action>
1. **Create annotated git tag** on the version bump commit:
   ```bash
   git tag -a v1.13.0 -m "v1.13.0: Synced with upstream GSD v1.18.0

   Merged 70 upstream commits (v1.11.2 to v1.18.0), adopted thin
   orchestrator pattern and gsd-tools CLI, resolved 8 merge conflicts,
   validated gsd-reflect knowledge base through production dogfooding."
   ```

2. **Verify tag:**
   ```bash
   git tag -l "v1.13.0"  # should show v1.13.0
   git show v1.13.0 --quiet  # should show tag info + tagged commit
   ```

3. **Push the branch and tag to remote:**
   ```bash
   git push origin sync/v1.13-upstream
   git push origin v1.13.0
   ```

4. **Create PR from sync/v1.13-upstream to main:**
   Use `gh pr create` with a comprehensive description summarizing the full v1.13 work. Reference key artifacts.

   ```bash
   gh pr create \
     --base main \
     --head sync/v1.13-upstream \
     --title "v1.13.0: Sync with upstream GSD v1.18.0" \
     --body "$(cat <<'EOF'
   ## Summary

   - Merged 70 upstream commits (v1.11.2 to v1.18.0) into the fork
   - Resolved 8 merge conflicts using a principled tracked-modifications strategy
   - Adopted thin orchestrator pattern and gsd-tools.js CLI
   - Adopted 11 upstream bug fixes and 7 features
   - Validated gsd-reflect KB through production dogfooding (signals, lessons, reflection)
   - All tests passing (53 vitest + 75 upstream + 7 fork = 135 total)

   ## Phases

   | Phase | Description | Plans |
   |-------|-------------|-------|
   | 7 | Fork Strategy & Pre-Merge Setup | 2 |
   | 8 | Core Merge & Conflict Resolution | 4 |
   | 9 | Architecture Adoption & Verification | 3 |
   | 10 | Upstream Feature Verification | 3 |
   | 11 | Test Suite Repair & CI/CD Validation | 3 |
   | 12 | Release & Dogfooding | 3 |

   ## Key Artifacts

   - [Fork Strategy](.planning/FORK-STRATEGY.md)
   - [Fork Divergences](.planning/FORK-DIVERGENCES.md)
   - [Merge Report](.planning/phases/08-core-merge/08-MERGE-REPORT.md)
   - [Architecture Audit](.planning/phases/09-architecture-adoption/09-AUDIT-REPORT.md)
   - [KB Comparison](.planning/phases/12-release-dogfooding/KB-COMPARISON.md)

   ## Test Plan

   - [ ] CI passes (vitest, upstream tests, fork tests)
   - [ ] Version is 1.13.0 in package.json, package-lock.json, config template
   - [ ] CHANGELOG.md has complete v1.13.0 entry
   - [ ] Tag v1.13.0 exists and points to release commit

   ## Release

   After merge, create a GitHub Release from tag v1.13.0 to trigger npm publish.

   Generated with Claude Code
   EOF
   )"
   ```

5. **Capture the PR URL** for the summary.
  </action>
  <verify>
Run: `git tag -l "v1.13.0"` -- should show v1.13.0
Run: `gh pr list --head sync/v1.13-upstream --base main` -- should show the open PR
Run: `gh pr view --json url` -- should return the PR URL
  </verify>
  <done>Annotated tag v1.13.0 exists on the release commit. PR from sync/v1.13-upstream to main is open with comprehensive description. Branch and tag are pushed to remote.</done>
</task>

</tasks>

<verification>
- `node -p "require('./package.json').version"` outputs `1.13.0`
- `node -p "require('./package-lock.json').version"` outputs `1.13.0`
- Config template has `gsd_reflect_version: 1.13.0`
- CHANGELOG.md has `## [1.13.0] - 2026-02-11` entry with Added/Changed/Fixed sections
- Tag `v1.13.0` exists as annotated tag
- PR is open from sync/v1.13-upstream to main
- All tests still pass: `npx vitest run && node --test get-shit-done/bin/gsd-tools.test.js`
</verification>

<success_criteria>
- Version 1.13.0 set in all 4 locations (SC5 satisfied)
- CHANGELOG documents the sync with upstream v1.18.0 (SC5 satisfied)
- Tag v1.13.0 created (release preparation complete)
- PR opened to main (release flow initiated)
- npm publish deferred to manual CI trigger after merge (as decided)
</success_criteria>

<output>
After completion, create `.planning/phases/12-release-dogfooding/12-03-SUMMARY.md`
</output>
