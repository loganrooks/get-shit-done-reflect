---
phase: 14-knowledge-base-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/references/knowledge-surfacing.md
  - get-shit-done/references/signal-detection.md
  - get-shit-done/references/health-check.md
  - get-shit-done/references/spike-execution.md
  - get-shit-done/references/reflection-patterns.md
  - get-shit-done/workflows/health-check.md
  - get-shit-done/workflows/collect-signals.md
  - get-shit-done/workflows/reflect.md
  - get-shit-done/workflows/signal.md
  - .claude/agents/gsd-signal-collector.md
  - .claude/agents/gsd-debugger.md
  - .claude/agents/gsd-phase-researcher.md
  - .claude/agents/gsd-reflector.md
  - .claude/agents/knowledge-store.md
  - .claude/agents/gsd-executor.md
  - .claude/agents/gsd-planner.md
  - .claude/agents/gsd-spike-runner.md
  - .claude/agents/kb-create-dirs.sh
  - .claude/agents/kb-rebuild-index.sh
  - .claude/agents/kb-templates/spike-decision.md
  - tests/unit/install.test.js
  - tests/integration/kb-infrastructure.test.js
  - tests/integration/kb-write.test.js
  - tests/e2e/real-agent.test.js
  - tests/smoke/run-smoke.sh
  - tests/benchmarks/tasks/standard-signal.js
autonomous: true

must_haves:
  truths:
    - "All source files in get-shit-done/ reference ~/.gsd/knowledge/ instead of ~/.claude/gsd-knowledge/"
    - "All agent files in .claude/agents/ reference ~/.gsd/knowledge/ instead of ~/.claude/gsd-knowledge/"
    - "Shell scripts use ${GSD_HOME:-$HOME/.gsd}/knowledge pattern for GSD_HOME support"
    - "All test files use .gsd/knowledge path structure instead of .claude/gsd-knowledge"
    - "Existing tests still pass after path updates"
  artifacts:
    - path: "get-shit-done/references/knowledge-surfacing.md"
      provides: "KB path references"
      contains: "~/.gsd/knowledge/"
    - path: "get-shit-done/workflows/signal.md"
      provides: "Signal workflow KB references"
      contains: "~/.gsd/knowledge/"
    - path: ".claude/agents/kb-create-dirs.sh"
      provides: "KB directory creation script"
      contains: "${GSD_HOME:-$HOME/.gsd}/knowledge"
    - path: ".claude/agents/kb-rebuild-index.sh"
      provides: "KB index rebuild script"
      contains: "${GSD_HOME:-$HOME/.gsd}/knowledge"
    - path: "tests/unit/install.test.js"
      provides: "Installer tests with updated KB paths"
      contains: ".gsd/knowledge"
  key_links:
    - from: "get-shit-done/workflows/signal.md"
      to: "~/.gsd/knowledge/"
      via: "KB path references in bash code blocks"
      pattern: "~/.gsd/knowledge/"
    - from: ".claude/agents/kb-create-dirs.sh"
      to: "${GSD_HOME:-$HOME/.gsd}/knowledge"
      via: "Shell variable expansion"
      pattern: "GSD_HOME:-\\$HOME/\\.gsd"
    - from: "tests/integration/kb-infrastructure.test.js"
      to: ".gsd/knowledge"
      via: "Test path construction"
      pattern: "\\.gsd.*knowledge"
---

<objective>
Update all source file references from ~/.claude/gsd-knowledge/ to ~/.gsd/knowledge/ across the entire codebase (get-shit-done/ workflows and references, .claude/agents/ specs and shell scripts, and all test files).

Purpose: After this plan, source files reflect the canonical runtime-agnostic KB path. The installer's Pass 1 regex (from Phase 13) becomes a no-op safety guard since source files already use the new path. This is prerequisite to Plan 02 which adds actual migration logic to the installer.

Output: 26 files updated with 110 path reference replacements (35 in get-shit-done/, 24 in .claude/agents/, 51 in tests), all existing tests passing.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-knowledge-base-migration/14-RESEARCH.md
@.planning/phases/13-path-abstraction-capability-matrix/13-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update all get-shit-done/ and .claude/agents/ source files</name>
  <files>
    get-shit-done/references/knowledge-surfacing.md
    get-shit-done/references/signal-detection.md
    get-shit-done/references/health-check.md
    get-shit-done/references/spike-execution.md
    get-shit-done/references/reflection-patterns.md
    get-shit-done/workflows/health-check.md
    get-shit-done/workflows/collect-signals.md
    get-shit-done/workflows/reflect.md
    get-shit-done/workflows/signal.md
    .claude/agents/gsd-signal-collector.md
    .claude/agents/gsd-debugger.md
    .claude/agents/gsd-phase-researcher.md
    .claude/agents/gsd-reflector.md
    .claude/agents/knowledge-store.md
    .claude/agents/gsd-executor.md
    .claude/agents/gsd-planner.md
    .claude/agents/gsd-spike-runner.md
    .claude/agents/kb-create-dirs.sh
    .claude/agents/kb-rebuild-index.sh
    .claude/agents/kb-templates/spike-decision.md
  </files>
  <action>
    Replace all KB path references in 20 source files (9 in get-shit-done/, 11 in .claude/agents/).

    **Two replacement patterns:**

    1. **Tilde variant** (most common -- ~54 occurrences across 18 files):
       - BEFORE: `~/.claude/gsd-knowledge/`
       - AFTER: `~/.gsd/knowledge/`
       - Also handle partial matches without trailing slash: `~/.claude/gsd-knowledge` -> `~/.gsd/knowledge`

    2. **$HOME variant** (5 occurrences across 5 files -- CRITICAL, do not miss):
       - In markdown prose bash code blocks (3 files: reflect.md, health-check.md, reflection-patterns.md):
         - BEFORE: `$HOME/.claude/gsd-knowledge`
         - AFTER: `$HOME/.gsd/knowledge`
       - In shell scripts (2 files: kb-create-dirs.sh, kb-rebuild-index.sh):
         - BEFORE: `$HOME/.claude/gsd-knowledge`
         - AFTER: `${GSD_HOME:-$HOME/.gsd}/knowledge`
         - WHY: Shell scripts support GSD_HOME override; markdown prose does not (per research recommendation)

    **For shell scripts specifically (kb-create-dirs.sh and kb-rebuild-index.sh):**
    - Replace `KB_DIR="$HOME/.claude/gsd-knowledge"` with `KB_DIR="${GSD_HOME:-$HOME/.gsd}/knowledge"`
    - This enables the GSD_HOME environment variable override at the shell level

    **For markdown $HOME references (reflect.md, health-check.md, reflection-patterns.md):**
    - Replace `$HOME/.claude/gsd-knowledge` with `$HOME/.gsd/knowledge`
    - Do NOT add GSD_HOME to markdown prose -- it's a power-user feature documented elsewhere

    **Do NOT modify:**
    - `.planning/` files (historical records)
    - `bin/install.js` (Pass 1 regex stays as safety guard; Plan 02 handles installer changes)
    - Any file not in the explicit list above

    **Approach:** Read each file, apply replacements, write back. Process all 20 files. After all replacements, verify zero remaining old-path references with grep.
  </action>
  <verify>
    Run these grep checks (all should return 0 matches):
    ```
    grep -r 'gsd-knowledge' get-shit-done/ --include='*.md' | grep -v '.gsd/knowledge' | wc -l
    grep -r 'gsd-knowledge' .claude/agents/ | grep -v '.gsd/knowledge' | wc -l
    ```
    Both must return 0.

    Positive check (should return matches):
    ```
    grep -r '~/.gsd/knowledge' get-shit-done/ --include='*.md' | wc -l
    ```
    Should return 30+ matches.

    Shell script GSD_HOME check:
    ```
    grep 'GSD_HOME' .claude/agents/kb-create-dirs.sh
    grep 'GSD_HOME' .claude/agents/kb-rebuild-index.sh
    ```
    Both must return a match containing `${GSD_HOME:-$HOME/.gsd}/knowledge`.
  </verify>
  <done>
    All 20 source files updated: 35 occurrences in get-shit-done/ and 24 occurrences in .claude/agents/ replaced. Zero remaining ~/.claude/gsd-knowledge references in source files. Shell scripts support GSD_HOME override.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update all test files and verify test suite passes</name>
  <files>
    tests/unit/install.test.js
    tests/integration/kb-infrastructure.test.js
    tests/integration/kb-write.test.js
    tests/e2e/real-agent.test.js
    tests/smoke/run-smoke.sh
    tests/benchmarks/tasks/standard-signal.js
  </files>
  <action>
    Update KB path references in all 6 test files (51 total occurrences).

    **Per-file guidance:**

    1. **tests/unit/install.test.js** (21 occurrences):
       - Replace `.claude/gsd-knowledge` path constructions with `.gsd/knowledge`
       - These are typically `path.join(tmpdir, '.claude', 'gsd-knowledge')` -> `path.join(tmpdir, '.gsd', 'knowledge')`
       - Also update string literals like `'gsd-knowledge'` when used in path assertions
       - IMPORTANT: These tests verify the installer's two-pass replacement. After source files use `~/.gsd/knowledge/`, the Pass 1 regex becomes a no-op. Update test expectations accordingly:
         - Tests checking Pass 1 replacement should verify that `~/.gsd/knowledge/` passes through unchanged (no-op behavior)
         - Tests checking Pass 2 replacement should still verify `~/.claude/` -> runtime prefix
         - Tests that construct old KB paths for test fixtures should use new `.gsd/knowledge` paths

    2. **tests/integration/kb-infrastructure.test.js** (13 occurrences):
       - Replace `path.join(tmpdir, '.claude', 'gsd-knowledge')` with `path.join(tmpdir, '.gsd', 'knowledge')`
       - These tests validate the KB shell scripts (kb-create-dirs.sh, kb-rebuild-index.sh)
       - Since Task 1 updated the scripts to use `${GSD_HOME:-$HOME/.gsd}/knowledge`, tests must:
         a. Set `GSD_HOME` env var to point at tmpdir-based `.gsd` location, OR
         b. Set `HOME` env var to tmpdir and use the `$HOME/.gsd/knowledge` default
       - Prefer option (b) for consistency with existing test patterns

    3. **tests/integration/kb-write.test.js** (7 occurrences):
       - Replace `gsd-knowledge` path segments with `.gsd/knowledge` structure
       - Check whether paths use `.claude/gsd-knowledge` or just `gsd-knowledge` (relative)
       - Update to use `.gsd/knowledge` for consistency

    4. **tests/e2e/real-agent.test.js** (1 occurrence):
       - Single reference, likely a path construction -- update to `.gsd/knowledge`

    5. **tests/smoke/run-smoke.sh** (8 occurrences):
       - Shell script: replace `gsd-knowledge` path references
       - If using `$HOME/.claude/gsd-knowledge`, update to `$HOME/.gsd/knowledge`

    6. **tests/benchmarks/tasks/standard-signal.js** (1 occurrence):
       - Single reference -- update to `.gsd/knowledge`

    After updating all test files, run the full test suite to verify nothing is broken.
  </action>
  <verify>
    Run grep check (should return 0):
    ```
    grep -r 'gsd-knowledge' tests/ | grep -v '.gsd/knowledge' | grep -v 'node_modules' | wc -l
    ```
    Must return 0.

    Run test suite:
    ```
    npx vitest run tests/unit/install.test.js
    npx vitest run tests/integration/kb-infrastructure.test.js
    npx vitest run tests/integration/kb-write.test.js
    ```
    All tests must pass. If any test references old paths that no longer exist in source, fix the test to match new reality.
  </verify>
  <done>
    All 6 test files updated (51 occurrences). Zero remaining ~/.claude/gsd-knowledge references in test files. Unit and integration tests pass with new path structure.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Zero old references in codebase** (excluding .planning/, bin/install.js):
   ```
   grep -r 'gsd-knowledge' --include='*.md' --include='*.js' --include='*.sh' . | grep -v '.planning/' | grep -v 'bin/install.js' | grep -v 'node_modules' | grep -v '.gsd/knowledge' | wc -l
   ```
   Must return 0.

2. **New references present:**
   ```
   grep -r '~/.gsd/knowledge' get-shit-done/ .claude/agents/ | wc -l
   ```
   Should return 50+ matches.

3. **Tests pass:**
   ```
   npx vitest run
   ```
   Full suite green.

4. **Installer Pass 1 regex unchanged** (safety guard preserved):
   ```
   grep 'gsd-knowledge' bin/install.js
   ```
   Should still show the Pass 1 regex line(s) -- these are intentionally preserved.
</verification>

<success_criteria>
- 110 path references updated across 26 files (35 + 24 + 51)
- Zero remaining old-path references outside of .planning/ and bin/install.js
- Shell scripts support GSD_HOME override via ${GSD_HOME:-$HOME/.gsd}/knowledge
- All existing tests pass with new paths
- Installer's Pass 1 regex preserved as safety guard
</success_criteria>

<output>
After completion, create `.planning/phases/14-knowledge-base-migration/14-01-SUMMARY.md`
</output>
