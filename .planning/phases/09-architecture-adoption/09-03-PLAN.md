---
phase: 09-architecture-adoption
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - commands/gsd/signal.md
  - commands/gsd/upgrade-project.md
  - commands/gsd/join-discord.md
  - get-shit-done/workflows/signal.md
  - get-shit-done/workflows/upgrade-project.md
autonomous: true

must_haves:
  truths:
    - "commands/gsd/signal.md is a thin stub (<50 lines) that delegates to workflows/signal.md via @-reference"
    - "commands/gsd/upgrade-project.md is a thin stub (<50 lines) that delegates to workflows/upgrade-project.md via @-reference"
    - "commands/gsd/join-discord.md is either removed or replaced with a fork-appropriate community command"
    - "get-shit-done/workflows/signal.md contains all 10 signal creation steps from the original command, including KB integration, dedup checking, and cap enforcement"
    - "get-shit-done/workflows/upgrade-project.md contains the version detection, config patching, and migration logging from the original command"
    - "All tests still pass (vitest + gsd-tools.test.js)"
  artifacts:
    - path: "commands/gsd/signal.md"
      provides: "Thin orchestrator stub for signal command"
      contains: "@~/.claude/get-shit-done/workflows/signal.md"
    - path: "get-shit-done/workflows/signal.md"
      provides: "Full signal creation workflow logic"
      contains: "knowledge base"
    - path: "commands/gsd/upgrade-project.md"
      provides: "Thin orchestrator stub for upgrade-project command"
      contains: "@~/.claude/get-shit-done/workflows/upgrade-project.md"
    - path: "get-shit-done/workflows/upgrade-project.md"
      provides: "Full upgrade-project workflow logic"
      contains: "version"
  key_links:
    - from: "commands/gsd/signal.md"
      to: "get-shit-done/workflows/signal.md"
      via: "@-reference in execution_context"
      pattern: "@~/.claude/get-shit-done/workflows/signal\\.md"
    - from: "commands/gsd/upgrade-project.md"
      to: "get-shit-done/workflows/upgrade-project.md"
      via: "@-reference in execution_context"
      pattern: "@~/.claude/get-shit-done/workflows/upgrade-project\\.md"
---

<objective>
Convert the three remaining fork-only commands with inline logic (signal.md, upgrade-project.md, join-discord.md) to the thin orchestrator pattern for architectural consistency with the rest of the codebase. Each command becomes a minimal stub that delegates to a workflow file containing the actual logic.

Purpose: Architectural consistency — all commands follow the same pattern, making the codebase predictable and reducing cognitive overhead.
Output: 2 new workflow files created, 3 command files converted to thin stubs (or removed for join-discord).
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/09-architecture-adoption/09-01-SUMMARY.md
@.planning/phases/09-architecture-adoption/09-AUDIT-REPORT.md
@.planning/phases/09-architecture-adoption/09-RESEARCH.md
@commands/gsd/signal.md
@commands/gsd/upgrade-project.md
@commands/gsd/join-discord.md
@commands/gsd/help.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert signal.md to thin orchestrator pattern</name>
  <files>
    commands/gsd/signal.md
    get-shit-done/workflows/signal.md
  </files>
  <action>
This is the most complex conversion: signal.md has 235 lines of inline logic covering 10 steps of signal creation with KB integration, deduplication, and cap enforcement.

**Step 1: Read the current `commands/gsd/signal.md` completely.** Understand every step of the signal creation process:
- Argument parsing (description, severity)
- Knowledge base directory resolution
- Signal template loading
- Deduplication checking against existing signals
- Cap enforcement (max signals per day/total)
- Signal file creation with metadata
- Commit the new signal file

**Step 2: Create the workflow file `get-shit-done/workflows/signal.md`.**
Move ALL logic from the command into this workflow file. The workflow should contain:
- The complete signal creation process (all steps)
- All @-references to knowledge base agents and templates that the original command used
- The same allowed-tools that the original command needed

Structure the workflow file following the pattern of existing upstream workflows (e.g., look at `get-shit-done/workflows/quick.md` or `get-shit-done/workflows/add-todo.md` for structural patterns). Use clear section headings and step numbering.

Preserve ALL existing @-references from the original command's execution context (knowledge-store.md, signal-detection.md, kb-templates/signal.md, etc.).

**Step 3: Rewrite `commands/gsd/signal.md` as a thin stub.**
Follow the thin orchestrator pattern from the research doc. The stub should be ~20-40 lines:

```markdown
---
name: gsd:signal
description: Log a manual signal observation to the knowledge base
argument-hint: '"description" [--severity critical|notable]'
allowed-tools:
  - Read
  - Write
  - Bash
  - Glob
  - Grep
  - AskUserQuestion
---

<objective>
Create a manual signal entry in the knowledge base.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/signal.md
@~/.claude/agents/knowledge-store.md
@~/.claude/get-shit-done/references/signal-detection.md
</execution_context>

<process>
Execute the signal workflow from @~/.claude/get-shit-done/workflows/signal.md end-to-end.
</process>
```

Adjust the allowed-tools list and execution_context references based on what the actual workflow needs. Include ALL agent and reference files that the workflow depends on.

**Step 4: Verify the conversion.**
- The thin stub is <50 lines
- The workflow file contains all original logic
- All @-references resolve to real files
- No logic was lost in the conversion
  </action>
  <verify>
1. `wc -l commands/gsd/signal.md` shows <50 lines
2. `grep "@~/.claude/get-shit-done/workflows/signal.md" commands/gsd/signal.md` returns a match
3. `wc -l get-shit-done/workflows/signal.md` shows >100 lines (logic was moved, not deleted)
4. `grep "knowledge base" get-shit-done/workflows/signal.md` returns matches (KB integration preserved)
5. All @-references in the stub point to existing files
  </verify>
  <done>signal.md is a thin stub delegating to workflows/signal.md. All 10 steps of signal creation logic, including KB integration, dedup checking, and cap enforcement, are preserved in the workflow file.</done>
</task>

<task type="auto">
  <name>Task 2: Convert upgrade-project.md and handle join-discord.md</name>
  <files>
    commands/gsd/upgrade-project.md
    get-shit-done/workflows/upgrade-project.md
    commands/gsd/join-discord.md
  </files>
  <action>
**Part A: Convert upgrade-project.md**

**Step 1: Read the current `commands/gsd/upgrade-project.md` completely.** Understand its logic:
- Version detection (current vs available)
- Config patching for new settings
- Migration logging
- User notification of changes

**Step 2: Create `get-shit-done/workflows/upgrade-project.md`.**
Move ALL logic from the command into this workflow file. Follow the same structural patterns as other upstream workflow files (clear sections, step numbering, references).

**Step 3: Rewrite `commands/gsd/upgrade-project.md` as a thin stub.**
Follow the thin orchestrator pattern:

```markdown
---
name: gsd:upgrade-project
description: Upgrade an existing GSD Reflect project to the latest version
argument-hint: '[--check]'
allowed-tools:
  - Read
  - Write
  - Bash
  - Glob
  - Grep
---

<objective>
Upgrade the current project's GSD Reflect configuration to the latest version.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/upgrade-project.md
</execution_context>

<process>
Execute the upgrade workflow from @~/.claude/get-shit-done/workflows/upgrade-project.md end-to-end.
</process>
```

Adjust allowed-tools and execution_context based on what the actual workflow needs.

**Part B: Handle join-discord.md**

The current `join-discord.md` (18 lines) directs users to the upstream Discord server. The fork needs to either:

1. **Replace with fork community command:** If the fork has a community channel (GitHub Discussions), rewrite the command to direct users there. Rename to `community.md` or keep as `join-discord.md` — Claude's judgment.

2. **Remove entirely:** If no fork community exists, delete the command. Also update `get-shit-done/workflows/help.md` to remove any reference to the join-discord command.

**Recommended approach:** Replace with a `community.md` command that directs to GitHub Discussions (`https://github.com/loganrooks/get-shit-done-reflect/discussions`). This is a thin stub pointing to a brief workflow or just inline since it's so short (keeping inline is acceptable for a 10-line "open this URL" command).

After conversion, verify:
```bash
# Check join-discord is handled
ls commands/gsd/join-discord.md 2>/dev/null
# Check help workflow doesn't reference dead command
grep -n "discord\|join-discord" get-shit-done/workflows/help.md
```

**Part C: Run regression tests**
```bash
npx vitest run
node --test get-shit-done/bin/gsd-tools.test.js
```
Both must pass. The command conversions are structural changes to markdown files — they should not affect JavaScript tests. But verify anyway.
  </action>
  <verify>
1. `wc -l commands/gsd/upgrade-project.md` shows <50 lines
2. `grep "@~/.claude/get-shit-done/workflows/upgrade-project.md" commands/gsd/upgrade-project.md` returns a match
3. `wc -l get-shit-done/workflows/upgrade-project.md` shows >50 lines (logic was moved)
4. join-discord.md is either replaced with a fork community command or deleted
5. `grep "discord\.gg" commands/gsd/ get-shit-done/workflows/` returns zero hits
6. `npx vitest run` passes (42 tests)
7. `node --test get-shit-done/bin/gsd-tools.test.js` passes (75 tests)
  </verify>
  <done>upgrade-project.md is a thin stub delegating to workflows/upgrade-project.md. join-discord.md is replaced/removed with fork-appropriate community reference. All tests pass — zero regressions.</done>
</task>

</tasks>

<verification>
1. All 3 converted commands follow the thin orchestrator pattern (<50 line stubs with @workflow references)
2. New workflow files contain all original logic (no functionality lost)
3. No upstream Discord references remain in command files
4. All @-references in stubs resolve to existing files
5. `npx vitest run` passes
6. `node --test get-shit-done/bin/gsd-tools.test.js` passes
7. Structural check: every file in `commands/gsd/*.md` either has `@~/.claude/get-shit-done/workflows/` reference or is inherently simple
</verification>

<success_criteria>
- Architectural consistency achieved: all fork commands follow the thin orchestrator pattern
- Zero functionality lost during conversion — all logic preserved in workflow files
- No regressions in test suites
- The fork has no upstream Discord references
</success_criteria>

<output>
After completion, create `.planning/phases/09-architecture-adoption/09-03-SUMMARY.md`
</output>
