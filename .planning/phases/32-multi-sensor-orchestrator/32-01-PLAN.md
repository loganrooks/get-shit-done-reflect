---
phase: 32-multi-sensor-orchestrator
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/gsd-artifact-sensor.md
  - agents/gsd-log-sensor.md
  - agents/gsd-signal-collector.md
  - get-shit-done/feature-manifest.json
autonomous: true

must_haves:
  truths:
    - "An artifact sensor agent spec exists that performs all detection logic previously in gsd-signal-collector"
    - "A log sensor agent spec exists as a disabled stub with documented spike question"
    - "The feature manifest has a signal_collection section with per-sensor enabled/model config"
    - "The old gsd-signal-collector.md explains it has been superseded and points to the new agents"
  artifacts:
    - path: "agents/gsd-artifact-sensor.md"
      provides: "Standalone artifact sensor agent spec extracted from gsd-signal-collector"
      contains: "gsd-artifact-sensor"
    - path: "agents/gsd-log-sensor.md"
      provides: "Disabled log sensor stub with spike question"
      contains: "gsd-log-sensor"
    - path: "agents/gsd-signal-collector.md"
      provides: "Deprecation wrapper pointing to new sensor agents"
      contains: "superseded"
    - path: "get-shit-done/feature-manifest.json"
      provides: "signal_collection feature with per-sensor configuration"
      contains: "signal_collection"
  key_links:
    - from: "agents/gsd-artifact-sensor.md"
      to: "get-shit-done/references/signal-detection.md"
      via: "reference import"
      pattern: "signal-detection\\.md"
    - from: "agents/gsd-artifact-sensor.md"
      to: "agents/knowledge-store.md"
      via: "reference import"
      pattern: "knowledge-store\\.md"
    - from: "get-shit-done/feature-manifest.json"
      to: "agents/gsd-artifact-sensor.md"
      via: "sensor configuration schema"
      pattern: "artifact.*enabled"
---

<objective>
Extract the artifact sensor from the existing signal-collector, create a disabled log sensor stub, add sensor configuration to the feature manifest, and update the signal-collector as a deprecation wrapper.

Purpose: Establish the sensor agent infrastructure that the orchestrator (Plan 04) will spawn in parallel. The artifact sensor preserves all existing detection logic. The log sensor and manifest config prepare for future extensibility.
Output: Three agent spec files (artifact sensor, log sensor, updated signal-collector) and extended feature manifest.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@agents/gsd-signal-collector.md
@get-shit-done/feature-manifest.json
@agents/knowledge-store.md
@get-shit-done/references/signal-detection.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract artifact sensor and create log sensor stub</name>
  <files>agents/gsd-artifact-sensor.md, agents/gsd-log-sensor.md</files>
  <action>
**Create `agents/gsd-artifact-sensor.md`:**

Extract from `agents/gsd-signal-collector.md` into a standalone sensor agent. The artifact sensor retains ALL detection logic from the signal-collector (Steps 1-5: load artifacts, load config, detect signals, classify signals, filter traces) but does NOT write to the KB or rebuild the index (Steps 6-9 are removed -- the synthesizer handles KB writes).

Key changes from the original signal-collector:
1. Name: `gsd-artifact-sensor` (not gsd-signal-collector)
2. Description: "Analyzes execution artifacts (PLAN.md, SUMMARY.md, VERIFICATION.md) and returns raw signal candidates as structured JSON"
3. Tools: Read, Bash, Glob, Grep (NO Write -- sensors do not write to KB)
4. Remove Steps 6 (dedup check), 7 (cap check), 8 (write signals), 9 (rebuild index), 10 (report) from the execution flow
5. Add a NEW final step: "Return Results" that returns structured JSON array of raw signal candidates in the format documented in RESEARCH.md Pattern 2:
   ```json
   {
     "sensor": "artifact",
     "phase": {N},
     "signals": [
       {
         "summary": "...",
         "signal_type": "...",
         "signal_category": "...",
         "severity": "...",
         "tags": [...],
         "evidence": { "supporting": [...], "counter": [...] },
         "confidence": "...",
         "confidence_basis": "...",
         "context": { "phase": N, "plan": N, "source_file": "..." }
       }
     ]
   }
   ```
6. Keep all detection rules (deviation SGNL-01, config mismatch SGNL-02, struggle SGNL-03, positive detection)
7. Keep severity auto-assignment (signal-detection.md Section 6) -- sensors classify, synthesizer validates
8. Keep the runtime/model detection from Step 3.0 and include in each signal candidate
9. References section: keep signal-detection.md and knowledge-store.md references; remove kb-templates/signal.md (synthesizer uses that, not sensors)
10. Use `~/` prefix for all paths in the npm source file (installer converts to `./` during install)

The artifact sensor's role: "You are a sensor agent. You analyze execution artifacts and return structured signal candidates. You do NOT write to the knowledge base -- that is the synthesizer's job."

**Create `agents/gsd-log-sensor.md`:**

Create a minimal disabled stub agent. Frontmatter:
```yaml
name: gsd-log-sensor
description: "[DISABLED] Placeholder for future session log analysis -- requires spike to determine log location"
tools: Read, Bash
color: gray
```

Body should include:
1. A `<role>` section explaining this is a disabled stub shipped for future extensibility
2. A `<spike_question>` section documenting: "Where does Claude Code store session logs? What format are they in? Can they be analyzed for signal detection?" -- this is the documented unknown from SENSOR-07
3. A `<when_enabled>` section sketching what the sensor WOULD do (scan session logs for frustration patterns, tool failures, repeated retry loops)
4. The execution flow should be a single step: "Return empty signal array: `{ sensor: 'log', phase: N, signals: [] }`"
5. A clear note: "This sensor is disabled by default in the feature manifest. Enable only after completing a spike to determine session log location and format."
  </action>
  <verify>
Both files exist and have valid frontmatter:
```bash
test -f agents/gsd-artifact-sensor.md && echo "artifact sensor exists"
test -f agents/gsd-log-sensor.md && echo "log sensor exists"
head -5 agents/gsd-artifact-sensor.md
head -5 agents/gsd-log-sensor.md
```
Verify artifact sensor has detection steps but NO write/index steps:
```bash
grep -c "Write Signals\|Rebuild Index\|write.*signal.*file\|kb-rebuild-index" agents/gsd-artifact-sensor.md
# Should be 0 -- no KB write references
grep -c "Detect Signals\|Classify Signals\|deviation\|struggle\|config.mismatch" agents/gsd-artifact-sensor.md
# Should be >0 -- detection logic preserved
```
  </verify>
  <done>
Artifact sensor agent spec exists with all detection logic from gsd-signal-collector but returns JSON instead of writing to KB. Log sensor stub exists as disabled placeholder with spike question documented.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update signal-collector deprecation wrapper and extend feature manifest</name>
  <files>agents/gsd-signal-collector.md, get-shit-done/feature-manifest.json</files>
  <action>
**Update `agents/gsd-signal-collector.md`:**

Replace the full agent spec with a short deprecation wrapper. Keep the existing frontmatter (name, description, tools, color) but update the description to: "SUPERSEDED by multi-sensor orchestrator. See gsd-artifact-sensor.md and gsd-signal-synthesizer.md."

Body should contain:
1. A prominent notice: "This agent has been superseded by the multi-sensor architecture (Phase 32). The detection logic now lives in `gsd-artifact-sensor.md` and KB writing in `gsd-signal-synthesizer.md`. The orchestrator workflow `collect-signals.md` coordinates them."
2. Explain the split: "What was one agent is now three: artifact sensor (detection), signal synthesizer (KB writes), and the orchestrator workflow (coordination)."
3. For backward compatibility: "If referenced directly, this agent will perform the same detection as gsd-artifact-sensor but without the orchestrator's deduplication, rigor enforcement, trace filtering, or cap management benefits."
4. Keep the `<required_reading>` tag referencing agent-protocol.md

The deprecation wrapper is intentionally kept rather than deleted so any existing references don't break. It is NOT deleted.

**Extend `get-shit-done/feature-manifest.json`:**

Add a new top-level feature entry `signal_collection` (alongside existing `health_check`, `devops`, `release`, `signal_lifecycle`). Use the exact schema from RESEARCH.md Pattern 5:

```json
"signal_collection": {
  "scope": "project",
  "introduced": "1.16.0",
  "config_key": "signal_collection",
  "schema": {
    "sensors": {
      "type": "object",
      "default": {
        "artifact": { "enabled": true, "model": "auto" },
        "git": { "enabled": true, "model": "auto" },
        "log": { "enabled": false, "model": "auto" }
      },
      "description": "Per-sensor configuration (enabled/disabled, model assignment)"
    },
    "synthesizer_model": {
      "type": "string",
      "default": "auto",
      "description": "Model for the signal synthesizer agent"
    },
    "per_phase_cap": {
      "type": "number",
      "default": 10,
      "description": "Maximum persistent signals per phase per project"
    }
  },
  "init_prompts": [
    {
      "field": "_gate",
      "question": "Configure signal collection sensors?",
      "options": [
        { "value": "skip", "label": "Skip (use defaults)" },
        { "value": "configure", "label": "Configure now" }
      ],
      "skip_value": "skip"
    }
  ]
}
```

Note: The `log` sensor is `"enabled": false` by default -- matching SENSOR-07 requirement. The `model: "auto"` defers to orchestrator model selection based on model_profile.

Read the existing feature-manifest.json first, then add the new entry. Ensure the JSON remains valid (check comma placement). The final file should have 5 features: health_check, devops, release, signal_lifecycle, signal_collection.
  </action>
  <verify>
```bash
# Validate JSON
node -e "const m = require('./get-shit-done/feature-manifest.json'); console.log('Features:', Object.keys(m.features).length, Object.keys(m.features).join(', '))"
# Should output: Features: 5 health_check, devops, release, signal_lifecycle, signal_collection

# Verify signal_collection config
node -e "const m = require('./get-shit-done/feature-manifest.json'); const sc = m.features.signal_collection; console.log('sensors default:', JSON.stringify(sc.schema.sensors.default)); console.log('log enabled:', sc.schema.sensors.default.log.enabled)"
# Should show log.enabled = false

# Verify deprecation wrapper
grep -c "superseded\|SUPERSEDED" agents/gsd-signal-collector.md
# Should be >= 1

# Run existing tests
npm test
```
  </verify>
  <done>
Feature manifest has 5 features including signal_collection with per-sensor enabled/model config where log sensor defaults to disabled. Signal-collector agent has deprecation notice pointing to new architecture. All existing tests pass.
  </done>
</task>

</tasks>

<verification>
1. `agents/gsd-artifact-sensor.md` exists with detection logic but no KB write steps
2. `agents/gsd-log-sensor.md` exists as disabled stub with spike question
3. `agents/gsd-signal-collector.md` has deprecation notice
4. `get-shit-done/feature-manifest.json` has signal_collection with 3 sensors (artifact enabled, git enabled, log disabled)
5. `npm test` passes (existing tests unbroken)
</verification>

<success_criteria>
The sensor agent infrastructure is in place: artifact sensor extracted with all detection logic, log sensor stub with documented spike question, feature manifest extended with per-sensor configuration, and signal-collector updated as deprecation wrapper. Plans 02 and 03 can proceed to create the git sensor and synthesizer independently.
</success_criteria>

<output>
After completion, create `.planning/phases/32-multi-sensor-orchestrator/32-01-SUMMARY.md`
</output>
