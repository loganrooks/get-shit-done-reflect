---
phase: 07-fork-strategy-pre-merge-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/FORK-STRATEGY.md
  - .planning/FORK-DIVERGENCES.md
  - .planning/PROJECT.md
autonomous: true

must_haves:
  truths:
    - "FORK-STRATEGY.md serves as the authoritative fork maintenance reference for both humans and Claude agents"
    - "FORK-DIVERGENCES.md lists all 17 modified upstream files with category, rationale, and merge stance"
    - "The 'additive only' fork constraint is formally retired in PROJECT.md with the tracked-modifications strategy as its replacement"
  artifacts:
    - path: ".planning/FORK-STRATEGY.md"
      provides: "Authoritative fork maintenance strategy document"
      contains: "tracked-modifications"
    - path: ".planning/FORK-DIVERGENCES.md"
      provides: "Manifest of all fork divergences from upstream"
      contains: "Modified Upstream Files"
    - path: ".planning/PROJECT.md"
      provides: "Updated project reference with retired additive-only constraint"
      contains: "tracked-modifications"
  key_links:
    - from: ".planning/FORK-STRATEGY.md"
      to: ".planning/FORK-DIVERGENCES.md"
      via: "cross-reference for current divergence details"
      pattern: "FORK-DIVERGENCES"
    - from: ".planning/FORK-DIVERGENCES.md"
      to: "git diff --diff-filter=M upstream/main...HEAD"
      via: "covers all 17 files from upstream diff"
      pattern: "bin/install.js|package.json|README.md"
---

<objective>
Create the fork maintenance strategy documentation and divergence manifest that formally retire the "additive only" constraint and establish the tracked-modifications approach for managing fork divergences.

Purpose: Phase 7 requires documented strategy before the Phase 8 upstream merge. These documents serve as the authoritative reference for all merge decisions, conflict resolution, and ongoing fork maintenance. Without them, Phase 8 has no principled basis for deciding how to resolve the 17 modified file conflicts.

Output: Three artifacts -- FORK-STRATEGY.md (strategy reference), FORK-DIVERGENCES.md (divergence manifest), and updated PROJECT.md (retired constraint).
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-fork-strategy-pre-merge-setup/07-RESEARCH.md
@.planning/phases/07-fork-strategy-pre-merge-setup/07-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FORK-STRATEGY.md</name>
  <files>.planning/FORK-STRATEGY.md</files>
  <action>
Create `.planning/FORK-STRATEGY.md` as the authoritative fork maintenance reference document. This is a living document updated per sync cycle.

**Required sections:**

1. **Fork Relationship** - One paragraph: GSD Reflect is a fork of GSD (gsd-build/get-shit-done). Fork point: commit 2347fca (upstream v1.11.1). Upstream remote: `upstream` pointing to `git@github.com:gsd-build/get-shit-done.git`. Current versions: fork v1.12.2, upstream v1.18.0.

2. **Strategy: Tracked Modifications** - Explain the approach: all fork modifications to upstream files are tracked in FORK-DIVERGENCES.md with category, rationale, and merge stance. Include a brief paragraph on why additive-only existed previously (kept merges clean) and why it's being retired (fork needs to modify upstream files for branding, behavior changes, and deeper integration -- tracking these explicitly is more practical than avoiding them).

3. **Divergence Management** - Point to FORK-DIVERGENCES.md for the current manifest. Explain the four categories: identity (branding), behavior (functionality changes), config (templates/defaults), build (build scripts/tooling). Explain merge stance options: "fork wins" (fork version kept entirely), "hybrid merge" (combine best of both), "case-by-case" (evaluate per sync). Tracking update cadence: per-phase during active development.

4. **Merge Strategy** - Traditional `git merge` (not rebase) on a dedicated sync branch. Workflow: tag current state -> create sync branch -> merge upstream/main -> resolve conflicts -> validate -> merge sync branch to main. Explain WHY merge over rebase: 145 fork commits + 17 modified files makes rebase painful; merge handles it in one operation. Use `git config merge.conflictstyle diff3` for better conflict visibility.

5. **Conflict Resolution Runbook** - Step-by-step guide for resolving conflicts during upstream merge:
   - For "fork wins" files: accept fork version entirely (`git checkout --ours <file>`)
   - For "hybrid merge" files: open conflict markers, combine upstream additions with fork modifications, verify result
   - For "case-by-case" files: read both versions, understand what upstream changed, decide based on which implementation is better
   - After all conflicts resolved: run full test suite, verify fork branding intact, verify fork features functional
   - If merge goes badly: reset sync branch to pre-sync tag, main is untouched

6. **Patch Preservation (Reapply-Patches)** - Document the upstream mechanism (commit ca03a06): SHA256 manifest -> modification detection -> file backup -> LLM-guided restore via `/gsd:reapply-patches`. Explain fork adoption: we inherit this mechanism for our downstream users (people who install get-shit-done-reflect-cc and modify files). For fork-to-upstream sync itself, we use standard git merge, NOT reapply-patches.

7. **Sync Cadence** - Ad-hoc, not fixed schedule. Trigger criteria: upstream has meaningful features, security fixes, or fork falls more than one major version behind. Current sync: v1.12.2 -> v1.18.0 (overdue, catching up).

8. **Merge Decision Log** - Template table with columns: File, Decision, Rationale, Sync Version. Populated during Phase 8. Example row showing format.

9. **Review Gate** - Before each upstream merge, a patch plan is presented for user approval listing all modified files and proposed resolution strategy. For v1.13 this is hardcoded in Phase 8. Future syncs: controlled by `sync.review_gate` setting in `.planning/config.json` (default: true).

10. **Contingencies** - Brief paragraph: if upstream fundamentally changes direction (different language, different architecture), evaluate whether to continue tracking upstream or freeze at last compatible version and evolve independently.

**Style:** Match existing .planning/ documents. Direct, practical, no corporate fluff. Audience is both the human developer and Claude agents who will read this during future syncs.
  </action>
  <verify>
File exists at `.planning/FORK-STRATEGY.md`. Contains all 10 sections listed above. References FORK-DIVERGENCES.md. Mentions "tracked-modifications" strategy. Includes conflict resolution runbook. Includes reapply-patches adoption. Is practical and actionable (a Claude agent reading this could execute a future sync).
  </verify>
  <done>FORK-STRATEGY.md exists as a comprehensive, actionable fork maintenance reference that both humans and Claude agents can follow for upstream sync operations.</done>
</task>

<task type="auto">
  <name>Task 2: Create FORK-DIVERGENCES.md</name>
  <files>.planning/FORK-DIVERGENCES.md</files>
  <action>
Create `.planning/FORK-DIVERGENCES.md` as the manifest of all fork divergences from upstream.

**Required structure:**

1. **Header with summary stats:**
   - Modified upstream files: 17
   - Added fork-only files: 166
   - Fork point: 2347fca (upstream v1.11.1)
   - Last sync: N/A (first sync pending)
   - Fork version: v1.12.2
   - Upstream version: v1.18.0

2. **Modified Upstream Files** -- organized by category with tables. Use the exact data from the research (07-RESEARCH.md "Modified Upstream Files by Category" section). Each table has columns: File | What Changed | Why | Merge Stance | Conflict Risk.

   **Identity (6 files):**
   - README.md - Complete rewrite for GSD Reflect branding - Fork identity - Fork wins - LOW
   - CHANGELOG.md - Fork-specific changelog - Fork identity - Fork wins - LOW
   - package.json - Name, repo, description, scripts, devDeps - Fork identity + extensions - Hybrid merge - HIGH
   - package-lock.json - Generated from fork's package.json - N/A - Regenerate - N/A
   - bin/install.js - Banner, package refs, help text, version-check hook - Fork branding + features - Hybrid merge - HIGH
   - hooks/gsd-check-update.js - npm package name change - Fork identity - Fork wins - LOW

   **Commands (3 files):**
   - commands/gsd/help.md - Package name, GSD Reflect section - Fork branding + features - Hybrid merge - MEDIUM
   - commands/gsd/new-project.md - DevOps Context section - Fork feature addition - Hybrid merge - HIGH
   - commands/gsd/update.md - Package name refs, changelog URL - Fork branding - Hybrid merge - MEDIUM

   **Templates & References (5 files):**
   - get-shit-done/references/planning-config.md - knowledge_debug, knowledge_surfacing config - Fork feature config - Hybrid merge - MEDIUM
   - get-shit-done/templates/config.json - gsd_reflect_version, health_check, devops sections - Fork feature config - Hybrid merge - MEDIUM
   - get-shit-done/templates/context.md - open_questions section - Fork enhancement - Case-by-case - LOW
   - get-shit-done/templates/project.md - open_questions section - Fork enhancement - Case-by-case - LOW
   - get-shit-done/templates/research.md - Enhanced open_questions structure - Fork enhancement - Case-by-case - LOW

   **Build & Config (3 files):**
   - get-shit-done/templates/codebase/concerns.md - DevOps Gaps section - Fork addition - Case-by-case - LOW
   - scripts/build-hooks.js - gsd-version-check.js in HOOKS_TO_COPY - Fork addition - Case-by-case - LOW
   - .gitignore - Benchmark results exclusion - Fork addition - Case-by-case - LOW

3. **Fork-Only Additions** -- brief note: 166 files added by fork (not in upstream). These are never in conflict. Key additions include: `.planning/` directory, `tests/` directory, `.claude/agents/gsd-*.md` (fork agents), `.claude/commands/gsd/*.md` (fork commands), knowledge base infrastructure. No detailed listing needed (git tracks these).

4. **Conflict Risk Summary:**
   - HIGH (3 files): bin/install.js, package.json, commands/gsd/new-project.md -- both sides made significant changes
   - MEDIUM (4 files): commands/gsd/help.md, commands/gsd/update.md, templates/config.json, references/planning-config.md -- additive from both sides
   - LOW (9 files): identity files, templates, build scripts -- fork wins or minimal upstream overlap
   - N/A (1 file): package-lock.json -- regenerated

**Data source:** Use the research findings in 07-RESEARCH.md. Run `git diff --diff-filter=M --name-only upstream/main...HEAD` to verify the 17-file list is current. If the list has changed since research, update accordingly.
  </action>
  <verify>
File exists at `.planning/FORK-DIVERGENCES.md`. Contains exactly 17 modified files (verify against `git diff --diff-filter=M --name-only upstream/main...HEAD`). Each file has category, description, rationale, merge stance, and conflict risk. Summary stats are accurate. Conflict risk summary matches per-file assessments.
  </verify>
  <done>FORK-DIVERGENCES.md exists as a complete, categorized manifest of all 17 fork divergences with merge stance and conflict risk assessment for each file.</done>
</task>

<task type="auto">
  <name>Task 3: Retire "additive only" constraint in PROJECT.md</name>
  <files>.planning/PROJECT.md</files>
  <action>
Update `.planning/PROJECT.md` to formally retire the "additive only" fork constraint:

1. **Update Constraints section:** Find the constraint "Fork maintenance: This is a fork of GSD upstream — new features must be additive (new files, new commands) rather than modifying existing upstream files, to keep merging upstream changes easy". Replace with: "Fork maintenance: This is a fork of GSD upstream — divergences from upstream files are tracked in FORK-DIVERGENCES.md with explicit category, rationale, and merge stance. See FORK-STRATEGY.md for the full maintenance approach."

2. **Update Key Decisions table:** Find the row for "Additive-only changes (no upstream file edits)". Update it to reflect the evolution:
   - Decision: "Tracked-modifications fork strategy (supersedes additive-only)"
   - Rationale: "Additive-only kept merges clean but became impractical as fork needed branding, behavior changes, and deeper integration. Tracked-modifications explicitly records all divergences with merge stances."
   - Outcome: "Evolved v1.13 -- see FORK-STRATEGY.md and FORK-DIVERGENCES.md"

3. **Do NOT delete historical context.** The Key Decisions table should show the evolution, not erase history. The old rationale was valid at the time.

4. **Update the "Last updated" line** at the bottom of the file to reflect today's date and the change made.
  </action>
  <verify>
Read `.planning/PROJECT.md`. The Constraints section references tracked-modifications and FORK-STRATEGY.md (not additive-only). The Key Decisions table has the updated row with "supersedes additive-only". The document is internally consistent.
  </verify>
  <done>PROJECT.md formally retires the "additive only" constraint and points to the new tracked-modifications strategy with references to FORK-STRATEGY.md and FORK-DIVERGENCES.md.</done>
</task>

</tasks>

<verification>
1. `cat .planning/FORK-STRATEGY.md | head -5` shows the document exists and has proper header
2. `cat .planning/FORK-DIVERGENCES.md | head -5` shows the manifest exists with summary stats
3. `grep -c "tracked-modifications" .planning/PROJECT.md` returns at least 1
4. `grep "FORK-DIVERGENCES" .planning/FORK-STRATEGY.md` confirms cross-reference exists
5. `git diff --diff-filter=M --name-only upstream/main...HEAD | wc -l` matches the count in FORK-DIVERGENCES.md
</verification>

<success_criteria>
- FORK-STRATEGY.md is a complete, actionable fork maintenance reference with all 10 sections
- FORK-DIVERGENCES.md lists all 17 modified upstream files with category, rationale, merge stance, and conflict risk
- PROJECT.md has the "additive only" constraint formally retired and replaced with tracked-modifications references
- All three documents are internally consistent and cross-reference each other correctly
</success_criteria>

<output>
After completion, create `.planning/phases/07-fork-strategy-pre-merge-setup/07-01-SUMMARY.md`
</output>
