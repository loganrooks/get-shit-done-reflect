---
phase: 08-core-merge
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "The sync/v1.13-upstream branch is checked out, includes all 3 docs commits from main, and has merge.conflictstyle set to diff3"
    - "git merge upstream/main has been executed and all conflicting files are identified"
    - "The actual conflict list is documented so Plan 08-02 knows exactly which files need resolution"
  artifacts:
    - path: "git merge state on sync/v1.13-upstream"
      provides: "Merge in progress with conflicts identified"
    - path: "conflict file list"
      provides: "Definitive list of files with merge conflicts"
  key_links:
    - from: "sync/v1.13-upstream branch"
      to: "upstream/main"
      via: "git merge creates the merge state"
      pattern: "CONFLICT|Automatic merge failed"
---

<objective>
Prepare the sync branch and execute `git merge upstream/main` to begin the upstream merge of 70 commits. This plan does NOT resolve conflicts -- it executes the merge and catalogs exactly what conflicted so subsequent plans can resolve them systematically.

Purpose: Phase 8 cannot begin conflict resolution until the merge is executed. This plan gets the repo into the merge conflict state with full visibility into what needs resolution.

Output: Repo on sync/v1.13-upstream in merge conflict state with a documented list of conflicting files.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/FORK-STRATEGY.md
@.planning/FORK-DIVERGENCES.md
@.planning/phases/08-core-merge/08-RESEARCH.md
@.planning/phases/08-core-merge/08-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-flight verification and branch preparation</name>
  <files></files>
  <action>
Quick pre-flight to ensure the sync branch is ready for the upstream merge. Phase 7 already validated the branch state, so this is a lightweight check, not a full re-validation.

**Steps:**

1. **Switch to the sync branch:**
   ```bash
   git checkout sync/v1.13-upstream
   ```

2. **Verify clean working tree:**
   ```bash
   git status
   ```
   Working tree must be clean. If there are uncommitted changes, investigate -- the sync branch should be pristine from Phase 7.

3. **Merge main into sync branch to pick up 3 docs-only commits:**
   The sync branch is 3 commits behind main (Phase 8 context, planning, and research docs -- all in `.planning/`). Merge them in:
   ```bash
   git merge main
   ```
   This should be a fast-forward or clean merge (docs-only commits in `.planning/` directory). If it conflicts, something is wrong -- stop and investigate.

4. **Fetch upstream:**
   ```bash
   git fetch upstream
   ```
   Verify the upstream remote is reachable. If fetch fails, check remote configuration with `git remote -v`.

5. **Set diff3 conflict style:**
   ```bash
   git config merge.conflictstyle diff3
   ```
   This shows the common ancestor version in conflict markers, critical for understanding what each side intended during conflict resolution.

6. **Verify state:**
   ```bash
   git log --oneline -3
   git branch --show-current
   ```
   Confirm we're on sync/v1.13-upstream and the 3 docs commits from main are present.
  </action>
  <verify>
`git branch --show-current` returns `sync/v1.13-upstream`. `git status` shows clean working tree. `git config merge.conflictstyle` returns `diff3`. `git remote -v | grep upstream` shows the upstream remote.
  </verify>
  <done>Sync branch is checked out, up-to-date with main (including 3 docs commits), upstream is fetched, and diff3 conflict style is set. Ready for the merge.</done>
</task>

<task type="auto">
  <name>Task 2: Execute upstream merge and catalog conflicts</name>
  <files></files>
  <action>
Execute the merge of all 70 upstream commits into the sync branch. The merge WILL produce conflicts -- that is expected and desired. This task catalogs them; resolution happens in Plans 08-02 and 08-03.

**Steps:**

1. **Execute the merge:**
   ```bash
   git merge upstream/main
   ```
   Git will report automatic merges and conflicts. The merge will NOT complete (exit code non-zero) because of conflicts. This is expected.

2. **Catalog the actual conflicting files:**
   ```bash
   git diff --name-only --diff-filter=U
   ```
   This lists every file with unresolved conflicts.

3. **Compare against predictions:**
   Research predicted 11 conflicting files:
   - HIGH: `bin/install.js`, `package.json`, `commands/gsd/new-project.md`
   - MEDIUM: `commands/gsd/help.md`, `commands/gsd/update.md`, `get-shit-done/references/planning-config.md`
   - LOW (case-by-case): `get-shit-done/templates/research.md`, `.gitignore`
   - LOW (fork-wins): `README.md`, `CHANGELOG.md`, `hooks/gsd-check-update.js`
   - Plus `package-lock.json` (regenerate)

   Document any differences between predicted and actual conflicts. Git may auto-resolve some predictions or surface unexpected conflicts. If there are surprises (files conflicting that research did not predict), flag them and note their content for Plans 08-02/08-03.

4. **Verify merge state:**
   ```bash
   git status
   ```
   Should show "You have unmerged paths" and list all conflicting files.

5. **Quick check: what merged cleanly:**
   Note the count of files that merged automatically from the git merge output. This confirms that the 36 upstream-only new files, 40+ upstream-modified-but-fork-unmodified files, and 6 fork-modified-but-upstream-unmodified files all came in cleanly.

**If the merge fails for a reason other than conflicts** (e.g., git error, corrupt state):
```bash
git merge --abort
```
Then investigate the cause. The `v1.12.2-pre-sync` tag is the immutable rollback point.

**Do NOT attempt to resolve any conflicts in this task.** Leave the repo in the merge conflict state for Plans 08-02 and 08-03.
  </action>
  <verify>
`git status` shows "You have unmerged paths" (merge in progress). `git diff --name-only --diff-filter=U` lists the conflicting files. No files have been resolved yet (all conflicts still present). The conflict list has been documented.
  </verify>
  <done>Upstream merge executed. All 70 upstream commits are being merged. Conflicting files are identified and documented. The repo is in merge conflict state, ready for systematic resolution in Plans 08-02 and 08-03.</done>
</task>

</tasks>

<verification>
1. `git branch --show-current` returns `sync/v1.13-upstream`
2. `git config merge.conflictstyle` returns `diff3`
3. `git status` shows "You have unmerged paths" (active merge in progress)
4. `git diff --name-only --diff-filter=U | wc -l` shows the number of conflicting files (expected ~11-12)
5. The conflict list is documented with comparison to research predictions
</verification>

<success_criteria>
- Sync branch is checked out with main's 3 docs commits merged in
- `git merge upstream/main` has been executed successfully (with expected conflicts)
- All conflicting files are identified via `git diff --name-only --diff-filter=U`
- Any differences from the predicted 11 conflicts are documented
- The repo is in merge conflict state, ready for Plans 08-02 and 08-03
</success_criteria>

<output>
After completion, create `.planning/phases/08-core-merge/08-01-SUMMARY.md`
</output>
