---
phase: 02-signal-collector
plan: 03
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - commands/gsd/signal.md
autonomous: true

must_haves:
  truths:
    - "Running /gsd:signal creates a manual signal entry in the knowledge base with context from the current conversation"
    - "The command accepts optional inline args (description, severity) and asks for missing info with at most one follow-up"
    - "Frustration patterns in recent conversation are auto-detected and offered as signal context"
  artifacts:
    - path: "commands/gsd/signal.md"
      provides: "User-facing /gsd:signal manual command for logging observations"
      contains: "argument parsing, frustration detection, signal creation, index rebuild"
  key_links:
    - from: "commands/gsd/signal.md"
      to: ".claude/agents/knowledge-store.md"
      via: "KB schema reference for signal file creation"
      pattern: "knowledge-store.md"
    - from: "commands/gsd/signal.md"
      to: "get-shit-done/references/signal-detection.md"
      via: "Severity rules and frustration patterns reference"
      pattern: "signal-detection.md"
---

<objective>
Create the /gsd:signal command for manual signal logging during any conversation.

Purpose: This is the user-facing command for capturing observations in real time (SGNL-10). Unlike /gsd:collect-signals which runs post-execution, /gsd:signal is used mid-conversation when the user notices something worth recording. It supports the hybrid interaction pattern: accepts optional args but asks for missing info.

Output: A single new command file (fork constraint).
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-signal-collector/02-CONTEXT.md
@.planning/phases/02-signal-collector/02-RESEARCH.md
@.planning/phases/02-signal-collector/02-01-SUMMARY.md
@.claude/agents/knowledge-store.md
@.claude/agents/kb-templates/signal.md
@get-shit-done/references/signal-detection.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /gsd:signal manual command</name>
  <files>commands/gsd/signal.md</files>
  <action>
Create `commands/gsd/signal.md` as the manual signal logging command. NEW file only.

Follow the existing GSD command pattern (study `commands/gsd/execute-phase.md` and other commands for structure conventions).

**Command definition:**
- Name: signal
- Description: Log a manual signal observation to the knowledge base with context from the current conversation
- Usage: `/gsd:signal "description" [--severity critical|notable] [--type deviation|struggle|config-mismatch|custom]`
- All arguments optional -- hybrid interaction pattern

**Command behavior:**

1. **Parse arguments**: Extract description, severity, and type from inline args if provided.

2. **Context extraction**: Scan recent conversation context for:
   - Current phase/plan being worked on (from conversation or .planning/STATE.md)
   - Project name (from directory)
   - Frustration indicators (patterns from signal-detection.md SGNL-06 section)
   - If frustration patterns detected (2+), offer to include as signal context

3. **Fill missing info** (at most ONE follow-up round):
   - If no description: ask "What did you observe?" (required)
   - If no severity: auto-assign based on signal-detection.md rules, show assignment, allow override
   - If no type: infer from description keywords or default to "custom"
   - Polarity: auto-assign (negative for problems, positive for improvements, neutral otherwise)

4. **Show preview before writing**:
   ```
   ## Signal Preview

   **Description:** {description}
   **Severity:** {severity}
   **Type:** {type}
   **Polarity:** {polarity}
   **Phase:** {phase} | **Plan:** {plan}
   **Source:** manual

   Save this signal? (y/n)
   ```

5. **Dedup check**: Before writing, check existing signals for related entries (per signal-detection.md dedup rules). If related found, show them and add to related_signals.

6. **Cap check**: Check per-phase signal cap (per signal-detection.md cap rules).

7. **Write signal**: Create signal file using kb-templates/signal.md template. Write to `~/.claude/gsd-knowledge/signals/{project}/`. Set `source: manual`.

8. **Rebuild index**: Run `bash ~/.claude/agents/kb-rebuild-index.sh`.

9. **Git commit** (if commit_planning_docs is true): Commit signal file with `git add -f`. Message: `docs(signal): {slug}`.

10. **Confirm**: Show signal ID and file path.

**Key design points:**
- Maximum 2 interaction rounds (args + one follow-up if needed). If user provides everything inline, zero follow-ups.
- Frustration detection is suggestive, not automatic -- agent mentions patterns found but user decides.
- Git behavior follows `commit_planning_docs` setting from `.planning/config.json`.
- References signal-detection.md for severity rules and frustration patterns.
- References knowledge-store.md for KB schema and file naming.
- References kb-templates/signal.md for signal file template.
  </action>
  <verify>
- File exists at `commands/gsd/signal.md`
- Has valid command frontmatter (name, description)
- Supports inline args (description, --severity, --type)
- Implements hybrid interaction (asks for missing info, max 1 follow-up)
- References signal-detection.md for frustration patterns and severity rules
- Includes preview-before-save step
- Includes dedup check and cap check
- Runs kb-rebuild-index.sh after write
- Does not modify any existing files
  </verify>
  <done>
A /gsd:signal command exists that allows users to manually log signal observations during any conversation, with intelligent context extraction and frustration detection.
  </done>
</task>

</tasks>

<verification>
- `commands/gsd/signal.md` exists with valid command structure
- Command supports hybrid interaction (inline args + guided fill)
- Frustration detection patterns from signal-detection.md are used (SGNL-06)
- Signal files created using Phase 1 KB infrastructure (template, index rebuild)
- Additive only (fork constraint)
</verification>

<success_criteria>
After execution, `/gsd:signal` is a working command that users can run mid-conversation to log observations, with automatic context extraction and severity assignment.
</success_criteria>

<output>
After completion, create `.planning/phases/02-signal-collector/02-03-SUMMARY.md`
</output>
