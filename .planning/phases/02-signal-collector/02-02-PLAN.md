---
phase: 02-signal-collector
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - commands/gsd/collect-signals.md
  - get-shit-done/workflows/collect-signals.md
autonomous: true

must_haves:
  truths:
    - "Running /gsd:collect-signals N analyzes all execution artifacts for phase N and writes detected signals to the knowledge base"
    - "Signal collection reads PLAN.md, SUMMARY.md, and VERIFICATION.md without modifying any upstream execute-phase files"
    - "After collection, the index is rebuilt and a summary report shows what was detected and persisted"
  artifacts:
    - path: "commands/gsd/collect-signals.md"
      provides: "User-facing /gsd:collect-signals command entry point"
      contains: "phase argument, agent spawn, structured output"
    - path: "get-shit-done/workflows/collect-signals.md"
      provides: "Orchestration workflow for post-execution signal collection"
      contains: "artifact loading, agent delegation, report generation"
  key_links:
    - from: "commands/gsd/collect-signals.md"
      to: "get-shit-done/workflows/collect-signals.md"
      via: "command delegates to workflow"
      pattern: "collect-signals.md"
    - from: "get-shit-done/workflows/collect-signals.md"
      to: ".claude/agents/gsd-signal-collector.md"
      via: "workflow spawns agent"
      pattern: "gsd-signal-collector"
---

<objective>
Create the /gsd:collect-signals command and its backing workflow for automated post-execution signal collection.

Purpose: This is the primary entry point for automated signal detection (SGNL-08 wrapper pattern). After running /gsd:execute-phase, the user runs /gsd:collect-signals to analyze what happened and persist signals. The command delegates to a workflow that spawns the signal collector agent.

Output: A command file and a workflow file, both new (fork constraint).
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-signal-collector/02-CONTEXT.md
@.planning/phases/02-signal-collector/02-RESEARCH.md
@.planning/phases/02-signal-collector/02-01-SUMMARY.md
@.claude/agents/gsd-signal-collector.md
@get-shit-done/references/signal-detection.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create collect-signals workflow</name>
  <files>get-shit-done/workflows/collect-signals.md</files>
  <action>
Create `get-shit-done/workflows/collect-signals.md` as the orchestration workflow for post-execution signal collection. NEW file only.

Follow the existing GSD workflow pattern (study `get-shit-done/workflows/execute-phase.md` for structure conventions).

**Workflow steps:**

1. **Validate input**: Receive phase number as argument. Verify phase directory exists at `.planning/phases/{padded-phase}-*/`. Error if no phase directory found.

2. **Locate artifacts**: Find all PLAN.md and SUMMARY.md files in the phase directory. Find VERIFICATION.md if exists. Count how many plans have summaries (completed plans only).

3. **Check prerequisites**: At least one SUMMARY.md must exist. If no summaries, report "No completed plans to analyze" and exit.

4. **Load config**: Read `.planning/config.json` for model_profile setting.

5. **Spawn signal collector agent**: Delegate to `gsd-signal-collector` agent with:
   - Phase number
   - List of artifact file paths (PLANs, SUMMARYs, VERIFICATION)
   - Config model_profile
   - Project name (derived from directory name)

6. **Receive agent report**: Agent returns structured report with signals detected, persisted, and skipped.

7. **Present results**: Show user-friendly summary:
   ```
   ## Signal Collection Complete

   **Phase:** {N}
   **Plans analyzed:** {count}

   **Signals detected:** {total}
   - Critical: {n} (persisted)
   - Notable: {n} (persisted)
   - Trace: {n} (skipped)

   **Duplicates found:** {n} (linked via related_signals)
   **Cap status:** {current}/{max} signals for this phase

   ### Next Steps
   - Review signals: `ls ~/.claude/gsd-knowledge/signals/{project}/`
   - Run reflection: `/gsd:reflect` (Phase 4)
   ```

8. **Git commit** (if signals written and commit_planning_docs is true): Commit new signal files. Use `git add -f` since `.claude/` may be gitignored.
  </action>
  <verify>
- File exists at `get-shit-done/workflows/collect-signals.md`
- Workflow validates phase input and checks for completed summaries
- Workflow spawns gsd-signal-collector agent
- Workflow presents structured results
- No modification of existing workflow files
  </verify>
  <done>
A collect-signals workflow exists that orchestrates post-execution signal analysis by spawning the signal collector agent and presenting results.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create collect-signals command</name>
  <files>commands/gsd/collect-signals.md</files>
  <action>
Create `commands/gsd/collect-signals.md` as the user-facing command entry point. NEW file only.

Follow the existing GSD command pattern (study `commands/gsd/execute-phase.md` for structure conventions -- YAML frontmatter with name, description, args pattern).

**Command definition:**
- Name: collect-signals
- Description: Analyze execution artifacts for a phase and detect workflow deviations, struggles, and config mismatches as signals
- Usage: `/gsd:collect-signals {phase-number}`
- Argument: phase number (required)

**Command behavior:**
1. Parse phase number from arguments
2. Delegate to `get-shit-done/workflows/collect-signals.md` workflow
3. The workflow handles all logic (artifact loading, agent spawning, reporting)

Keep the command file lean -- it is a routing layer that delegates to the workflow. All orchestration logic lives in the workflow.

**Example usage shown in command:**
```
/gsd:collect-signals 2
```
  </action>
  <verify>
- File exists at `commands/gsd/collect-signals.md`
- Has valid command frontmatter (name, description)
- Delegates to collect-signals workflow
- Does not duplicate workflow logic
  </verify>
  <done>
A /gsd:collect-signals command exists that users can invoke after phase execution to trigger automated signal detection.
  </done>
</task>

</tasks>

<verification>
- `commands/gsd/collect-signals.md` exists with valid command structure
- `get-shit-done/workflows/collect-signals.md` exists with workflow orchestration
- Command delegates to workflow; workflow spawns signal collector agent
- Wrapper pattern maintained: no existing execute-phase files modified (SGNL-08)
- Both files are additive only (fork constraint)
</verification>

<success_criteria>
After execution, `/gsd:collect-signals N` is a working command that analyzes phase N artifacts and writes detected signals to the knowledge base.
</success_criteria>

<output>
After completion, create `.planning/phases/02-signal-collector/02-02-SUMMARY.md`
</output>
