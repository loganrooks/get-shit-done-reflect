---
phase: 02-signal-collector
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/references/signal-detection.md
  - .claude/agents/gsd-signal-collector.md
autonomous: true

must_haves:
  truths:
    - "Detection rules for deviations, config mismatches, and debugging struggles are fully specified with severity auto-assignment"
    - "A signal collector agent exists that can read execution artifacts and apply detection rules to produce signal entries"
    - "Severity classification (critical/notable/trace), polarity assignment, and deduplication rules are documented"
  artifacts:
    - path: "get-shit-done/references/signal-detection.md"
      provides: "Detection rules, severity classification, dedup logic, polarity assignment, per-phase cap rules"
      contains: "deviation detection, config mismatch detection, struggle detection, severity table, polarity table, SGNL-09 cap"
    - path: ".claude/agents/gsd-signal-collector.md"
      provides: "Agent that performs post-execution signal detection and writes signals to KB"
      contains: "detection_rules, signal_write, deduplication, severity_assignment"
  key_links:
    - from: ".claude/agents/gsd-signal-collector.md"
      to: "get-shit-done/references/signal-detection.md"
      via: "@-reference in agent instructions"
      pattern: "signal-detection.md"
    - from: ".claude/agents/gsd-signal-collector.md"
      to: ".claude/agents/knowledge-store.md"
      via: "@-reference for KB schema"
      pattern: "knowledge-store.md"
---

<objective>
Create the signal detection reference document and signal collector agent that form the foundation for all signal collection in Phase 2.

Purpose: The reference doc defines HOW to detect signals (rules, severity, dedup, polarity). The agent defines WHO runs the detection and writes to the KB. All other Phase 2 plans (collect-signals command, /gsd:signal command) depend on these two files.

Output: Two new files -- a reference doc with detection rules and an agent definition.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-signal-collector/02-CONTEXT.md
@.planning/phases/02-signal-collector/02-RESEARCH.md
@.claude/agents/knowledge-store.md
@.claude/agents/kb-templates/signal.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create signal detection reference document</name>
  <files>get-shit-done/references/signal-detection.md</files>
  <action>
Create `get-shit-done/references/signal-detection.md` as the authoritative reference for signal detection rules. This is a NEW file (fork constraint: additive only).

The document must contain these sections:

**1. Overview**
- Purpose: defines detection rules, severity classification, and signal management for post-execution analysis
- Consumers: gsd-signal-collector agent, /gsd:signal command, /gsd:collect-signals command
- Input artifacts: PLAN.md, SUMMARY.md, VERIFICATION.md, config.json

**2. Deviation Detection (SGNL-01)**
Compare PLAN.md against SUMMARY.md:
- Task count mismatch (planned vs completed)
- "Deviations from Plan" section content (auto-fixes indicate plan gaps)
- files_modified in plan frontmatter vs "Files Created/Modified" in summary
- must_haves truths vs VERIFICATION.md gap results
- Positive deviations: unexpected improvements, ahead-of-schedule, cleaner-than-planned

**3. Config Mismatch Detection (SGNL-02)**
Compare .planning/config.json model_profile against executor spawn info:
- quality profile expects opus-class model
- balanced profile expects sonnet-class model
- Only flag mismatches where outcome was likely affected (not harmless fallbacks)

**4. Struggle Detection (SGNL-03)**
Scan SUMMARY.md for:
- "Issues Encountered" section with non-trivial content
- Multiple auto-fixes (3+) indicating plan quality problems
- Checkpoint returns on autonomous plans (unexpected human intervention)
- Duration significantly exceeding plan complexity

**5. Frustration Detection (SGNL-06)**
Pattern list for implicit frustration in conversation context (used by /gsd:signal):
- Patterns: "still not working", "this is broken", "tried everything", "keeps failing", "doesn't work", "same error", "frustrated", "why won't", "makes no sense", "wasting time"
- 2+ patterns in recent messages triggers frustration signal suggestion
- Agent uses judgment -- patterns are indicators, not definitive triggers

**6. Severity Auto-Assignment (SGNL-04)**
| Condition | Severity |
|-----------|----------|
| Verification failed (gaps_found) | critical |
| Config mismatch (wrong model spawned) | critical |
| 3+ auto-fixes in single plan | notable |
| Issues encountered (non-trivial) | notable |
| Positive deviations (unexpected improvements) | notable |
| Task order changed / minor file differences | trace |
| Single auto-fix | trace |

Only critical and notable persisted. Trace logged in collection report but NOT written to KB.
Manual override: /gsd:signal allows user to set severity explicitly.

**7. Polarity Assignment**
| Detection | Polarity |
|-----------|----------|
| Verification gaps, struggles, config mismatches | negative |
| Unexpected improvements, ahead-of-schedule | positive |
| Task reordering with no impact, minor file differences | neutral |

**8. Signal Schema Extensions (beyond Phase 1 base)**
New optional fields for signal entries:
- `polarity`: positive | negative | neutral
- `source`: auto | manual
- `occurrence_count`: integer (starts at 1)
- `related_signals`: array of signal IDs (for dedup cross-references)

These extend the Phase 1 signal schema. Existing fields (severity, signal_type, phase, plan) remain as defined in knowledge-store.md.

**9. Deduplication Rules (SGNL-05)**
Before writing a new signal:
1. Read existing signals for the project from index.md
2. Match on: same signal_type AND same project AND overlapping tags (2+ shared)
3. If match found: add matched signal IDs to `related_signals` field on the NEW signal
4. Do NOT update existing signals (immutability constraint from Phase 1)
5. Phase 4 (Reflection Engine) handles pattern detection across related signals

**10. Per-Phase Signal Cap (SGNL-09)**
- Maximum 10 persistent signals per phase per project
- If cap reached, only persist if new signal severity >= lowest existing severity
- If replacing: archive lowest-severity signal (set status: archived), then write new signal
- Trace signals never count toward cap (they are not persisted)

**11. Detection Timing**
- Automatic detection: post-execution only (after all plans in a phase complete)
- Manual detection: anytime via /gsd:signal command
- No mid-execution detection (wrapper pattern constraint -- cannot modify executor agents)
  </action>
  <verify>
- File exists at `get-shit-done/references/signal-detection.md`
- Contains all 11 sections
- Severity table has critical/notable/trace with persistence rules
- Dedup rules specify related_signals approach (not updating existing signals)
- Per-phase cap of 10 specified
- Frustration patterns listed
- Schema extensions (polarity, source, occurrence_count, related_signals) documented
  </verify>
  <done>
A complete detection reference exists that any agent or command can read to know exactly how to detect, classify, deduplicate, and cap signals.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create signal collector agent</name>
  <files>.claude/agents/gsd-signal-collector.md</files>
  <action>
Create `.claude/agents/gsd-signal-collector.md` as the agent that performs post-execution signal detection. This is a NEW file (fork constraint: additive only).

The agent must follow the standard GSD agent pattern (YAML frontmatter with name, description, tools, color).

**Frontmatter:**
```yaml
name: gsd-signal-collector
description: Detects workflow deviations, debugging struggles, and config mismatches from execution artifacts and persists them as signal entries in the knowledge base
tools: Read, Write, Bash, Glob, Grep
color: yellow
```

**Agent structure:**

`<role>`: Signal detection agent. Spawned by /gsd:collect-signals command. Analyzes execution artifacts (PLAN.md, SUMMARY.md, VERIFICATION.md) to detect and persist signals in the knowledge base at `~/.claude/gsd-knowledge/signals/`.

`<references>`: @-reference to:
- `get-shit-done/references/signal-detection.md` (detection rules)
- `.claude/agents/knowledge-store.md` (KB schema)
- `.claude/agents/kb-templates/signal.md` (signal entry template)

`<execution_flow>`:
1. **Load phase artifacts**: Read all PLAN.md and SUMMARY.md files for the given phase. Read VERIFICATION.md if exists.
2. **Load config**: Read `.planning/config.json` for model_profile.
3. **Detect signals**: For each plan, apply detection rules from signal-detection.md:
   - Deviation detection (PLAN vs SUMMARY comparison)
   - Config mismatch detection (config.json vs executor info)
   - Struggle detection (issues, auto-fixes, checkpoint returns)
4. **Classify signals**: Auto-assign severity and polarity per signal-detection.md rules.
5. **Filter**: Discard trace-level signals (log them in report only).
6. **Dedup check**: For each critical/notable signal, check existing KB signals for duplicates. Add related_signals if matches found.
7. **Cap check**: Count existing signals for this phase. Apply per-phase cap rules.
8. **Write signals**: For each signal that passes filtering, create signal file using kb-templates/signal.md template. Derive project name from current directory. Write to `~/.claude/gsd-knowledge/signals/{project}/`.
9. **Rebuild index**: Run `bash ~/.claude/agents/kb-rebuild-index.sh`.
10. **Report**: Output summary -- N signals detected (X critical, Y notable, Z trace skipped).

`<output_format>`: Structured report showing:
- Signals detected per plan
- Severity breakdown
- Signals persisted vs skipped
- Any cap replacements made
- Any duplicates found (related_signals)

Do NOT include runtime code or bash scripts in the agent -- the agent uses its tools (Read, Write, Bash) to execute steps. The agent is instructions, not a script.
  </action>
  <verify>
- File exists at `.claude/agents/gsd-signal-collector.md`
- Has valid YAML frontmatter with name, description, tools, color
- References signal-detection.md, knowledge-store.md, and kb-templates/signal.md
- Execution flow covers: load artifacts, detect, classify, filter, dedup, cap check, write, rebuild index, report
- Does not modify any existing files (fork constraint)
  </verify>
  <done>
A signal collector agent exists that can be spawned by /gsd:collect-signals, knows how to detect signals from execution artifacts, and writes them to the Phase 1 knowledge base following all rules.
  </done>
</task>

</tasks>

<verification>
- `get-shit-done/references/signal-detection.md` exists with complete detection rules
- `.claude/agents/gsd-signal-collector.md` exists with valid agent definition
- Agent references the detection reference doc
- Both files are additive only (no existing files modified)
- Detection covers SGNL-01 (deviations), SGNL-02 (config mismatches), SGNL-03 (struggles), SGNL-04 (severity), SGNL-05 (dedup), SGNL-06 (frustration patterns), SGNL-09 (cap)
</verification>

<success_criteria>
The signal detection rules and collector agent are fully defined so that Plans 02 and 03 can build commands/workflows that invoke them.
</success_criteria>

<output>
After completion, create `.planning/phases/02-signal-collector/02-01-SUMMARY.md`
</output>
