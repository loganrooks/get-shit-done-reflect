---
phase: 21-workflow-refinements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/kb-templates/spike-design.md
  - get-shit-done/workflows/run-spike.md
autonomous: true

must_haves:
  truths:
    - "Spike DESIGN.md template includes a Prerequisites/Feasibility section"
    - "/gsd:spike workflow evaluates research-vs-spike suitability before proceeding to design"
    - "Advisory gate is informational in interactive mode and silent in yolo mode"
    - "Existing spike functionality (workspace creation, design, runner spawn, reporting) is unchanged"
  artifacts:
    - path: ".claude/agents/kb-templates/spike-design.md"
      provides: "DESIGN.md template with Prerequisites/Feasibility section"
      contains: "Prerequisites"
    - path: "get-shit-done/workflows/run-spike.md"
      provides: "Run-spike workflow with research-first advisory gate"
      contains: "Research-First Advisory"
  key_links:
    - from: "get-shit-done/workflows/run-spike.md"
      to: ".claude/agents/kb-templates/spike-design.md"
      via: "Workflow uses template to create DESIGN.md"
      pattern: "spike-design"
    - from: "get-shit-done/workflows/run-spike.md"
      to: "get-shit-done/references/spike-execution.md"
      via: "Advisory gate references Premature Spiking anti-pattern"
      pattern: "Premature Spiking"
---

<objective>
Add a Prerequisites/Feasibility section to the spike DESIGN.md template, and add a research-first advisory gate to the /gsd:spike workflow that evaluates whether a question is better answered by research than experimentation.

Purpose: The current spike workflow proceeds directly from question to DESIGN.md creation without assessing feasibility or whether research could answer the question first. This leads to spikes that fail due to missing prerequisites, and spikes that duplicate work research could have done. These two changes address both problems with minimal workflow additions.

Output: Updated spike-design.md template with Prerequisites/Feasibility section, and updated run-spike.md workflow with a research-first advisory step.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-workflow-refinements/21-RESEARCH.md

Source files to modify:
@.claude/agents/kb-templates/spike-design.md
@get-shit-done/workflows/run-spike.md

Reference files (read for context, do not modify):
@get-shit-done/references/spike-execution.md
@get-shit-done/references/spike-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Prerequisites/Feasibility section to spike DESIGN.md template</name>
  <files>.claude/agents/kb-templates/spike-design.md</files>
  <action>
Add a "Prerequisites / Feasibility" section to the spike DESIGN.md template. Place it AFTER the "Type" section and BEFORE the "Hypothesis" section. This matches scientific protocol order: understand the question type, assess feasibility, THEN form a hypothesis and design experiments.

**New section to insert between "## Type" and "## Hypothesis":**

```markdown
## Prerequisites / Feasibility

**Environment requirements:**
- {API keys, credentials, or accounts needed -- or "None"}
- {CLI tools or software to install -- or "None"}
- {Network access, service availability, hardware -- or "Standard dev environment"}

**Feasibility checklist:**
- [ ] All prerequisites available or obtainable within spike timeframe
- [ ] Experiments can run in spike workspace isolation (no main project modification)
- [ ] No production systems, data, or credentials at risk

**If prerequisites NOT met:**
{Action: defer spike until prerequisites available / adjust experiments to work within constraints / document blocker and checkpoint}
```

**Keep everything else in the template unchanged.** The existing sections (frontmatter, Question, Type, Hypothesis, Success Criteria, Experiment Plan, Scope Boundaries, Time Estimate, Iteration Log) all remain as-is. Only insert the new section between Type and Hypothesis.

**Also update the HTML comment at the top** to mention the new section: add "Prerequisites/Feasibility" to the list of sections in the comment block.
  </action>
  <verify>
1. `grep -c 'Prerequisites' .claude/agents/kb-templates/spike-design.md` returns >= 1
2. `grep -c 'Feasibility' .claude/agents/kb-templates/spike-design.md` returns >= 1
3. `grep -c 'Environment requirements' .claude/agents/kb-templates/spike-design.md` returns >= 1
4. `grep -c 'Feasibility checklist' .claude/agents/kb-templates/spike-design.md` returns >= 1
5. Verify section ordering by checking line numbers: `grep -n '## Type\|## Prerequisites\|## Hypothesis\|## Success' .claude/agents/kb-templates/spike-design.md` should show Type before Prerequisites before Hypothesis before Success Criteria
6. `wc -l .claude/agents/kb-templates/spike-design.md` shows approximately 115-120 lines (was 99, adding ~16-20 lines)
  </verify>
  <done>spike-design.md template includes a Prerequisites/Feasibility section between Type and Hypothesis. The section has environment requirements, a feasibility checklist, and guidance for when prerequisites are not met. All existing template sections are preserved in their original positions.</done>
</task>

<task type="auto">
  <name>Task 2: Add research-first advisory gate to run-spike workflow</name>
  <files>get-shit-done/workflows/run-spike.md</files>
  <action>
Add a new step "### 2. Research-First Advisory" to the run-spike workflow, between the existing "### 1. Parse Inputs" (currently Step 1) and "### 2. Create Workspace" (currently Step 2). Renumber subsequent steps (old Step 2 becomes Step 3, old Step 3 becomes Step 4, etc., through old Step 8 which becomes Step 9).

**New step to insert:**

```markdown
### 2. Research-First Advisory

Before creating a workspace or drafting DESIGN.md, assess whether the question is better suited to research or experimentation.

**Research indicators** (question may not need a spike):
- Asks about capabilities, features, or API support ("Does X support Y?")
- Answer likely exists in official documentation or changelogs
- Asks WHAT exists rather than HOW it performs empirically
- No measurement under specific conditions is needed

**Spike indicators** (question genuinely needs experimentation):
- Requires empirical measurement ("Is X faster than Y for our workload?")
- Depends on conditions that documentation cannot address
- Tests performance, reliability, or compatibility under specific constraints
- Official documentation is ambiguous or contradictory

**If mode == interactive AND question appears research-suitable:**

Present advisory to user:

```
This question may be answerable through documentation research rather
than empirical experimentation. The spike anti-pattern "Premature Spiking"
(spike-execution.md Section 10) warns against running spikes for questions
that normal research could resolve.

Options:
1. Proceed with spike (you know your intent best)
2. Cancel -- try research first (/gsd:research-phase)
3. Rephrase question to focus on the empirical aspect

Select [1/2/3]:
```

If user selects 1: proceed to workspace creation.
If user selects 2: exit workflow, suggest `/gsd:research-phase`.
If user selects 3: prompt for rephrased question, restart from Step 1.

**If mode == yolo OR question appears spike-suitable:**

Log a brief one-line assessment ("Question assessed as spike-suitable, proceeding to design") and continue. Do NOT present a checkpoint or pause.
```

**Renumbering:** After inserting the new step 2:
- Old "### 2. Create Workspace" becomes "### 3. Create Workspace"
- Old "### 3. Draft DESIGN.md" becomes "### 4. Draft DESIGN.md"
- Old "### 4. User Confirmation" becomes "### 5. User Confirmation"
- Old "### 5. Spawn Spike Runner Agent" becomes "### 6. Spawn Spike Runner Agent"
- Old "### 6. Handle Agent Result" becomes "### 7. Handle Agent Result"
- Old "### 7. Update RESEARCH.md" becomes "### 8. Update RESEARCH.md"
- Old "### 8. Report Result" becomes "### 9. Report Result"

**CRITICAL constraints:**
- The advisory gate must be ADVISORY, not blocking. Users invoke /gsd:spike intentionally. The gate surfaces guidance, it does not prevent execution (unless user explicitly cancels).
- In YOLO mode, this step should be nearly invisible -- a brief log line, not a checkpoint.
- Do NOT modify the spike-execution.md or spike-integration.md reference docs. The advisory gate lives in the workflow only.
- Keep simple keyword heuristics for classification. Do NOT build a complex classifier.
- The advisory only applies to standalone /gsd:spike invocations. Orchestrator-triggered spikes (via plan-phase) already have research-before-spike flow from spike-integration.md.
  </action>
  <verify>
1. `grep -c 'Research-First Advisory' get-shit-done/workflows/run-spike.md` returns >= 1
2. `grep -c 'Premature Spiking' get-shit-done/workflows/run-spike.md` returns >= 1
3. `grep -c 'research-suitable\|spike-suitable' get-shit-done/workflows/run-spike.md` returns >= 1
4. `grep -c 'research first' get-shit-done/workflows/run-spike.md` returns >= 1 (the cancel option mentions research)
5. Verify step numbering: `grep -n '### [0-9]' get-shit-done/workflows/run-spike.md` should show steps 1 through 9 in order
6. `wc -l get-shit-done/workflows/run-spike.md` shows approximately 230-250 lines (was 195, adding ~35-45 lines)
7. Verify spike-execution.md unchanged: `git diff get-shit-done/references/spike-execution.md` shows no changes
8. Verify spike-integration.md unchanged: `git diff get-shit-done/references/spike-integration.md` shows no changes
  </verify>
  <done>run-spike.md workflow includes a research-first advisory gate as Step 2 (between input parsing and workspace creation). The gate classifies questions using keyword heuristics, presents an advisory to interactive users for research-suitable questions (with proceed/cancel/rephrase options), and silently proceeds in yolo mode. All subsequent steps are renumbered. Reference docs are unchanged.</done>
</task>

</tasks>

<verification>
1. Spike DESIGN.md template has Prerequisites/Feasibility section: `grep 'Prerequisites' .claude/agents/kb-templates/spike-design.md` succeeds
2. Run-spike workflow has advisory gate: `grep 'Research-First Advisory' get-shit-done/workflows/run-spike.md` succeeds
3. Advisory gate references anti-pattern: `grep 'Premature Spiking' get-shit-done/workflows/run-spike.md` succeeds
4. No collateral damage: `git diff get-shit-done/references/spike-execution.md` and `git diff get-shit-done/references/spike-integration.md` show no changes
5. Step numbering is correct: Steps 1-9 in run-spike.md are sequential
</verification>

<success_criteria>
- Spike DESIGN.md template includes Prerequisites/Feasibility section between Type and Hypothesis
- /gsd:spike workflow includes research-first advisory gate as Step 2
- Advisory gate is informational (interactive mode) and silent (yolo mode)
- All existing spike functionality preserved (workspace creation, design, runner spawn, reporting)
- No reference documents modified (spike-execution.md, spike-integration.md)
</success_criteria>

<output>
After completion, create `.planning/phases/21-workflow-refinements/21-02-SUMMARY.md`
</output>
