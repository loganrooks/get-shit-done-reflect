---
phase: 25-backlog-system-core
plan: 03
type: execute
wave: 2
depends_on: [25-01]
files_modified:
  - get-shit-done/workflows/add-todo.md
  - commands/gsd/add-todo.md
autonomous: true

must_haves:
  truths:
    - "/gsd:add-todo workflow template includes optional priority, source, and status fields in frontmatter"
    - "add-todo extract_content step documents that priority and source can be inferred from conversation context"
    - "STATE.md ### Pending Todos section is NOT replaced or restructured by any changes in this plan"
    - "add-todo create_file step generates frontmatter with priority defaulting to MEDIUM and source defaulting to command"
  artifacts:
    - path: "get-shit-done/workflows/add-todo.md"
      provides: "Updated add-todo workflow with optional priority, source, status fields"
      contains: "priority"
    - path: "commands/gsd/add-todo.md"
      provides: "Updated add-todo command file documenting new fields"
      contains: "priority"
  key_links:
    - from: "add-todo.md create_file step"
      to: "gsd-tools.js init todos"
      via: "init context still used for timestamps and todo count"
      pattern: "init.*todos"
    - from: "add-todo.md update_state step"
      to: "STATE.md ### Pending Todos"
      via: "preserved interaction - updates section but does NOT replace it"
      pattern: "Pending Todos"
---

<objective>
Extend the `/gsd:add-todo` workflow and command to support optional priority, source, and status fields in todo frontmatter. Verify STATE.md `### Pending Todos` section is preserved unchanged.

Purpose: BLOG-04 enables richer todo metadata that aligns with the backlog system's field structure. BLOG-06 ensures the lightweight todo index in STATE.md remains functional -- the backlog system coexists with, not replaces, the todo system.

Output: Updated add-todo.md workflow with optional priority/source/status in frontmatter template, updated command file documenting new fields.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-backlog-system-core/25-RESEARCH.md
@get-shit-done/workflows/add-todo.md
@commands/gsd/add-todo.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update add-todo.md workflow with optional priority, source, and status fields</name>
  <files>
    get-shit-done/workflows/add-todo.md
  </files>
  <action>
Update the add-todo.md workflow at `get-shit-done/workflows/add-todo.md` to support optional priority, source, and status frontmatter fields per BLOG-04.

**1. Update the extract_content step:**

After the existing extraction of title, problem, solution, and files, add extraction of optional fields:

```
- `priority`: If user specified (e.g., "high priority", "P1", "critical"), map to HIGH/MEDIUM/LOW. Default: MEDIUM
- `source`: Infer from context -- `command` if from /gsd:add-todo arguments, `conversation` if extracted from chat, `phase` if during phase execution, `signal` if from signal review. Default: command
- `status`: Default: pending (todo system's initial state)
```

**2. Update the create_file step:**

Modify the frontmatter template in the `create_file` step to include the new fields. The template currently looks like:

```markdown
---
created: [timestamp]
title: [title]
area: [area]
files:
  - [file:lines]
---
```

Update it to:

```markdown
---
created: [timestamp]
title: [title]
area: [area]
priority: [priority or MEDIUM]
source: [source or command]
status: pending
files:
  - [file:lines]
---
```

The priority and source fields are optional in the sense that they have sensible defaults -- the workflow always writes them, but the user doesn't need to explicitly provide them. This ensures new todos created by /gsd:add-todo are always born with these fields, while existing todos (created before this change) will have them auto-defaulted during reads by Plan 01's BLOG-05 implementation.

**3. Do NOT modify the update_state step:**

The `update_state` step references `### Pending Todos` in STATE.md. This step MUST remain exactly as-is per BLOG-06. The backlog system does NOT replace or restructure the STATE.md todo index. Verify no changes to this step.

**4. Do NOT modify the init_context step:**

The init_context step calls `gsd-tools.js init todos` which returns timestamps, todo count, etc. This is unchanged. Plan 01's BLOG-05 changes to `cmdInitTodos` are internal to gsd-tools.js and do not change the interface.
  </action>
  <verify>
1. Read the updated file and verify: `grep 'priority' get-shit-done/workflows/add-todo.md` returns matches in both extract_content and create_file steps
2. Read the updated file and verify: `grep 'source' get-shit-done/workflows/add-todo.md` returns matches in both extract_content and create_file steps
3. Verify update_state step is unchanged: `grep -A5 'update_state' get-shit-done/workflows/add-todo.md` still references `### Pending Todos` with no structural changes
4. Verify init_context step is unchanged: `grep 'init todos' get-shit-done/workflows/add-todo.md` returns the original gsd-tools.js call
  </verify>
  <done>
add-todo.md workflow updated: extract_content step now documents priority/source extraction from context; create_file step includes priority (default MEDIUM), source (default command), and status (pending) in frontmatter template. update_state and init_context steps preserved unchanged. BLOG-04 complete.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update add-todo command file and verify BLOG-06 STATE.md preservation</name>
  <files>
    commands/gsd/add-todo.md
  </files>
  <action>
**1. Update the add-todo command file:**

Update `commands/gsd/add-todo.md` to document the new optional fields in the objective and process sections.

In the `<objective>` section, add a note about the new fields:

```
Routes to the add-todo workflow which handles:
- Directory structure creation
- Content extraction from arguments or conversation
- Area inference from file paths
- Priority inference (HIGH/MEDIUM/LOW, defaults to MEDIUM)
- Source tracking (command/conversation/phase/signal)
- Duplicate detection and resolution
- Todo file creation with frontmatter
- STATE.md updates
- Git commits
```

In the `<process>` section, update the numbered list in "The workflow handles all logic including" to add the new fields:

```
1. Directory ensuring
2. Existing area checking
3. Content extraction (arguments or conversation)
4. Area inference
5. Priority and source inference
6. Duplicate checking
7. File creation with slug generation (includes priority, source, status fields)
8. STATE.md updates
9. Git commits
```

**2. Verify BLOG-06 -- STATE.md Pending Todos preserved:**

Explicitly verify that NO changes in this plan or Plan 01 modify:
- The `### Pending Todos` section header in STATE.md
- The format of todo entries in STATE.md
- The `update_state` step in add-todo.md
- The rendering of the Pending Todos section in any workflow

Run these verification checks:
```bash
# Verify update_state step in add-todo.md still references Pending Todos
grep "Pending Todos" get-shit-done/workflows/add-todo.md

# Verify no workflow modifies the Pending Todos format
grep -r "Pending Todos" get-shit-done/workflows/ commands/gsd/

# Verify STATE.md still has the section
grep "### Pending Todos" .planning/STATE.md
```

The backlog system (`.planning/backlog/`) and the todo system (`.planning/todos/`) are separate directories with separate tools. They coexist by design per BLOG-06.
  </action>
  <verify>
1. Read the updated command file: `grep 'priority\|source' commands/gsd/add-todo.md` returns matches documenting the new fields
2. Verify STATE.md preservation: `grep "### Pending Todos" .planning/STATE.md` returns match
3. Verify update_state unchanged: `grep "Pending Todos" get-shit-done/workflows/add-todo.md` returns match
4. Diff check: `git diff get-shit-done/workflows/add-todo.md` shows only additions to extract_content and create_file steps, no changes to update_state or init_context
  </verify>
  <done>
add-todo command file updated to document priority, source, and status fields. BLOG-06 verified: STATE.md ### Pending Todos section is untouched, update_state step is unchanged, todo system and backlog system coexist as separate directory structures. Phase 25 Plan 03 complete.
  </done>
</task>

</tasks>

<verification>
1. add-todo.md workflow has priority/source/status in frontmatter template: `grep -c 'priority\|source\|status.*pending' get-shit-done/workflows/add-todo.md` returns 3+
2. add-todo.md command file documents new fields: `grep 'priority\|source' commands/gsd/add-todo.md` returns matches
3. STATE.md section preserved: `grep "### Pending Todos" .planning/STATE.md` returns match
4. update_state step unchanged: no diff in update_state section of add-todo.md
5. init_context step unchanged: `grep 'init todos' get-shit-done/workflows/add-todo.md` returns original call
</verification>

<success_criteria>
- add-todo.md workflow template includes priority, source, and status fields in frontmatter (BLOG-04)
- Priority defaults to MEDIUM, source defaults to command, status defaults to pending
- extract_content step documents how to infer priority and source from context
- STATE.md ### Pending Todos section is NOT replaced or restructured (BLOG-06)
- update_state step in add-todo.md is completely unchanged
- add-todo command file documents the new fields
</success_criteria>

<output>
After completion, create `.planning/phases/25-backlog-system-core/25-03-SUMMARY.md`
</output>
