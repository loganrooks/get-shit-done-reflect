---
phase: 34-signal-plan-linkage
plan: 02
type: execute
wave: 2
depends_on: ["34-01"]
files_modified:
  - agents/gsd-planner.md
  - get-shit-done/workflows/plan-phase.md
autonomous: true

must_haves:
  truths:
    - "The planner agent has a signal_awareness section instructing it to read triaged signals and recommend resolves_signals"
    - "The plan-phase workflow loads triaged signals from the KB index and passes them to the planner as context"
    - "Signal loading is conditional -- skipped when no triaged address signals exist for the project"
    - "Signal context is capped at 10 signals to prevent context bloat"
  artifacts:
    - path: "agents/gsd-planner.md"
      provides: "Signal awareness section for resolves_signals recommendation"
      contains: "signal_awareness"
    - path: "get-shit-done/workflows/plan-phase.md"
      provides: "Triaged signal loading step before planner spawn"
      contains: "triaged_signals"
  key_links:
    - from: "get-shit-done/workflows/plan-phase.md"
      to: "agents/gsd-planner.md"
      via: "triaged_signals context passed in planner prompt"
      pattern: "triaged_signals"
    - from: "get-shit-done/workflows/plan-phase.md"
      to: "~/.gsd/knowledge/index.md"
      via: "KB index read for triaged signal filtering"
      pattern: "index.md"
---

<objective>
Add signal awareness to the planner agent and triaged signal loading to the plan-phase workflow

Purpose: Enable the planner to recommend resolves_signals in plans by reading active triaged signals from the KB. The plan-phase workflow loads and filters signals, passing relevant ones to the planner as context. This is the "input" side of the lifecycle -- connecting reflector output (triage decisions) to planning.
Output: Updated gsd-planner.md with signal_awareness section, updated plan-phase.md with signal loading step
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-signal-plan-linkage/34-RESEARCH.md
@agents/gsd-planner.md
@get-shit-done/workflows/plan-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add signal_awareness section to gsd-planner.md</name>
  <files>agents/gsd-planner.md</files>
  <action>
Add a `<signal_awareness>` XML section to gsd-planner.md. Place it after the existing `<knowledge_surfacing>` section (or after the main execution flow sections if knowledge_surfacing is not present).

Content of the section:

```markdown
<signal_awareness>
## Signal Awareness (resolves_signals)

When `<triaged_signals>` context is provided by the plan-phase workflow:

1. Review each triaged signal's root cause and remediation suggestion
2. For each plan being created, assess: "Does any task in this plan directly address the root cause of a triaged signal?"
3. If YES: add the signal ID to `resolves_signals` in the plan's frontmatter
4. In the relevant task's `<action>`, include: "This task addresses signal {sig-id}: {root cause summary}"
5. In `must_haves.truths`, include a truth that reflects the signal's resolution

**Rules:**
- Do NOT force-fit signals. Only declare resolves_signals when the plan genuinely addresses the root cause.
- Do NOT create tasks solely to resolve signals -- the primary planning objective takes precedence.
- Do NOT add resolves_signals for signals with `triage.decision` other than "address" (skip dismiss/defer/investigate).
- Maximum 5 signal IDs per plan (focus on the most relevant).
- If no triaged signals match the current phase's work, omit resolves_signals entirely.

**Validation:** Before including a signal ID, verify it exists in the KB index. Non-existent IDs produce a warning but do not block plan creation (signals could be archived between planning and execution).

**When triaged_signals is empty or not provided:** Omit resolves_signals from plan frontmatter. Do not query the KB independently -- the plan-phase workflow handles signal loading.
</signal_awareness>
```

Also update the `<plan_format>` section's frontmatter field table to include `resolves_signals` as an optional field:

Add row: `| resolves_signals | No | Signal IDs this plan addresses |`

And in the PLAN.md Structure template's frontmatter block, add after `autonomous: true`:
```yaml
resolves_signals: []          # Optional: signal IDs this plan resolves
```
  </action>
  <verify>
grep -c "signal_awareness" agents/gsd-planner.md | grep -v "^0$"
grep -c "resolves_signals" agents/gsd-planner.md | grep -v "^0$"
grep "triaged_signals" agents/gsd-planner.md
  </verify>
  <done>gsd-planner.md has signal_awareness section with rules for resolves_signals recommendation, and plan format updated with resolves_signals as optional field</done>
</task>

<task type="auto">
  <name>Task 2: Add triaged signal loading step to plan-phase.md workflow</name>
  <files>get-shit-done/workflows/plan-phase.md</files>
  <action>
Add a new step between step 7 (Use Context Files from INIT) and step 8 (Spawn gsd-planner Agent) in plan-phase.md. This step loads triaged signals from the KB and prepares them as planner context.

New step (insert as "## 7b. Load Triaged Signals"):

```markdown
## 7b. Load Triaged Signals

**Skip if:** `--gaps` flag is set (gap closure mode does not use signal awareness).

Load active triaged signals for the current project to pass to the planner:

```bash
# Read KB index and filter for triaged "address" signals
KB_INDEX=$(cat ~/.gsd/knowledge/index.md 2>/dev/null)
PROJECT_NAME=$(basename "$(pwd)")
```

1. Parse the KB index table for signals matching:
   - Project = current project name
   - Lifecycle = "triaged"
   - Status = "active"
2. For matching signals, read the full signal files (max 10, prioritized by severity: critical > notable > minor):
   ```bash
   # Example: read top signal files
   cat ~/.gsd/knowledge/signals/{project}/{date}-{slug}.md
   ```
3. From each signal file, extract: `id`, `severity`, `signal_type`, `tags`, `triage.decision`, `triage.remediation_suggestion`
4. Filter to signals with `triage.decision: address` only (skip dismiss/defer/investigate)
5. Format as `<triaged_signals>` context block:
   ```markdown
   <triaged_signals>
   {N} triaged signals with decision "address" for project {project_name}:

   - **{sig-id}** ({severity}): {summary}
     Root cause: {from triage or evidence}
     Remediation suggestion: {triage.remediation_suggestion}
     Tags: {tags}
   ...
   </triaged_signals>
   ```

**If no matching signals:** Set `TRIAGED_SIGNALS=""` (empty). The planner will omit resolves_signals.

**Context budget note:** Reading 10 signal files costs ~5-10% context. This is acceptable because signal loading replaces the need for the planner to independently discover these issues.
```

Then update the planner prompt in step 8 to include the triaged signals context. In the `<planning_context>` block passed to the planner, add after the Research line:

```markdown
**Triaged Signals:**
{TRIAGED_SIGNALS}
```

This passes the triaged signals as part of the planner's input context so it can recommend resolves_signals in plans.
  </action>
  <verify>
grep -c "triaged_signals" get-shit-done/workflows/plan-phase.md | grep -v "^0$"
grep "Load Triaged Signals" get-shit-done/workflows/plan-phase.md
grep "triage.decision" get-shit-done/workflows/plan-phase.md
  </verify>
  <done>plan-phase.md has a triaged signal loading step that reads the KB index, filters for address signals, and passes them to the planner as context</done>
</task>

</tasks>

<verification>
- [ ] gsd-planner.md contains `<signal_awareness>` section
- [ ] gsd-planner.md documents resolves_signals rules (no force-fitting, max 5 per plan, address-only)
- [ ] plan-phase.md has "Load Triaged Signals" step between context loading and planner spawn
- [ ] plan-phase.md filters signals by project, lifecycle=triaged, decision=address
- [ ] plan-phase.md caps signal file reads at 10
- [ ] plan-phase.md passes triaged_signals in planner prompt
- [ ] plan-phase.md skips signal loading for --gaps mode
</verification>

<success_criteria>
The planner agent knows how to recommend resolves_signals based on triaged signals, and the plan-phase workflow loads those signals from the KB and passes them as context. When triaged signals exist for the project, the planner can declare which ones a plan addresses.
</success_criteria>

<output>
After completion, create `.planning/phases/34-signal-plan-linkage/34-02-SUMMARY.md`
</output>
