---
phase: 31-signal-schema-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/knowledge-store.md
  - agents/kb-templates/signal.md
  - get-shit-done/feature-manifest.json
autonomous: true

must_haves:
  truths:
    - "knowledge-store.md Section 4 Signal Extensions defines lifecycle_state, triage, remediation, verification, evidence, confidence, confidence_basis, signal_category, and recurrence_of fields"
    - "knowledge-store.md Section 10 documents the mutability boundary -- frozen detection payload fields and mutable lifecycle fields are explicitly listed"
    - "knowledge-store.md defines the lifecycle state machine with all transitions, skip rules, regression paths, and invalidation"
    - "knowledge-store.md documents tiered epistemic rigor requirements by severity (critical requires counter-evidence, trace exempt)"
    - "knowledge-store.md documents positive signal support with signal_category field and three types (baseline, improvement, good-pattern)"
    - "signal.md template includes lifecycle fields with sensible defaults for new signal creation"
    - "feature-manifest.json contains signal_lifecycle settings with all five project settings"
  artifacts:
    - path: "agents/knowledge-store.md"
      provides: "Authoritative signal schema with lifecycle, epistemic, mutability, and positive signal specifications"
      contains: "lifecycle_state"
    - path: "agents/kb-templates/signal.md"
      provides: "Updated signal template with lifecycle and epistemic fields"
      contains: "lifecycle_state"
    - path: "get-shit-done/feature-manifest.json"
      provides: "Project settings for signal lifecycle"
      contains: "signal_lifecycle"
  key_links:
    - from: "agents/knowledge-store.md"
      to: "agents/kb-templates/signal.md"
      via: "Template implements schema defined in spec"
      pattern: "lifecycle_state.*detected"
    - from: "agents/knowledge-store.md"
      to: "get-shit-done/feature-manifest.json"
      via: "Project settings referenced in spec, defined in manifest"
      pattern: "lifecycle_strictness"
---

<objective>
Define the complete extended signal schema specification, update the signal creation template, and add project settings for signal lifecycle configuration.

Purpose: Establishes the authoritative data model that all downstream phases (32-35) build behavior on. This is the foundation -- knowledge-store.md becomes the single source of truth for what a signal contains and how its fields behave.

Output: Updated knowledge-store.md with lifecycle/epistemic/mutability/positive-signal specs, updated signal.md template, feature-manifest.json with 5 project settings.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-signal-schema-foundation/31-RESEARCH.md
@.planning/phases/31-signal-schema-foundation/31-CONTEXT.md
@agents/knowledge-store.md
@agents/kb-templates/signal.md
@get-shit-done/feature-manifest.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend knowledge-store.md with lifecycle, epistemic, and mutability specifications</name>
  <files>agents/knowledge-store.md</files>
  <action>
Major update to the authoritative signal schema specification. Edit agents/knowledge-store.md (NOT .claude/agents/) per CLAUDE.md dual-directory rule.

**Section 3 (Common Base Schema):** Add `signal_category` to the optional fields note (positive/negative, defaults to negative for backward compatibility).

**Section 4 (Type-Specific Extensions > Signal Extensions):** Expand the signal extensions table substantially. Add these new fields to the signal extensions:

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `lifecycle_state` | enum | no | `detected` | `detected`, `triaged`, `remediated`, `verified`, `invalidated` |
| `signal_category` | enum | no | `negative` | `positive` or `negative` |
| `evidence` | object | conditional | `{}` | Contains `supporting` (array of strings) and `counter` (array of strings) |
| `confidence` | enum | no | `medium` | `high`, `medium`, or `low` |
| `confidence_basis` | string | no | `""` | Text explaining confidence assessment |
| `triage` | object | no | `{}` | Contains `decision` (address/dismiss/defer/investigate), `rationale`, `priority` (critical/high/medium/low), `by`, `at`, `severity_override` |
| `remediation` | object | no | `{}` | Contains `status` (planned/in-progress/complete), `resolved_by_plan`, `approach`, `at` |
| `verification` | object | no | `{}` | Contains `status` (pending/passed/failed), `method` (absence-of-recurrence/active-retest/evidence-review), `evidence_required` (for critical: active-retest), `at` |
| `recurrence_of` | string | no | `null` (use empty string "") | Signal ID this is a recurrence of |
| `lifecycle_log` | array | no | `[]` | Array of strings: `"detected->triaged by reflector at 2026-02-28T10:00:00Z: rationale"` |

Mark `evidence` as REQUIRED when severity is `critical` (conditional requirement). For `notable`, evidence is RECOMMENDED. For `minor` and `trace`, evidence is OPTIONAL.

Use empty objects `{}` (NOT null) for unset triage/remediation/verification -- per Pitfall 6 from research (reconstructFrontmatter silently drops null values).

**NEW Section 4.2: Lifecycle State Machine.** Add after the signal extensions table. Document:
- State diagram: detected -> triaged -> remediated -> verified, plus invalidated (terminal) from any state
- Regression paths: recurrence resets to detected (with severity escalation per recurrence_escalation project setting)
- Transition table (from/to/trigger/who-can-trigger) -- use the table from RESEARCH.md Section "Lifecycle State Machine"
- Skip rules by lifecycle_strictness setting: strict (all states required), flexible (detected->remediated allowed, detected->verified NOT allowed), minimal (any forward transition)
- Dismissed = triage decision value (`triage.decision: dismiss`), NOT a lifecycle state
- Existing 46 signals: absent lifecycle_state defaults to `detected`; bulk triage deferred to Phase 33

**NEW Section 4.3: Epistemic Rigor Requirements.** Add after state machine. Document:
- The five epistemic principles (from CONTEXT.md): proportional rigor, epistemic humility, evidence independence, mandatory counter-evidence, meta-epistemic reflection
- Tiered rigor table by severity:
  - critical: counter-evidence REQUIRED (hard fail without it), active verification required, confidence_basis REQUIRED
  - notable: counter-evidence RECOMMENDED (warn if missing), passive verification acceptable
  - minor: evidence summary sufficient, no counter-evidence required
  - trace: minimal -- detection context only, not persisted to KB
- Evidence independence rule: repeated citations of same fact are NOT corroboration
- Epistemic gap signals: signal_type `epistemic-gap`, signal_category `negative`, confidence inherently `low`
- Meta-evidence: system annotates evidence quality in confidence_basis
- Rigor enforcement behavior determined by project setting `rigor_enforcement` (strict/warn/permissive)

**NEW Section 4.4: Positive Signals.** Document:
- Three types: baseline, improvement, good-pattern (via signal_type field extension)
- signal_category: positive, polarity: positive (both set)
- Same lifecycle applies with semantic reinterpretation (verified = baseline confirmed stable)
- Triple purpose: lesson inputs, regression guards, cross-project transfer
- Severity tiers apply equally (a critical baseline is possible)

**Section 10 (Lifecycle Rules) update:**
- Replace the Signal row in the Mutability table: "Signal" was "Immutable after creation" / "Signals capture a moment in time". Change to: "Signal detection payload frozen after creation; lifecycle fields (lifecycle_state, lifecycle_log, triage, remediation, verification, updated) are mutable"
- Add explicit frozen/mutable field lists:
  - FROZEN: id, type, project, tags, created, durability, severity (initial sensor assessment), signal_type, signal_category, phase, plan, polarity, source, occurrence_count, related_signals, runtime, model, gsd_version, evidence.supporting (initial), evidence.counter (initial), confidence (initial), confidence_basis (initial), recurrence_of
  - MUTABLE: lifecycle_state, lifecycle_log, triage.*, remediation.*, verification.*, updated, status
- Note that triage.severity_override records disagreement between sensor and triage assessments (per locked decision about severity disagreements being recorded)
- Note: enforcement is agent-based (agent specs define which fields each agent may modify), with optional validation warning in gsd-tools.js

**Section 9 (Index Format) update:**
- Update the Signals table header to add Lifecycle column:
  `| ID | Project | Severity | Lifecycle | Tags | Date | Status |`
- Note: lifecycle_state is a top-level field specifically for index grep compatibility (per research finding about kb-rebuild-index.sh)

Preserve all existing sections that are not being modified. Do NOT delete or rewrite sections 1-3, 5-8, 11-13 unless minor cross-references are needed.
  </action>
  <verify>
Grep for key terms in the updated file:
- `grep "lifecycle_state" agents/knowledge-store.md` returns multiple matches
- `grep "mutability" agents/knowledge-store.md` (case-insensitive) returns matches
- `grep "epistemic" agents/knowledge-store.md` returns matches
- `grep "signal_category" agents/knowledge-store.md` returns matches
- `grep "counter-evidence" agents/knowledge-store.md` returns matches
- Verify no null defaults are specified (grep for "null" should only appear in transition table from: null context, not as field defaults)
  </verify>
  <done>
knowledge-store.md contains complete lifecycle state machine, mutability boundary with explicit frozen/mutable field lists, tiered epistemic rigor by severity, positive signal specification, and updated index format -- all as additive sections that preserve existing content.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update signal template and add project settings to feature manifest</name>
  <files>agents/kb-templates/signal.md, get-shit-done/feature-manifest.json</files>
  <action>
**Update agents/kb-templates/signal.md** (NOT .claude/ path):

Replace the current template with an extended version that includes all new fields with sensible defaults. The template should be what agents copy-and-fill when creating new signals:

```yaml
---
id: sig-{YYYY-MM-DD}-{slug}
type: signal
project: {project-name}
tags: [{tag1}, {tag2}]
created: {YYYY-MM-DDTHH:MM:SSZ}
updated: {YYYY-MM-DDTHH:MM:SSZ}
durability: {workaround|convention|principle}
status: active
severity: {critical|notable|minor|trace}
signal_type: {deviation|struggle|config-mismatch|capability-gap|epistemic-gap|baseline|improvement|good-pattern|custom}
signal_category: {positive|negative}
phase: {phase-number}
plan: {plan-number}
polarity: {positive|negative|neutral}
source: {auto|manual}
occurrence_count: 1
related_signals: []
runtime: {claude-code|opencode|gemini-cli|codex-cli}
model: {model-identifier}
gsd_version: {version-string}
lifecycle_state: detected
lifecycle_log:
  - "created -> detected by {agent} at {YYYY-MM-DDTHH:MM:SSZ}"
evidence:
  supporting: []
  counter: []
confidence: medium
confidence_basis: ""
triage: {}
remediation: {}
verification: {}
recurrence_of: ""
---

## What Happened

{Describe the deviation, struggle, or mismatch observed}

## Context

{Where and when this occurred -- phase, plan, task, what was being attempted}

## Potential Cause

{Best understanding of why this happened}
```

Add a comment block after the frontmatter closing `---` but before `## What Happened` that describes field requirements by severity:
```
<!-- Field requirements by severity:
  critical: evidence.supporting REQUIRED, evidence.counter REQUIRED, confidence_basis REQUIRED
  notable: evidence RECOMMENDED, confidence RECOMMENDED
  minor: evidence OPTIONAL
  trace: not persisted to KB (collection report only)
-->
```

**Update get-shit-done/feature-manifest.json:**

Add a `signal_lifecycle` feature entry after the existing `release` entry. Use the schema from RESEARCH.md Section "Project Settings Schema":

```json
"signal_lifecycle": {
  "scope": "project",
  "introduced": "1.16.0",
  "config_key": "signal_lifecycle",
  "schema": {
    "lifecycle_strictness": {
      "type": "string",
      "enum": ["strict", "flexible", "minimal"],
      "default": "flexible",
      "description": "How strictly lifecycle state transitions are enforced"
    },
    "manual_signal_trust": {
      "type": "string",
      "enum": ["full", "standard", "cautious"],
      "default": "standard",
      "description": "Rigor expected from user-submitted signals"
    },
    "rigor_enforcement": {
      "type": "string",
      "enum": ["strict", "warn", "permissive"],
      "default": "warn",
      "description": "What happens when rigor requirements are not met"
    },
    "severity_conflict_handling": {
      "type": "string",
      "enum": ["sensor-wins", "triage-wins", "record-both"],
      "default": "record-both",
      "description": "How sensor vs triage severity disagreements are handled"
    },
    "recurrence_escalation": {
      "type": "boolean",
      "default": true,
      "description": "Whether signal recurrence automatically escalates severity"
    }
  },
  "init_prompts": [
    {
      "field": "_gate",
      "question": "Configure signal lifecycle settings?",
      "options": [
        { "value": "skip", "label": "Skip (use defaults)" },
        { "value": "configure", "label": "Configure now" }
      ],
      "skip_value": "skip"
    }
  ]
}
```

Ensure valid JSON -- run `node -e "JSON.parse(require('fs').readFileSync('get-shit-done/feature-manifest.json'))"` to validate.
  </action>
  <verify>
- `grep "lifecycle_state" agents/kb-templates/signal.md` shows the template has lifecycle fields
- `grep "signal_lifecycle" get-shit-done/feature-manifest.json` shows the new feature entry
- `node -e "JSON.parse(require('fs').readFileSync('get-shit-done/feature-manifest.json'))"` exits 0 (valid JSON)
- `grep "lifecycle_strictness" get-shit-done/feature-manifest.json` returns match
  </verify>
  <done>
Signal template includes all lifecycle, epistemic, and positive signal fields with sensible defaults. Feature manifest contains 5 signal_lifecycle project settings with init prompt gate.
  </done>
</task>

</tasks>

<verification>
- [ ] knowledge-store.md Section 4 contains lifecycle state machine, epistemic rigor, positive signals, and extended field table
- [ ] knowledge-store.md Section 10 contains explicit frozen/mutable field lists
- [ ] knowledge-store.md Section 9 index format includes Lifecycle column
- [ ] signal.md template includes all new fields with defaults
- [ ] feature-manifest.json is valid JSON with signal_lifecycle section containing all 5 settings
- [ ] No files edited in .claude/ directory (all edits in npm source dirs)
- [ ] No null defaults used for object fields (use {} instead per Pitfall 6)
</verification>

<success_criteria>
The authoritative signal schema specification, creation template, and project settings are complete and internally consistent. A reader of knowledge-store.md can understand every field a signal may contain, when it is required, and how lifecycle state transitions work.
</success_criteria>

<output>
After completion, create `.planning/phases/31-signal-schema-foundation/31-01-SUMMARY.md`
</output>
