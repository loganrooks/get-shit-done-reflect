---
phase: 28-restore-deleted-commands
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/gsd-reflector.md
  - .claude/agents/gsd-signal-collector.md
  - .claude/agents/gsd-spike-runner.md
  - .claude/commands/gsd/reflect.md
  - .claude/commands/gsd/spike.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Agent specs gsd-reflector.md, gsd-signal-collector.md, and gsd-spike-runner.md exist in .claude/agents/ with pre-deletion content"
    - "Command files reflect.md and spike.md exist in .claude/commands/gsd/ and route to their respective workflows"
    - "All wiring validation tests pass (20/20, 0 failures — up from 16/20 baseline)"
    - "No dangling subagent_type or @-reference exists in workflow files"
  artifacts:
    - path: ".claude/agents/gsd-reflector.md"
      provides: "Reflection agent (pattern detection, lesson distillation, drift analysis)"
      min_lines: 270
    - path: ".claude/agents/gsd-signal-collector.md"
      provides: "Signal collection agent (deviation, config mismatch, struggle detection)"
      min_lines: 200
    - path: ".claude/agents/gsd-spike-runner.md"
      provides: "Spike execution agent (Build/Run/Document phases, DECISION.md, KB persistence)"
      min_lines: 460
    - path: ".claude/commands/gsd/reflect.md"
      provides: "/gsd:reflect command entry point routing to reflect workflow"
      min_lines: 80
    - path: ".claude/commands/gsd/spike.md"
      provides: "/gsd:spike command entry point routing to run-spike workflow"
      min_lines: 60
  key_links:
    - from: "get-shit-done/workflows/reflect.md"
      to: ".claude/agents/gsd-reflector.md"
      via: "subagent_type at line 228"
      pattern: "subagent_type.*gsd-reflector"
    - from: "get-shit-done/workflows/collect-signals.md"
      to: ".claude/agents/gsd-signal-collector.md"
      via: "subagent_type at line 130"
      pattern: "subagent_type.*gsd-signal-collector"
    - from: "get-shit-done/workflows/run-spike.md"
      to: ".claude/agents/gsd-spike-runner.md"
      via: "@-reference at lines 8 and 164"
      pattern: "@.claude/agents/gsd-spike-runner.md"
    - from: ".claude/commands/gsd/reflect.md"
      to: "get-shit-done/workflows/reflect.md"
      via: "command routing"
      pattern: "reflect"
    - from: ".claude/commands/gsd/spike.md"
      to: "get-shit-done/workflows/run-spike.md"
      via: "command routing"
      pattern: "run-spike"

known_debt:
  - "Restored agents have inline protocol (pre-Phase 22). Phase 22 extracted shared protocol into agent-protocol.md for the other 8 agents. These 3 restored agents were deleted before that extraction and still have inline protocol sections. They work correctly but are inconsistent with the other agents. Track as future cleanup."
---

<objective>
Restore the 5 files deleted by commit f664984 (3 agent specs + 2 command files) using TDD: confirm the RED baseline (4 failures), restore files (GREEN), verify all 20 tests pass.

Purpose: Commit f664984 deleted 1,112 lines of agent logic and command entry points without migrating the logic, breaking /gsd:reflect, /gsd:spike, and /gsd:collect-signals commands. The pre-deletion content at f664984^ already has correct KB paths from Phases 14 and 19. This plan restores the files verbatim and verifies the fix.

Output: 5 restored files in .claude/, all 20 wiring validation tests passing (baseline: 16/20, target: 20/20).
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-restore-deleted-commands/28-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1 (RED): Confirm baseline — 4 wiring test failures</name>
  <files>
    tests/integration/wiring-validation.test.js
  </files>
  <action>
    Run the wiring validation test suite BEFORE any restoration to establish the RED baseline:

    ```bash
    npx vitest run tests/integration/wiring-validation.test.js
    ```

    Capture and assert the following baseline state:
    - Total tests: 20
    - Passing: 16
    - Failing: exactly 4

    The 4 failing tests must be:
    1. `@-references in workflows resolve` — run-spike.md references @.claude/agents/gsd-spike-runner.md which does not exist
    2. `subagent_type values match agent files` — gsd-signal-collector and gsd-reflector have no matching agent files
    3. `reflect command exists` — neither commands/gsd/reflect.md nor .claude/commands/gsd/reflect.md exists
    4. `spike command exists` — neither commands/gsd/spike.md nor .claude/commands/gsd/spike.md exists

    **If baseline differs from expected:**
    - Fewer than 4 failures: Someone partially restored files — investigate which files already exist, adjust restoration scope
    - More than 4 failures: New breakage introduced — investigate before proceeding, do NOT mask new failures with restoration
    - Different failure names: Test suite changed — read the test file and adapt verification expectations

    Record the exact test output for the summary's before/after comparison.
  </action>
  <verify>
    - Test output shows exactly 4 failures and 16 passes
    - The 4 failure names match the expected list above
    - Baseline is recorded for summary comparison
  </verify>
  <done>RED baseline confirmed: 16/20 passing, 4/20 failing with expected failure names. Ready for restoration.</done>
</task>

<task type="auto">
  <name>Task 2 (GREEN): Restore 5 deleted files and verify tests pass</name>
  <files>
    .claude/agents/gsd-reflector.md
    .claude/agents/gsd-signal-collector.md
    .claude/agents/gsd-spike-runner.md
    .claude/commands/gsd/reflect.md
    .claude/commands/gsd/spike.md
  </files>
  <action>
    Restore each file using `git show f664984^:<path>` to extract the pre-deletion content:

    ```bash
    git show f664984^:.claude/agents/gsd-reflector.md > .claude/agents/gsd-reflector.md
    git show f664984^:.claude/agents/gsd-signal-collector.md > .claude/agents/gsd-signal-collector.md
    git show f664984^:.claude/agents/gsd-spike-runner.md > .claude/agents/gsd-spike-runner.md
    git show f664984^:.claude/commands/gsd/reflect.md > .claude/commands/gsd/reflect.md
    git show f664984^:.claude/commands/gsd/spike.md > .claude/commands/gsd/spike.md
    ```

    After restoration, verify content quality:
    1. Confirm each file has the expected line count (reflector ~278, signal-collector ~209, spike-runner ~474, reflect cmd ~87, spike cmd ~64)
    2. Grep all 5 files for `.claude/gsd-knowledge/` — there MUST be zero matches (stale path). If any found, the wrong commit was used.
    3. Grep for `~/.gsd/knowledge/` — this is the correct KB path and should appear in agent specs.

    Stage with forced add (required because .claude/ is gitignored):
    ```bash
    git add -f .claude/agents/gsd-reflector.md .claude/agents/gsd-signal-collector.md .claude/agents/gsd-spike-runner.md .claude/commands/gsd/reflect.md .claude/commands/gsd/spike.md
    ```

    Now run the wiring validation tests again to confirm GREEN:
    ```bash
    npx vitest run tests/integration/wiring-validation.test.js
    ```

    All 20 tests must pass (0 failures). The 4 previously-failing tests from Task 1 should now pass:
    1. `@-references in workflows resolve` — run-spike.md @.claude/agents/gsd-spike-runner.md now resolves
    2. `subagent_type values match agent files` — gsd-signal-collector and gsd-reflector now have matching files
    3. `reflect command exists` — .claude/commands/gsd/reflect.md now exists
    4. `spike command exists` — .claude/commands/gsd/spike.md now exists

    If any test still fails, investigate and fix before committing.

    After tests pass, commit the restoration:
    ```bash
    git commit -m "feat(28-01): restore 3 agent specs + 2 commands deleted by f664984"
    ```

    Note: Files are already staged with `git add -f`. Do NOT re-add without -f flag.

    IMPORTANT: Do NOT modify any workflow files (get-shit-done/workflows/*.md), reference docs, or command files in commands/gsd/. The fix is purely additive — restoring these 5 files resolves all dangling references. The 3 workflow changes from f664984 (KB path fixes, runtime check removal, research-first advisory) are legitimate and must be kept.

    KNOWN DEBT: The restored agents have inline execution protocol sections (pre-Phase 22). Phase 22 extracted shared protocol into references/agent-protocol.md for the other 8 agents, but these 3 were already deleted at that point. They work correctly with inline protocol but are inconsistent with the rest of the agent fleet. Note this in the summary as future cleanup.
  </action>
  <verify>
    - `wc -l .claude/agents/gsd-reflector.md` shows ~278 lines
    - `wc -l .claude/agents/gsd-signal-collector.md` shows ~209 lines
    - `wc -l .claude/agents/gsd-spike-runner.md` shows ~474 lines
    - `wc -l .claude/commands/gsd/reflect.md` shows ~87 lines
    - `wc -l .claude/commands/gsd/spike.md` shows ~64 lines
    - `grep -r '.claude/gsd-knowledge/' .claude/agents/ .claude/commands/gsd/reflect.md .claude/commands/gsd/spike.md` returns zero matches
    - `git status` shows all 5 files staged (new file)
    - `npx vitest run tests/integration/wiring-validation.test.js` shows 20/20 passed, 0 failed
    - `git log --oneline -1` shows the restoration commit
  </verify>
  <done>GREEN confirmed: 20/20 wiring validation tests pass (up from 16/20 baseline). All 5 files restored with correct KB paths, committed. Known debt: inline protocol inconsistency with Phase 22 agent-protocol.md extraction noted for future cleanup.</done>
</task>

</tasks>

<verification>
1. TDD baseline captured: 16/20 passing, 4/20 failing before restoration
2. All 5 files exist on disk with expected content:
   - `.claude/agents/gsd-reflector.md` (~278 lines)
   - `.claude/agents/gsd-signal-collector.md` (~209 lines)
   - `.claude/agents/gsd-spike-runner.md` (~474 lines)
   - `.claude/commands/gsd/reflect.md` (~87 lines)
   - `.claude/commands/gsd/spike.md` (~64 lines)
3. No stale KB paths: `grep -r '.claude/gsd-knowledge/' .claude/agents/ .claude/commands/gsd/reflect.md .claude/commands/gsd/spike.md` returns nothing
4. Wiring validation GREEN: `npx vitest run tests/integration/wiring-validation.test.js` shows 20/20 passed
5. Git: All 5 files committed (not just staged)
6. Known debt documented: restored agents use inline protocol (pre-Phase 22 extraction)
</verification>

<success_criteria>
- TDD RED baseline confirmed before any changes (4 specific failures identified)
- 20/20 wiring validation tests pass (0 failures, up from 16/20 baseline)
- All 3 agent specs exist and contain correct KB paths (~/.gsd/knowledge/)
- Both command files exist and route to their respective workflows
- No workflow, reference, or existing command files were modified (fix is purely additive)
- Known debt (inline protocol inconsistency) documented in summary
</success_criteria>

<output>
After completion, create `.planning/phases/28-restore-deleted-commands/28-01-SUMMARY.md`
</output>
