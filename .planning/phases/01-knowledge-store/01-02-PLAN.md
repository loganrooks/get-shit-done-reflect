---
phase: 01-knowledge-store
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .claude/agents/kb-create-dirs.sh
  - .claude/agents/kb-rebuild-index.sh
autonomous: true

must_haves:
  truths:
    - "Running the directory creation script produces the complete knowledge base directory tree at ~/.claude/gsd-knowledge/"
    - "Running the index rebuild script generates a valid index.md from existing entry files"
    - "Index rebuild is atomic -- writes to temp file then renames"
  artifacts:
    - path: ".claude/agents/kb-create-dirs.sh"
      provides: "Directory structure initialization script"
      contains: "mkdir -p, signals, spikes, lessons"
    - path: ".claude/agents/kb-rebuild-index.sh"
      provides: "Index generation script"
      contains: "index.md, Generated, Signals, Spikes, Lessons"
  key_links:
    - from: ".claude/agents/kb-rebuild-index.sh"
      to: "~/.claude/gsd-knowledge/index.md"
      via: "file write"
      pattern: "index.md"
    - from: ".claude/agents/kb-rebuild-index.sh"
      to: ".claude/agents/knowledge-store.md"
      via: "follows schema specification"
      pattern: "frontmatter fields"
---

<objective>
Create the operational scripts that initialize the knowledge store directory structure and rebuild the index.

Purpose: The reference doc (Plan 01) defines what the knowledge store IS. This plan creates the scripts that agents use to set up and maintain the store. Directory creation is idempotent. Index rebuild is atomic and derives from file contents.

Output: Two new shell scripts in `.claude/agents/` -- one for directory creation, one for index rebuild.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-knowledge-store/01-01-SUMMARY.md
@.claude/agents/knowledge-store.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create directory initialization script</name>
  <files>.claude/agents/kb-create-dirs.sh</files>
  <action>
Create `.claude/agents/kb-create-dirs.sh` -- a bash script that creates the complete knowledge base directory tree. Must be idempotent (safe to run multiple times).

The script should:
1. Set `KB_DIR="$HOME/.claude/gsd-knowledge"`
2. Create all required directories with `mkdir -p`:
   - `$KB_DIR/signals/`
   - `$KB_DIR/spikes/`
   - `$KB_DIR/lessons/`
3. Print confirmation of what was created/verified
4. Exit 0 on success

Keep it simple -- no error handling beyond what mkdir -p provides. No dependencies.
Make it executable (`chmod +x` in verify step).
  </action>
  <verify>
- `bash .claude/agents/kb-create-dirs.sh` runs without errors
- `ls ~/.claude/gsd-knowledge/` shows signals, spikes, lessons directories
- Running the script a second time is safe (idempotent)
  </verify>
  <done>Directory initialization script exists and creates the complete knowledge base directory structure.</done>
</task>

<task type="auto">
  <name>Task 2: Create index rebuild script</name>
  <files>.claude/agents/kb-rebuild-index.sh</files>
  <action>
Create `.claude/agents/kb-rebuild-index.sh` -- a bash script that regenerates `~/.claude/gsd-knowledge/index.md` from all entry files.

The script must:
1. Set `KB_DIR="$HOME/.claude/gsd-knowledge"`
2. Write to a temp file (`$KB_DIR/index.md.tmp`), then `mv` to `$KB_DIR/index.md` (atomic)
3. Generate the index following the format defined in `knowledge-store.md`:

**Header:**
```
# Knowledge Store Index

**Generated:** {ISO-8601 timestamp}
**Total entries:** {count}
```

**Signals section:**
```
## Signals ({count})

| ID | Project | Severity | Tags | Date | Status |
|----|---------|----------|------|------|--------|
```
Populate by scanning `$KB_DIR/signals/` recursively for `.md` files, extracting frontmatter fields with grep.

**Spikes section:**
```
## Spikes ({count})

| ID | Project | Outcome | Tags | Date | Status |
|----|---------|---------|------|------|--------|
```
Populate by scanning `$KB_DIR/spikes/` recursively.

**Lessons section:**
```
## Lessons ({count})

| ID | Category | Durability | Tags | Date | Status |
|----|----------|------------|------|------|--------|
```
Populate by scanning `$KB_DIR/lessons/` recursively.

For frontmatter field extraction, use simple grep/sed patterns:
```bash
id=$(grep "^id:" "$file" | head -1 | sed 's/^id:[[:space:]]*//')
```

Only include entries with `status: active` (or entries where status field is missing -- default to active). Exclude `status: archived`.

Sort entries within each section by date (newest first).

Handle empty knowledge base gracefully (no entries = empty tables with headers only).

Make it executable.
  </action>
  <verify>
- `bash .claude/agents/kb-rebuild-index.sh` runs without errors on empty knowledge base
- `cat ~/.claude/gsd-knowledge/index.md` shows valid markdown with header, three sections, table headers
- Total entries shows 0 for empty KB
- No `index.md.tmp` file left behind after successful run
  </verify>
  <done>Index rebuild script generates a valid index.md from knowledge base files, handles empty state, and uses atomic write.</done>
</task>

</tasks>

<verification>
- Both scripts exist in `.claude/agents/` and are executable
- Directory script creates the full tree at `~/.claude/gsd-knowledge/`
- Index script generates valid `index.md` matching the format spec in `knowledge-store.md`
- Index rebuild is atomic (temp file + rename)
- Both scripts work on empty knowledge base
- Fork constraint: only new files created
</verification>

<success_criteria>
The knowledge base can be initialized from scratch and its index rebuilt at any time using these two scripts. Both are idempotent and handle edge cases (empty KB, re-runs).
</success_criteria>

<output>
After completion, create `.planning/phases/01-knowledge-store/01-02-SUMMARY.md`
</output>
