---
phase: 03-spike-runner
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/references/spike-execution.md
  - .claude/agents/gsd-spike-runner.md
autonomous: true

must_haves:
  truths:
    - "Spike workflow rules (Design -> Build -> Run -> Document phases) are fully specified"
    - "A spike runner agent exists that can read DESIGN.md and produce DECISION.md"
    - "Max 2 iteration rounds, workspace isolation, and KB persistence rules are documented"
  artifacts:
    - path: "get-shit-done/references/spike-execution.md"
      provides: "Spike workflow phases, types, success criteria patterns, iteration rules, KB integration"
      contains: "Design phase, Build phase, Run phase, Document phase, max 2 rounds, spike types"
    - path: ".claude/agents/gsd-spike-runner.md"
      provides: "Agent that executes spike Build -> Run -> Document phases from DESIGN.md"
      contains: "execution_flow, KB_write, iteration_handling, checkpoint_on_deviation"
  key_links:
    - from: ".claude/agents/gsd-spike-runner.md"
      to: "get-shit-done/references/spike-execution.md"
      via: "@-reference in agent instructions"
      pattern: "spike-execution.md"
    - from: ".claude/agents/gsd-spike-runner.md"
      to: ".claude/agents/knowledge-store.md"
      via: "@-reference for KB schema"
      pattern: "knowledge-store.md"
---

<objective>
Create the spike execution reference document and spike runner agent that form the foundation for all spike operations in Phase 3.

Purpose: The reference doc defines HOW spikes work (phases, types, success criteria, iteration rules, KB integration). The agent defines WHO executes the Build/Run/Document phases. All other Phase 3 plans (templates, command, integration) depend on these two files.

Output: Two new files -- a reference doc with spike workflow rules and an agent definition.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-spike-runner/03-CONTEXT.md
@.planning/phases/03-spike-runner/03-RESEARCH.md
@.claude/agents/knowledge-store.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create spike execution reference document</name>
  <files>get-shit-done/references/spike-execution.md</files>
  <action>
Create `get-shit-done/references/spike-execution.md` as the authoritative reference for spike workflow rules. This is a NEW file (fork constraint: additive only).

The document must contain these sections:

**1. Overview**
- Purpose: defines spike workflow phases, types, success criteria patterns, and execution rules
- Core principle: Spikes produce FINDINGS, not DECISIONS. Existing GSD layers (CONTEXT.md, RESEARCH.md) make decisions based on findings
- One spike = one question. Comparative questions (A vs B vs C) are one spike with multiple experiments
- Consumers: gsd-spike-runner agent, /gsd:spike command, plan-phase orchestrator, new-project orchestrator

**2. Spike Types**

| Type | When to Use | Success Criteria Pattern |
|------|-------------|--------------------------|
| Binary | Yes/no feasibility questions | Clear threshold defined upfront ("latency < 100ms") |
| Comparative | Choose between known options | Metrics to compare, winner criteria defined |
| Exploratory | Understand a space | Learning goals, can refine during spike |
| Open Inquiry | Questions that don't fit above | Flexible, Claude's discretion on structure |

**3. Spike Phases**

Design phase (cognitive):
- Input: Open Question from RESEARCH.md or user-provided question
- Process: Define hypothesis, success criteria, experiment plan
- Output: .planning/spikes/{index}-{slug}/DESIGN.md
- Mode: Hybrid -- orchestrator drafts, user confirms (interactive) or auto-approve (YOLO)
- NOT executed by spike-runner agent (orchestrator handles Design phase)

Build phase (implementation):
- Input: DESIGN.md experiment plan
- Process: Implement experiment scaffolding, test harness, variations
- Output: Working experiment code in spike workspace
- Mode: Agent-driven (gsd-spike-runner)

Run phase (execution):
- Input: Built experiments
- Process: Execute experiments, gather data, measure against criteria
- Output: FINDINGS.md (optional, for complex spikes with lots of data)
- Mode: Agent-driven (gsd-spike-runner)

Document phase (synthesis):
- Input: Experiment results
- Process: Analyze findings, form conclusion, document decision
- Output: DECISION.md (mandatory)
- Mode: Agent-driven (gsd-spike-runner)

**4. Workspace Isolation (SPKE-04)**
- Spike workspace: `.planning/spikes/{index}-{slug}/`
- Index: 3-digit sequential (001, 002, 003...)
- Slug: kebab-case derived from question, user can adjust in interactive mode
- All spike artifacts contained within workspace directory
- Experiment code lives in spike workspace (throwaway, not part of main codebase)
- No modification to main project files during spike execution

**5. Iteration Rules (SPKE-06, SPKE-07)**
- Maximum 2 rounds per spike (prevents rabbit holes)
- After Round 1 inconclusive:
  - Agent proposes narrowed hypothesis
  - User confirms (interactive) or auto-proceeds (YOLO)
  - Round 2 executes with focused scope
- After Round 2 inconclusive:
  - Document honestly: "No clear winner"
  - Decision becomes: proceed with default/simplest approach
  - Still valuable: learned there's no empirical differentiator

Iteration state tracking in DESIGN.md frontmatter:
```yaml
status: designing | building | running | complete | inconclusive
round: 1 | 2
```

**6. DECISION.md Requirements (SPKE-05)**
- Mandatory fields: Question, Answer (one-line), Chosen approach, Rationale, Confidence
- Decision field is REQUIRED -- the output is a decision, not a report
- Confidence levels: HIGH (strong empirical evidence), MEDIUM (some evidence, some inference), LOW (limited data, educated guess)
- "No clear winner, using default" IS a valid decision

**7. Sensitivity Settings**

| Setting | What Gets Spiked | Use Case |
|---------|------------------|----------|
| Conservative | Only Critical gaps | Ship fast, spike only blockers |
| Balanced | Critical + Medium gaps | Default, reasonable coverage |
| Aggressive | Any genuine gap | Thorough validation, frontier work |

Derivation from depth:
- depth: quick -> spike_sensitivity: conservative
- depth: standard -> spike_sensitivity: balanced
- depth: comprehensive -> spike_sensitivity: aggressive

Can be overridden explicitly in config.json.

**8. KB Integration (SPKE-09)**
After spike completion:
1. Create spike entry in `~/.claude/gsd-knowledge/spikes/{project}/`
2. Use spike body template from knowledge-store.md
3. Frontmatter includes: hypothesis, outcome (confirmed/rejected/partial/inconclusive), rounds
4. Copy relevant content from DECISION.md to KB entry
5. Rebuild KB index

**9. Spike Dependencies**
- Spikes can depend on other spikes via `depends_on` in DESIGN.md
- Dependent spikes run after their dependencies complete
- Guidance: If dependency chains are complex, it's probably one bigger spike with multiple experiments

**10. Anti-Patterns**
- Scope creep: Trying to answer multiple unrelated questions. Split into separate spikes.
- Analysis paralysis: More than 2 iteration rounds. Force a decision.
- Gold plating: Over-engineering experiment infrastructure. Keep it minimal, throwaway code is fine.
- Missing decision: DECISION.md that reads like a report. Always commit to a decision.
- Premature spiking: Running spikes for questions that normal research could answer.

**11. Checkpoint Behaviors**
- Checkpoint on deviation: If experiment doesn't work as planned, agent checkpoints for guidance
- Interactive vs YOLO:
  - Interactive: User confirms DESIGN.md before Build phase
  - YOLO: Auto-approve DESIGN.md, auto-proceed on inconclusive Round 1
  </action>
  <verify>
- File exists at `get-shit-done/references/spike-execution.md`
- Contains all 11 sections
- Spike types table with 4 types
- 4 phases documented (Design, Build, Run, Document)
- Max 2 rounds specified
- Workspace isolation rules at .planning/spikes/{index}-{slug}/
- KB integration steps documented
- Sensitivity settings table
  </verify>
  <done>
A complete spike execution reference exists that any agent or command can read to know exactly how spikes work.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create spike runner agent</name>
  <files>.claude/agents/gsd-spike-runner.md</files>
  <action>
Create `.claude/agents/gsd-spike-runner.md` as the agent that executes spike Build -> Run -> Document phases. This is a NEW file (fork constraint: additive only).

The agent must follow the standard GSD agent pattern (YAML frontmatter with name, description, tools, color).

**Frontmatter:**
```yaml
---
name: gsd-spike-runner
description: Executes spike Build -> Run -> Document phases from DESIGN.md, producing DECISION.md and persisting results to the knowledge base
tools: Read, Write, Bash, Glob, Grep
color: cyan
---
```

**Agent structure:**

`<role>`: Spike execution agent. Spawned by /gsd:spike command or spike workflow. Reads DESIGN.md, executes experiments, produces DECISION.md, persists to KB.

Note: This agent does NOT handle the Design phase. The orchestrator (command or workflow) handles DESIGN.md creation with user interaction.

`<references>`: @-reference to:
- `get-shit-done/references/spike-execution.md` (spike workflow rules)
- `.claude/agents/knowledge-store.md` (KB schema)
- `.claude/agents/kb-templates/spike-design.md` (DESIGN.md template - for reference)
- `.claude/agents/kb-templates/spike-decision.md` (DECISION.md template)

`<execution_flow>`:

1. **Load DESIGN.md**: Read spike workspace DESIGN.md. Parse hypothesis, success criteria, experiment plan.

2. **BUILD phase**:
   - For each experiment in the plan:
     - Create experiment scaffolding in spike workspace
     - Keep code minimal -- throwaway is fine
     - Commit: `spike(build): {experiment-name} scaffolding`
   - If build fails or unexpected complexity: checkpoint for guidance

3. **RUN phase**:
   - Execute each experiment per the plan
   - Capture metrics, observations, outputs
   - Compare results against success criteria
   - If DESIGN.md specifies FINDINGS.md for complex data: create it
   - Checkpoint on major deviation from expected behavior

4. **Evaluate results**:
   - Determine if Round 1 produced conclusive answer
   - If conclusive: proceed to Document phase
   - If inconclusive AND round < 2:
     - Propose narrowed hypothesis
     - In interactive mode: checkpoint for approval
     - In YOLO mode: auto-proceed with narrowed scope
     - Update DESIGN.md status and round, re-run Build/Run
   - If inconclusive AND round >= 2:
     - Proceed to Document with "inconclusive" outcome

5. **DOCUMENT phase**:
   - Create DECISION.md using spike-decision template
   - Required fields: Question, Answer, Chosen approach, Rationale, Confidence
   - Include experiment results summary
   - "No clear winner, using default" is valid
   - Update DESIGN.md status to "complete" or "inconclusive"
   - Commit: `spike(doc): {spike-name} decision`

6. **KB persistence**:
   - Create spike entry at `~/.claude/gsd-knowledge/spikes/{project}/{spike-name}.md`
   - Use spike body template from knowledge-store
   - Frontmatter: hypothesis, outcome, rounds, tags derived from question
   - Body: Copy key sections from DECISION.md
   - Run: `bash ~/.claude/agents/kb-rebuild-index.sh`

7. **Return result**:
   - Structured output: spike name, outcome, decision summary, KB entry path
   - Return to orchestrator for RESEARCH.md update (orchestrator's responsibility)

`<checkpoint_triggers>`:
- Build fails unexpectedly
- Experiment produces dramatically different results than expected
- Round 1 inconclusive (in interactive mode)
- Ambiguous success criteria interpretation needed

`<output_format>`:
```markdown
## SPIKE COMPLETE

**Spike:** {spike-name}
**Outcome:** {confirmed | rejected | partial | inconclusive}
**Rounds:** {1 | 2}

### Decision

{One-line answer}

### Rationale

{Brief explanation}

### KB Entry

{path to KB spike entry}

### Artifacts

- DESIGN.md: {path}
- DECISION.md: {path}
- FINDINGS.md: {path if exists}
```

Do NOT include runtime code or bash scripts in the agent -- the agent uses its tools (Read, Write, Bash) to execute steps. The agent is instructions, not a script.
  </action>
  <verify>
- File exists at `.claude/agents/gsd-spike-runner.md`
- Has valid YAML frontmatter with name, description, tools, color
- References spike-execution.md, knowledge-store.md, and templates
- Execution flow covers: load DESIGN.md, BUILD, RUN, evaluate, DOCUMENT, KB persist, return
- Handles iteration (max 2 rounds)
- Checkpoint triggers documented
- Output format specified
- Does not modify any existing files (fork constraint)
  </verify>
  <done>
A spike runner agent exists that can be spawned to execute spike Build -> Run -> Document phases and persist results to the KB.
  </done>
</task>

</tasks>

<verification>
- `get-shit-done/references/spike-execution.md` exists with complete workflow rules
- `.claude/agents/gsd-spike-runner.md` exists with valid agent definition
- Agent references the execution reference doc
- Both files are additive only (no existing files modified)
- Workflow covers SPKE-02 (hypothesis before experimentation), SPKE-03 (structured design), SPKE-04 (isolated workspace), SPKE-05 (decision record), SPKE-06 (max 2 rounds), SPKE-07 (iterative narrowing), SPKE-09 (KB persistence)
</verification>

<success_criteria>
The spike execution rules and runner agent are fully defined so that Plans 02-04 can build templates, commands, and integrations that invoke them.
</success_criteria>

<output>
After completion, create `.planning/phases/03-spike-runner/03-01-SUMMARY.md`
</output>
