---
phase: 03-spike-runner
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - .claude/commands/spike.md
  - get-shit-done/workflows/run-spike.md
autonomous: true

must_haves:
  truths:
    - "/gsd:spike command exists for manual spike invocation"
    - "A workflow orchestrates the full spike flow including DESIGN.md creation and agent spawning"
    - "Spike workspace is created at .planning/spikes/{index}-{slug}/"
  artifacts:
    - path: ".claude/commands/spike.md"
      provides: "Command entry point for /gsd:spike"
      contains: "argument parsing, workflow invocation, usage examples"
    - path: "get-shit-done/workflows/run-spike.md"
      provides: "Orchestration workflow for spike Design phase and agent spawning"
      contains: "workspace creation, DESIGN.md drafting, user confirmation, agent spawn, RESEARCH.md update"
  key_links:
    - from: ".claude/commands/spike.md"
      to: "get-shit-done/workflows/run-spike.md"
      via: "Workflow invocation"
      pattern: "run-spike.md"
    - from: "get-shit-done/workflows/run-spike.md"
      to: ".claude/agents/gsd-spike-runner.md"
      via: "Agent spawn"
      pattern: "gsd-spike-runner"
    - from: "get-shit-done/workflows/run-spike.md"
      to: ".claude/agents/kb-templates/spike-design.md"
      via: "Template reference for DESIGN.md creation"
      pattern: "spike-design.md"
---

<objective>
Create the /gsd:spike command and run-spike workflow that enable manual spike invocation.

Purpose: The command provides the entry point for users to manually trigger spikes. The workflow handles the Design phase (drafting DESIGN.md with user confirmation) and spawns the spike-runner agent for Build/Run/Document phases. This implements SPKE-01.

Output: Command file and workflow file that together enable the full spike flow.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-spike-runner/03-CONTEXT.md
@.planning/phases/03-spike-runner/03-RESEARCH.md
@.planning/phases/03-spike-runner/03-01-SUMMARY.md
@.planning/phases/03-spike-runner/03-02-SUMMARY.md
@.claude/agents/gsd-spike-runner.md
@.claude/agents/kb-templates/spike-design.md
@.claude/agents/kb-templates/spike-decision.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /gsd:spike command</name>
  <files>.claude/commands/spike.md</files>
  <action>
Create `.claude/commands/spike.md` as the entry point for manual spike invocation. This is a NEW file (fork constraint: additive only).

The command follows the established pattern from Phase 2 (signal.md command) -- a thin routing layer that delegates to the workflow.

**Command content:**

```markdown
# /gsd:spike

Translate design uncertainty into a structured experiment with testable hypotheses.

## Usage

```
/gsd:spike "Which OCR library performs best on handwritten text?"
/gsd:spike                    # Interactive: prompts for question
/gsd:spike --phase 3          # Links spike to specific phase
```

## Arguments

| Argument | Type | Required | Description |
|----------|------|----------|-------------|
| question | string | no | The question to investigate. If omitted, prompts interactively. |
| --phase | number | no | Link spike to a specific phase (for RESEARCH.md integration) |

## Behavior

1. **Route to workflow:** Invoke `get-shit-done/workflows/run-spike.md` with arguments
2. **No command-level logic:** All spike logic lives in the workflow

## Examples

**Standalone spike (project-level):**
```
/gsd:spike "Should we use Prisma or Drizzle for the database layer?"
```

**Phase-linked spike:**
```
/gsd:spike --phase 3 "Is server-side rendering feasible for the dashboard?"
```

**Interactive mode:**
```
/gsd:spike
> What question would you like to investigate?
```

## Workflow Reference

See: `get-shit-done/workflows/run-spike.md`

## Related

- `/gsd:collect-signals` -- Post-execution signal collection
- `/gsd:signal` -- Manual signal logging
- `/gsd:reflect` -- Pattern analysis (Phase 4)
```

**Implementation note:** The command file is documentation + routing. When Claude sees `/gsd:spike`, it reads this file and follows the instruction to invoke the workflow.
  </action>
  <verify>
- File exists at `.claude/commands/spike.md`
- Contains usage section with examples
- Documents arguments (question, --phase)
- References workflow file (run-spike.md)
- Follows established command pattern (thin routing layer)
  </verify>
  <done>
The /gsd:spike command exists and routes to the run-spike workflow.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create run-spike workflow</name>
  <files>get-shit-done/workflows/run-spike.md</files>
  <action>
Create `get-shit-done/workflows/run-spike.md` as the orchestration workflow for spike execution. This is a NEW file (fork constraint: additive only).

The workflow handles the Design phase and orchestrates the full spike flow.

**Workflow content:**

```markdown
# Run Spike Workflow

Orchestrates the full spike flow: workspace creation, Design phase (DESIGN.md), agent spawn for Build/Run/Document, and RESEARCH.md integration.

## References

@get-shit-done/references/spike-execution.md
@.claude/agents/gsd-spike-runner.md
@.claude/agents/kb-templates/spike-design.md
@.claude/agents/kb-templates/spike-decision.md
@.claude/agents/knowledge-store.md

## Inputs

| Input | Source | Required |
|-------|--------|----------|
| question | /gsd:spike argument or user prompt | yes |
| phase | /gsd:spike --phase argument | no |
| mode | .planning/config.json "mode" field | no (default: interactive) |
| sensitivity | .planning/config.json "spike_sensitivity" or derived from depth | no |

## Execution Flow

### 1. Parse Inputs

```bash
# Get question from argument or prompt
QUESTION="${1:-}"
if [ -z "$QUESTION" ]; then
  # Interactive: prompt user for question
  echo "What question would you like to investigate?"
  read QUESTION
fi

# Get phase linkage
PHASE="${2:-project-level}"

# Get mode
MODE=$(cat .planning/config.json 2>/dev/null | grep -o '"mode"[[:space:]]*:[[:space:]]*"[^"]*"' | cut -d'"' -f4)
MODE="${MODE:-interactive}"
```

### 2. Create Workspace

```bash
# Find next index
EXISTING=$(ls -d .planning/spikes/[0-9][0-9][0-9]-* 2>/dev/null | wc -l | tr -d ' ')
NEXT_INDEX=$(printf "%03d" $((EXISTING + 1)))

# Generate slug from question
SLUG=$(echo "$QUESTION" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9]/-/g' | sed 's/--*/-/g' | sed 's/^-//;s/-$//' | cut -c1-40)

# Create workspace
WORKSPACE=".planning/spikes/${NEXT_INDEX}-${SLUG}"
mkdir -p "$WORKSPACE"
```

### 3. Draft DESIGN.md (Design Phase)

Using the spike-design template, create DESIGN.md with:

- **Question:** {from input}
- **Type:** Infer from question patterns:
  - "Which/what/best" -> Comparative
  - "Can/is/does/will" -> Binary
  - "How does/why/explore" -> Exploratory
  - Other -> Open Inquiry (user can adjust)
- **Hypothesis:** Draft initial hypothesis from question
- **Success Criteria:** Draft measurable criteria based on type
- **Experiment Plan:** Draft 2-3 experiments

Write to `$WORKSPACE/DESIGN.md`.

### 4. User Confirmation (Interactive Mode)

**If mode == interactive:**

Present DESIGN.md to user:

```markdown
## SPIKE DESIGN

**Workspace:** {workspace path}
**Question:** {question}
**Type:** {inferred type}

### Hypothesis

{drafted hypothesis}

### Success Criteria

{drafted criteria}

### Experiment Plan

{drafted experiments}

---

**Options:**
1. Approve and proceed to Build phase
2. Edit DESIGN.md (opens for modification)
3. Cancel spike

Select [1/2/3]:
```

Wait for user response. If option 2, allow edits, then re-present.

**If mode == yolo:**

Auto-approve DESIGN.md, proceed immediately.

### 5. Spawn Spike Runner Agent

```markdown
**Spawning gsd-spike-runner agent**

@.claude/agents/gsd-spike-runner.md

Execute Build -> Run -> Document phases for:
- Workspace: {workspace path}
- DESIGN.md: {workspace}/DESIGN.md

Return when complete with outcome and decision summary.
```

### 6. Handle Agent Result

Parse agent output:
- outcome: confirmed | rejected | partial | inconclusive
- decision: one-line summary
- kb_entry: path to KB spike entry

### 7. Update RESEARCH.md (If Phase-Linked)

**If phase was specified:**

Read `{PHASE_DIR}/*-RESEARCH.md` and add/update "Resolved by Spike" section:

```markdown
## Open Questions

### Resolved by Spike

1. **{Question}**
   - Decision: {one-line answer from DECISION.md}
   - Evidence: {brief summary}
   - Full analysis: {path to DECISION.md}
   - Confidence: {HIGH|MEDIUM|LOW}
```

If RESEARCH.md doesn't exist yet, note that spike resolution should be added when it's created.

### 8. Report Result

```markdown
## SPIKE COMPLETE

**Spike:** {index}-{slug}
**Outcome:** {outcome}
**Decision:** {one-line decision}

### Artifacts

- Workspace: {workspace path}
- DESIGN.md: {workspace}/DESIGN.md
- DECISION.md: {workspace}/DECISION.md
- KB Entry: {kb_entry path}

{If phase-linked:}
### Integration

RESEARCH.md updated with spike resolution at:
{phase RESEARCH.md path}
```

## Error Handling

- **No .planning/ directory:** Error - run from project root with GSD initialized
- **Agent checkpoint:** Surface to user, await guidance
- **KB write failure:** Log warning, spike artifacts still valid in workspace

## Mode Behaviors

| Mode | Design Confirmation | Inconclusive Round 1 |
|------|---------------------|----------------------|
| interactive | User confirms | Checkpoint for narrowing approval |
| yolo | Auto-approve | Auto-proceed with agent's narrowed hypothesis |

## Sensitivity Behaviors

Sensitivity affects spike triggering from orchestrators (plan-phase, new-project), not this manual command. /gsd:spike always runs the requested spike regardless of sensitivity setting.
```

The workflow is instructions for Claude to follow, not a bash script. Claude reads this and executes the steps using its tools.
  </action>
  <verify>
- File exists at `get-shit-done/workflows/run-spike.md`
- Contains all 8 execution flow steps
- References spike-execution.md, gsd-spike-runner.md, templates
- Handles both interactive and YOLO modes
- Creates workspace at .planning/spikes/{index}-{slug}/
- Spawns gsd-spike-runner agent for Build/Run/Document
- Updates RESEARCH.md if phase-linked
- Output format matches CONTEXT.md design
  </verify>
  <done>
The run-spike workflow fully orchestrates spike execution from question input through KB persistence.
  </done>
</task>

</tasks>

<verification>
- `.claude/commands/spike.md` exists with proper usage documentation
- `get-shit-done/workflows/run-spike.md` exists with complete orchestration flow
- Command routes to workflow (thin layer pattern)
- Workflow handles Design phase with user confirmation
- Agent spawning properly documented
- RESEARCH.md integration for phase-linked spikes
- Both files are additive only (no existing files modified)
</verification>

<success_criteria>
Users can run `/gsd:spike "question"` and get a complete spike workflow: workspace creation, DESIGN.md draft and approval, Build/Run/Document execution, and KB persistence.
</success_criteria>

<output>
After completion, create `.planning/phases/03-spike-runner/03-03-SUMMARY.md`
</output>
