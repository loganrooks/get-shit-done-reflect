---
phase: 22-agent-boilerplate-extraction
plan: 05
type: execute
wave: 3
depends_on: ["22-02", "22-03", "22-04"]
files_modified:
  - .planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md
  - .planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "Before/after comparison completed for gsd-executor, gsd-planner, and gsd-verifier"
    - "Every operational instruction from each original agent spec exists either in the post-extraction spec or in the shared protocol"
    - "No agent lost domain-specific methodology during extraction"
    - "Extraction registry updated with final line counts showing actual reduction per agent"
  artifacts:
    - path: ".planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md"
      provides: "Before/after comparison report for 3 verification agents"
      contains: "PASS"
    - path: ".planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md"
      provides: "Updated extraction registry with final metrics"
      contains: "Final Line Counts"
  key_links:
    - from: ".planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md"
      to: ".claude/agents/gsd-executor.md"
      via: "Before/after content audit"
      pattern: "gsd-executor"
    - from: ".planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md"
      to: ".claude/agents/gsd-planner.md"
      via: "Before/after content audit"
      pattern: "gsd-planner"
    - from: ".planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md"
      to: ".claude/agents/gsd-verifier.md"
      via: "Before/after content audit"
      pattern: "gsd-verifier"
---

<objective>
Verify no behavior change by comparing pre-extraction and post-extraction agent specs for 3 representative agents, and update the extraction registry with final metrics.

Purpose: AGENT-05 requires before/after output comparison to validate no behavior change. This plan performs a systematic content audit of 3 agents (executor, planner, verifier) to confirm every operational instruction from the original spec is covered by either the post-extraction spec or the shared protocol. Also finalizes the extraction registry with actual line count reductions.

Output: `22-VERIFICATION.md` (comparison report) + updated `22-EXTRACTION-REGISTRY.md` (final metrics)
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-agent-boilerplate-extraction/22-CONTEXT.md
@.planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md

Post-extraction agents:
@.claude/agents/gsd-executor.md
@.claude/agents/gsd-planner.md
@.claude/agents/gsd-verifier.md

Shared protocol:
@.claude/get-shit-done/references/agent-protocol.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Before/after content audit for 3 verification agents</name>
  <files>.planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md</files>
  <action>
Perform a systematic before/after content audit for gsd-executor, gsd-planner, and gsd-verifier.

**Method:**

For each of the 3 agents:

1. **Retrieve pre-extraction version** using git:
   ```bash
   git show HEAD:path/to/agent.md > /tmp/pre-extraction-agent.md
   ```
   (Use the commit BEFORE Plan 02/03/04 changes. Check `git log --oneline -10` to find the right commit.)

2. **Read post-extraction version** from current working tree.

3. **Read agent-protocol.md** for the shared content.

4. **Content coverage audit:** For each section/instruction in the pre-extraction version:
   - Is it still in the post-extraction spec? (Identity/domain content should be)
   - If not, is it in agent-protocol.md? (Operational content should be)
   - If neither, flag as MISSING — this is a regression.

5. **Positional ordering check:** Verify that agent-specific overrides appear ABOVE the `<required_reading>` tag.

6. **Section completeness check:** Verify these domain sections are intact:
   - Executor: deviation_rules, authentication_gates, checkpoint_protocol, tdd_execution, summary_creation, self_check, state_updates
   - Planner: context_fidelity, discovery_levels, task_breakdown, dependency_graph, scope_estimation, plan_format, goal_backward, checkpoints, tdd_integration, gap_closure_mode, revision_mode
   - Verifier: must_haves verification methodology, truth checking, artifact validation, key link verification

**Write `22-VERIFICATION.md`** with:

```markdown
# Phase 22: Extraction Verification Report

**Date:** [date]
**Agents verified:** gsd-executor, gsd-planner, gsd-verifier
**Method:** Content coverage audit (pre-extraction vs post-extraction + protocol)

## Agent: gsd-executor

### Pre-Extraction Stats
- Lines: [N]
- Sections: [list]

### Post-Extraction Stats
- Lines: [N] (reduction: [N] lines, [X]%)
- Sections retained: [list]
- Sections extracted to protocol: [list]

### Coverage Audit
| Pre-Extraction Section/Instruction | Post Location | Status |
|-------------------------------------|---------------|--------|
| Git safety (L246) | Protocol Section 1 | COVERED |
| Commit type table (L253-260) | Protocol Section 3 | COVERED |
| deviation_rules | Agent spec (unchanged) | RETAINED |
...

### Positional Check
- Agent overrides above required_reading: [PASS/FAIL]
- Domain methodology intact: [PASS/FAIL]

### Verdict: [PASS/FAIL]

## Agent: gsd-planner
[Same structure]

## Agent: gsd-verifier
[Same structure]

## Overall Verdict: [PASS/FAIL]

### Summary
- Agents verified: 3/3
- Content coverage: [X]% (all pre-extraction content accounted for)
- Regressions found: [N]
- [If regressions:] Remediation needed: [details]
```

If any MISSING content is found, document it clearly but do NOT fix it in this plan — flag for remediation.
  </action>
  <verify>
1. File exists: `ls .planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md`
2. Contains all 3 agent sections: `grep -c "## Agent:" .planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md` returns 3
3. Contains overall verdict: `grep -c "Overall Verdict" .planning/phases/22-agent-boilerplate-extraction/22-VERIFICATION.md` returns 1
  </verify>
  <done>22-VERIFICATION.md exists with before/after content audit for executor, planner, and verifier. Every pre-extraction instruction is accounted for in either the post-extraction spec or the shared protocol. Overall verdict documented.</done>
</task>

<task type="auto">
  <name>Task 2: Update extraction registry with final line counts and metrics</name>
  <files>.planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md</files>
  <action>
Update the extraction registry (created in Plan 01) with final metrics now that all 11 agents have been edited.

**Add a "Final Line Counts" section:**

```markdown
## Final Line Counts

| Agent | Pre-Extraction | Post-Extraction | Lines Removed | % Reduction |
|-------|---------------|-----------------|---------------|-------------|
| gsd-executor | [N] | [N] | [N] | [X]% |
| gsd-planner | [N] | [N] | [N] | [X]% |
| gsd-debugger | [N] | [N] | [N] | [X]% |
...all 11 agents...
| **Total** | **7,015** | **[N]** | **[N]** | **[X]%** |

**Protocol file:** agent-protocol.md — [N] lines
**Net change:** [Total lines removed] - [protocol lines] = [net reduction/increase]
```

Get pre-extraction line counts from git:
```bash
git show HEAD~N:.claude/agents/gsd-executor.md | wc -l
```
(Adjust HEAD~N to the commit before extraction changes.)

Get post-extraction line counts from working tree:
```bash
wc -l .claude/agents/gsd-executor.md
```

**Add a "Verification Results" section** referencing 22-VERIFICATION.md:

```markdown
## Verification Results

See: 22-VERIFICATION.md

- Agents verified: gsd-executor, gsd-planner, gsd-verifier
- Overall verdict: [PASS/FAIL]
- Content coverage: [X]%
```
  </action>
  <verify>
1. `grep -c "Final Line Counts" .planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md` returns 1
2. `grep -c "Verification Results" .planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md` returns 1
3. `grep -c "gsd-executor" .planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md` returns at least 2 (in extraction table and line counts)
  </verify>
  <done>Extraction registry updated with final line counts for all 11 agents (pre/post extraction), protocol file size, net line reduction, and verification results summary.</done>
</task>

</tasks>

<verification>
- [ ] 22-VERIFICATION.md exists with content audit for 3 agents
- [ ] Each verified agent has PASS/FAIL verdict
- [ ] Overall verdict is documented
- [ ] Extraction registry has final line counts for all 11 agents
- [ ] Net line reduction is calculated (total lines removed minus protocol lines added)
- [ ] Verification results are cross-referenced in extraction registry
</verification>

<success_criteria>
Before/after comparison confirms no behavioral regression for the 3 verified agents (executor, planner, verifier). Extraction registry is complete with final metrics. All AGENT-05 requirements satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/22-agent-boilerplate-extraction/22-05-SUMMARY.md`
</output>
