---
phase: 22-agent-boilerplate-extraction
plan: 02
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - .claude/agents/gsd-executor.md
  - .claude/agents/gsd-planner.md
autonomous: true

must_haves:
  truths:
    - "gsd-executor.md loads agent-protocol.md via <required_reading> and no longer contains inline git safety, commit format, or gsd-tools commit pattern"
    - "gsd-planner.md loads agent-protocol.md via <required_reading> and no longer contains inline quality degradation curve or gsd-tools commit pattern"
    - "Both agents retain their full identity sections (role, philosophy, domain methodology, execution steps) above the required_reading tag"
  artifacts:
    - path: ".claude/agents/gsd-executor.md"
      provides: "Lean executor spec referencing shared protocol"
      contains: "<required_reading>"
    - path: ".claude/agents/gsd-planner.md"
      provides: "Lean planner spec referencing shared protocol"
      contains: "<required_reading>"
  key_links:
    - from: ".claude/agents/gsd-executor.md"
      to: ".claude/get-shit-done/references/agent-protocol.md"
      via: "<required_reading> tag"
      pattern: "required_reading"
    - from: ".claude/agents/gsd-planner.md"
      to: ".claude/get-shit-done/references/agent-protocol.md"
      via: "<required_reading> tag"
      pattern: "required_reading"
---

<objective>
Extract shared operational content from gsd-executor.md and gsd-planner.md, replacing inline duplication with a `<required_reading>` reference to the shared protocol.

Purpose: These are two of the most critical agents (executor runs every plan, planner creates every plan) and both contain significant duplicated operational content. Extracting makes them leaner and ensures they always use the latest shared conventions.

Output: Two leaner agent specs, each with `<required_reading>` reference to agent-protocol.md
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-agent-boilerplate-extraction/22-CONTEXT.md
@.planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md

Protocol reference (what's now shared):
@.claude/get-shit-done/references/agent-protocol.md

Agents to edit:
@.claude/agents/gsd-executor.md
@.claude/agents/gsd-planner.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract shared content from gsd-executor.md</name>
  <files>.claude/agents/gsd-executor.md</files>
  <action>
Edit `gsd-executor.md` to remove sections now covered by the shared protocol, and add a `<required_reading>` reference.

**REMOVE these sections/content (now in protocol):**

1. **Git safety rules** from `<task_commit_protocol>` — The "NEVER `git add .` or `git add -A`" rule and individual staging instructions (L246-250). The task_commit_protocol section structure STAYS but the git safety rules within it move to protocol.

2. **Commit type table** from `<task_commit_protocol>` — The feat/fix/test/refactor/chore table (L253-260). This is now in protocol Section 3 (which references git-integration.md).

3. **Commit format pattern** — The `git commit -m "{type}({phase}-{plan}): ..."` pattern (L262-268). Now in protocol.

4. **gsd-tools.js commit pattern** from `<final_commit>` — The `node ./.claude/get-shit-done/bin/gsd-tools.js commit ...` pattern. The final_commit section can be simplified to just say "Commit using gsd-tools.js commit pattern (see protocol)." BUT keep the specific message format and file list since those are executor-specific.

5. **commit_docs convention** — Any inline mention that commit_docs controls git only. Now in protocol Section 5.

**KEEP these sections (identity/domain-specific):**
- `<role>` — executor identity
- `<execution_flow>` — executor-specific steps (load_plan, record_start_time, determine_execution_pattern, execute_tasks)
- `<deviation_rules>` — entirely executor-specific domain methodology
- `<authentication_gates>` — executor-specific
- `<checkpoint_protocol>` — executor-specific (references checkpoints.md)
- `<checkpoint_return_format>` — executor-specific return format
- `<continuation_handling>` — executor-specific
- `<tdd_execution>` — executor-specific
- `<summary_creation>` — executor-specific
- `<self_check>` — executor-specific
- `<state_updates>` — executor-specific
- `<completion_format>` — executor-specific return format
- `<success_criteria>` — executor-specific

**KEEP the `<task_commit_protocol>` section shell** but simplify it: retain the step structure (check modified files, stage, commit, record hash) but remove the duplicated rules/tables that are now in the protocol. The section becomes a brief reference that says "Follow git safety and commit format from protocol" while keeping the executor-specific workflow (check modified files → stage → commit → record hash for SUMMARY).

**ADD `<required_reading>` tag** AFTER all agent-specific content that might override protocol defaults. Place it after the last identity/domain section and before `<execution_flow>`:

```markdown
<required_reading>
@./.claude/get-shit-done/references/agent-protocol.md
</required_reading>
```

**Positioning rule:** All executor-specific overrides ABOVE, shared protocol reference BELOW. The executor's deviation_rules, checkpoint_protocol, etc. are domain methodology that should have stronger positional attention than the generic protocol.

**Expected result:** Executor spec shrinks from ~403 lines, retains all identity and domain methodology, gains protocol reference.
  </action>
  <verify>
1. `grep -c "required_reading" .claude/agents/gsd-executor.md` returns 2 (open and close tags)
2. `grep -c "NEVER.*git add" .claude/agents/gsd-executor.md` returns 0 (git safety extracted)
3. `grep -c "feat.*fix.*test.*refactor" .claude/agents/gsd-executor.md` returns 0 (commit type table extracted)
4. `grep -c "deviation_rules" .claude/agents/gsd-executor.md` returns at least 1 (domain methodology retained)
5. `grep -c "checkpoint_protocol" .claude/agents/gsd-executor.md` returns at least 1 (domain methodology retained)
  </verify>
  <done>gsd-executor.md references shared protocol via required_reading, no longer contains inline git safety/commit format/gsd-tools patterns, retains all identity and domain-specific sections above the protocol reference.</done>
</task>

<task type="auto">
  <name>Task 2: Extract shared content from gsd-planner.md</name>
  <files>.claude/agents/gsd-planner.md</files>
  <action>
Edit `gsd-planner.md` to remove sections now covered by the shared protocol, and add a `<required_reading>` reference.

**REMOVE these sections/content (now in protocol):**

1. **Quality Degradation Curve table** from `<philosophy>` — The context usage table (L76-83: 0-30% PEAK, 30-50% GOOD, etc.) and the rule "Plans should complete within ~50% context." Move to protocol Section 11. The `<philosophy>` section STAYS but this operational table is removed from it. Keep the "Ship Fast" and "Solo Developer + Claude Workflow" and "Plans Are Prompts" content — those are identity.

2. **gsd-tools.js commit pattern** from `<step name="git_commit">` — The `node ./.claude/get-shit-done/bin/gsd-tools.js commit ...` invocation. Simplify to reference protocol. BUT keep the specific commit message and file paths since those are planner-specific.

3. **commit_docs convention** — Any inline mention that commit_docs controls git only. Now in protocol.

4. **Context Budget Rules in `<scope_estimation>`** — The detailed context per task estimates tables (L310-332) overlap with protocol Section 11 quality guidance. HOWEVER, the scope estimation section is heavily planner-specific (task sizing, split signals, depth calibration). Decision: Keep the scope_estimation section in full since it's planner methodology, not generic protocol. The quality degradation CURVE (the table) moves to protocol, but the planner's USE of context budgets for sizing stays.

**KEEP these sections (identity/domain-specific):**
- `<role>` — planner identity
- `<context_fidelity>` — planner-specific (user decision honoring)
- `<philosophy>` — planner identity (minus the quality degradation curve table)
- `<discovery_levels>` — planner-specific domain methodology
- `<task_breakdown>` — planner-specific domain methodology
- `<dependency_graph>` — planner-specific domain methodology
- `<scope_estimation>` — planner-specific (keep full, it's methodology not operations)
- `<plan_format>` — planner-specific output format
- `<goal_backward>` — planner-specific domain methodology
- `<checkpoints>` — planner-specific checkpoint design methodology
- `<tdd_integration>` — planner-specific TDD plan design
- `<gap_closure_mode>` — planner-specific
- `<revision_mode>` — planner-specific
- `<execution_flow>` — planner-specific steps
- `<structured_returns>` — planner-specific return formats
- `<success_criteria>` — planner-specific criteria

**ADD `<required_reading>` tag** after all agent-specific content. Given the planner's heavy domain methodology, place it just before `<execution_flow>`:

```markdown
<required_reading>
@./.claude/get-shit-done/references/agent-protocol.md
</required_reading>
```

**Special handling for quality degradation curve:** In `<philosophy>`, replace the table with a brief note: "See Quality & Context Budget in the shared agent protocol for the quality degradation curve. Rule: Plans should complete within ~50% context. More plans, smaller scope, consistent quality. Each plan: 2-3 tasks max." This keeps the planner's interpretation (sizing guidance) while pointing to the protocol for the table.

**Expected result:** Planner spec shrinks modestly (it's already heavily domain-specific, so less extraction than other agents), retains all identity and domain methodology, gains protocol reference.
  </action>
  <verify>
1. `grep -c "required_reading" .claude/agents/gsd-planner.md` returns 2 (open and close tags)
2. `grep -c "PEAK.*Thorough" .claude/agents/gsd-planner.md` returns 0 (quality curve table extracted)
3. `grep -c "context_fidelity" .claude/agents/gsd-planner.md` returns at least 1 (domain methodology retained)
4. `grep -c "goal_backward" .claude/agents/gsd-planner.md` returns at least 1 (domain methodology retained)
5. `grep -c "discovery_levels" .claude/agents/gsd-planner.md` returns at least 1 (domain methodology retained)
  </verify>
  <done>gsd-planner.md references shared protocol via required_reading, quality degradation curve table moved to protocol, all identity and domain-specific methodology retained above the protocol reference.</done>
</task>

</tasks>

<verification>
- [ ] Both agents contain `<required_reading>` referencing agent-protocol.md
- [ ] Executor no longer has inline git safety, commit type table, or commit format
- [ ] Planner no longer has inline quality degradation curve table
- [ ] Both agents retain all domain-specific sections (deviation rules, checkpoint protocol, goal-backward, etc.)
- [ ] Agent-specific content appears ABOVE the required_reading tag in both specs
- [ ] No content was removed that isn't covered by the shared protocol
</verification>

<success_criteria>
gsd-executor.md and gsd-planner.md are leaner, reference the shared protocol, and retain all domain-specific identity and methodology. The shared protocol covers everything that was removed.
</success_criteria>

<output>
After completion, create `.planning/phases/22-agent-boilerplate-extraction/22-02-SUMMARY.md`
</output>
