---
phase: 22-agent-boilerplate-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/get-shit-done/references/agent-protocol.md
  - .planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md
autonomous: true

must_haves:
  truths:
    - "agent-protocol.md contains all 12 shared protocol sections covering git safety, commit format, tool conventions, state file paths, and quality guidance"
    - "Protocol references git-integration.md for canonical commit format details instead of duplicating it"
    - "Protocol includes a header note directing convention changes to this file, not individual agent specs"
    - "Extraction registry maps every extracted section to its source agent(s) with line numbers"
  artifacts:
    - path: ".claude/get-shit-done/references/agent-protocol.md"
      provides: "Shared execution protocol for all GSD agents"
      contains: "Git Safety"
    - path: ".planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md"
      provides: "Audit trail of what was extracted from where"
      contains: "Source Agent"
  key_links:
    - from: ".claude/get-shit-done/references/agent-protocol.md"
      to: ".claude/get-shit-done/references/git-integration.md"
      via: "Reference link for canonical commit format"
      pattern: "git-integration.md"
---

<objective>
Create the shared agent execution protocol and extraction registry.

Purpose: Establish the single source of truth for operational conventions shared across all 11 GSD agents. The protocol consolidates git safety rules, commit format, tool conventions, state file paths, quality guidance, and structured return conventions into one file. The extraction registry documents exactly which sections came from which agents for audit.

Output: `agent-protocol.md` (shared protocol) + `22-EXTRACTION-REGISTRY.md` (extraction audit trail)
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary-standard.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-agent-boilerplate-extraction/22-CONTEXT.md
@.planning/phases/22-agent-boilerplate-extraction/22-RESEARCH.md

Source agents (read for extraction):
@.claude/agents/gsd-executor.md
@.claude/agents/gsd-debugger.md
@.claude/agents/gsd-planner.md
@.claude/agents/gsd-phase-researcher.md
@.claude/agents/gsd-project-researcher.md
@.claude/agents/gsd-plan-checker.md
@.claude/agents/gsd-codebase-mapper.md
@.claude/agents/gsd-research-synthesizer.md
@.claude/agents/gsd-integration-checker.md
@.claude/agents/gsd-roadmapper.md
@.claude/agents/gsd-verifier.md

Existing reference for commit format:
@.claude/get-shit-done/references/git-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared agent-protocol.md with all 12 protocol sections</name>
  <files>.claude/get-shit-done/references/agent-protocol.md</files>
  <action>
Create `.claude/get-shit-done/references/agent-protocol.md` containing 12 sections in this order (from most-universal to most-specific):

**Header:** Include a prominent note: "Shared operational conventions for all GSD agents. Convention changes go HERE, not in individual agent specs. Agent-specific overrides should appear ABOVE the `<required_reading>` tag in agent specs."

**Section 1 — Git Safety Rules:**
Consolidate from gsd-executor.md (L246) and gsd-debugger.md (L991). Content: NEVER use `git add .` or `git add -A`, stage files individually by name. Rationale about preventing unintended commits.

**Section 2 — File Staging Conventions:**
From gsd-executor.md (L244-250). Explicit staging per file, `git status --short` check before staging.

**Section 3 — Commit Format & Types:**
REFERENCE (do not duplicate) `git-integration.md` for the canonical commit type table and format. Include only the agent-specific summary: commit format is `{type}({phase}-{plan}): {description}` with bullet-point body. Link to git-integration.md for full reference. Extract the commit type table from gsd-executor.md (L253-260) as a quick-reference, noting git-integration.md is canonical.

**Section 4 — gsd-tools.js Commit Pattern:**
From gsd-executor.md, gsd-planner.md, gsd-phase-researcher.md, gsd-debugger.md, gsd-research-synthesizer.md. Pattern: `node ./.claude/get-shit-done/bin/gsd-tools.js commit "{message}" --files {paths}`. Document when to use (after task completion, after creating docs).

**Section 5 — commit_docs Configuration:**
From gsd-executor.md, gsd-planner.md, gsd-phase-researcher.md, gsd-debugger.md. Content: `commit_docs` controls git operations only, NOT file writing. Always write files first, then check commit_docs before committing. gsd-tools.js commit respects commit_docs automatically.

**Section 6 — State File Conventions:**
Consolidate path conventions referenced across 5+ agents. Document: `.planning/` root, `.planning/STATE.md`, `.planning/phases/XX-name/` phase directory pattern, `.planning/debug/`, `.planning/research/`, `.planning/codebase/`, `.planning/ROADMAP.md`. Include the naming patterns for PLAN.md, SUMMARY.md, RESEARCH.md, CONTEXT.md, VERIFICATION.md files.

**Section 7 — gsd-tools.js Init Pattern:**
From 5 agents. Document the general pattern: `INIT=$(node ./.claude/get-shit-done/bin/gsd-tools.js init {subcommand} "${PHASE}")`. List available subcommands: `execute-phase`, `plan-phase`, `phase-op`, `state load`, `verify`. Note: each agent uses its own subcommand and extracts different fields — the specific invocation stays in agent specs.

**Section 8 — Tool Conventions (Context7 / WebSearch / Brave):**
Extract ~90 lines from gsd-phase-researcher.md (L84-130) and gsd-project-researcher.md (L63-134). Include: tool priority table (Context7 > WebFetch > WebSearch), Context7 flow (resolve-library-id then query-docs), WebSearch tips (include current year, multiple variations), Brave Search API via gsd-tools.js websearch with options.

**Section 9 — Source Hierarchy & Confidence Levels:**
Extract from gsd-phase-researcher.md (L132-142) and gsd-project-researcher.md (L124-133). Include: HIGH/MEDIUM/LOW confidence table, source priority chain.

**Section 10 — Research Verification Protocol:**
Extract from gsd-phase-researcher.md (L144-175) and gsd-project-researcher.md (L136-166). Include: verification flow (Context7 > official docs > multiple sources), known pitfalls (Config Scope Blindness, Deprecated Features, Negative Claims, Single Source Reliance), pre-submission checklist.

**Section 11 — Quality & Context Budget:**
Extract from gsd-planner.md (L76-83). Quality Degradation Curve table (0-30% PEAK, 30-50% GOOD, 50-70% DEGRADING, 70%+ POOR). Context budget rule: plans should complete within ~50% context.

**Section 12 — Structured Return Conventions:**
Extract the shared pattern (not content) from multiple agents. Document: all structured returns use `## {STATUS KEYWORD}` header, include Phase/Status metadata, use tables for structured data. Note: actual return types and content stay in each agent spec.

**Additional section — Forbidden Files:**
Extract from gsd-codebase-mapper.md. Rules about files agents must not modify. This should apply to ALL agents, not just codebase-mapper.

Target: ~400-600 lines. Use clear markdown headers with section numbers for easy reference.
  </action>
  <verify>
File exists at `.claude/get-shit-done/references/agent-protocol.md`. Contains all 12+ sections. References git-integration.md (not duplicating it). Has the header note about convention changes. Line count is in 400-600 range: `wc -l .claude/get-shit-done/references/agent-protocol.md`.
  </verify>
  <done>agent-protocol.md exists with all 12 sections covering git safety, commit format, tool conventions, state file paths, quality guidance, and structured return conventions. Protocol header directs convention changes to this file.</done>
</task>

<task type="auto">
  <name>Task 2: Create extraction registry documenting source-to-protocol mapping</name>
  <files>.planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md</files>
  <action>
Create `22-EXTRACTION-REGISTRY.md` with:

**Header:** Title, date, purpose (audit trail for Phase 22 extraction).

**Main table** with columns: Section Name, Source Agent(s) with line numbers, Protocol Section it maps to, Extraction Type (FULL EXTRACT / EXTRACT PATTERN / EXTRACT CONVENTIONS), Notes.

Populate from the 9 extraction categories identified in research:
1. Git Safety Rules → gsd-executor (L246), gsd-debugger (L991) → Protocol Section 1 → FULL EXTRACT
2. Commit Format Conventions → gsd-executor (L253-271), gsd-debugger (L991-998) → Protocol Section 3 → FULL EXTRACT (references git-integration.md)
3. gsd-tools.js Commit Pattern → gsd-executor, gsd-planner, gsd-phase-researcher, gsd-debugger, gsd-research-synthesizer → Protocol Section 4 → FULL EXTRACT
4. commit_docs Configuration → gsd-executor, gsd-planner, gsd-phase-researcher, gsd-debugger → Protocol Section 5 → FULL EXTRACT
5. gsd-tools.js Init Pattern → gsd-executor, gsd-planner, gsd-phase-researcher, gsd-plan-checker, gsd-debugger → Protocol Section 7 → EXTRACT PATTERN
6. Tool Strategy → gsd-phase-researcher (L84-130), gsd-project-researcher (L63-134) → Protocol Sections 8-10 → FULL EXTRACT
7. Quality Degradation Curve → gsd-planner (L76-83), gsd-plan-checker → Protocol Section 11 → FULL EXTRACT
8. State File Path Conventions → 5+ agents → Protocol Section 6 → EXTRACT
9. Structured Return Format Pattern → all 11 agents → Protocol Section 12 → EXTRACT CONVENTIONS ONLY
10. Forbidden Files → gsd-codebase-mapper → Protocol (additional section) → FULL EXTRACT

**Summary stats:** Total sections extracted, estimated lines removed across all agents, agents with most extraction.

**Sections that STAYED in agents** (for completeness): role, philosophy, domain methodology, execution steps, structured return CONTENT, success criteria, deviation rules, checkpoint protocol, hypothesis testing, goal-backward.
  </action>
  <verify>File exists at `.planning/phases/22-agent-boilerplate-extraction/22-EXTRACTION-REGISTRY.md`. Contains the main extraction table with all 10 categories. Has source agent references with line numbers. Has summary statistics.</verify>
  <done>Extraction registry exists documenting exactly which sections moved from which agents to the shared protocol, with line numbers and extraction type classifications.</done>
</task>

</tasks>

<verification>
- [ ] agent-protocol.md exists at `.claude/get-shit-done/references/agent-protocol.md`
- [ ] Protocol contains all 12 sections plus forbidden files
- [ ] Protocol references git-integration.md instead of duplicating commit format details
- [ ] Protocol header note directs convention changes to this file
- [ ] 22-EXTRACTION-REGISTRY.md exists with complete source mapping
- [ ] Registry covers all 10 extraction categories from research
</verification>

<success_criteria>
The shared protocol file exists as a complete, well-organized reference that consolidates all operational conventions. The extraction registry provides a complete audit trail. Both artifacts are ready for Plans 02-04 to reference when editing agent specs.
</success_criteria>

<output>
After completion, create `.planning/phases/22-agent-boilerplate-extraction/22-01-SUMMARY.md`
</output>
